var l=Object.defineProperty;var g=(c,e,t)=>e in c?l(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var o=(c,e,t)=>g(c,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";import{W as r}from"./WikidataEnhancementService-2MvXLlqh.js";class d{constructor(){o(this,"applyButton");o(this,"clearButton");o(this,"selectedSuggestions",new Set);o(this,"wikidataService");o(this,"isLoading",!1);o(this,"handleApplyClick",()=>{this.applySuggestions()});o(this,"handleClearClick",()=>{this.clearSelections()});o(this,"handleFactCheckboxChange",e=>{const t=e.target,n=t.dataset.fact;t.checked?this.selectedSuggestions.add(`fact-${n}`):this.selectedSuggestions.delete(`fact-${n}`),this.updateActionButtons()});o(this,"handleSectionButtonClick",e=>{const t=e.currentTarget,n=t.closest(".suggestion-item--section"),s=n.dataset.section,i=`section-${s}`;console.log(`Section clicked: ${s}, ID: ${i}`),console.log("Currently selected:",Array.from(this.selectedSuggestions)),this.selectedSuggestions.has(i)?(console.log(`Deselecting ${i}`),this.selectedSuggestions.delete(i),t.classList.remove("selected"),n.classList.remove("selected")):(console.log(`Selecting ${i}`),this.selectedSuggestions.add(i),t.classList.add("selected"),n.classList.add("selected")),console.log(`New selection count: ${this.selectedSuggestions.size}`),console.log(`Button has selected class: ${t.classList.contains("selected")}`),this.updateActionButtons()});this.applyButton=document.getElementById("applyButton"),this.clearButton=document.getElementById("clearButton"),this.wikidataService=new r,console.log("Class-based manager: Loading API data only"),this.loadWikidataSuggestions().catch(e=>{console.error("Failed to load Wikidata suggestions:",e)})}async loadWikidataSuggestions(){this.isLoading=!0,this.showLoadingState();try{const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);this.renderSuggestions(t),this.updateSuggestionCount(t.length)}catch(e){console.error("Error loading Wikidata suggestions:",e)}finally{this.isLoading=!1,this.hideLoadingState()}}getExistingArticleContent(){return`
            Katie Bouman is an American computer scientist and engineer.
            After earning her doctorate, Bouman joined Harvard University as a postdoctoral fellow 
            on the Event Horizon Telescope Imaging team. Bouman joined Event Horizon Telescope project in 2013.
            She led the development of an algorithm for imaging black holes, known as Continuous High-resolution 
            Image Reconstruction using Patch priors (CHIRP). Bouman received significant media attention after 
            a photo, showing her reaction to the detection of the black hole shadow in the EHT images, went viral.
        `}renderSuggestions(e){const t=e.filter(s=>s.type==="fact"),n=e.filter(s=>s.type==="section");t.length>0&&this.renderFactSuggestions(t),n.length>0&&this.renderSectionSuggestions(n),this.reinitializeEventListeners()}renderFactSuggestions(e){const t=document.querySelector(".suggestion-section");if(!t)return;const n=t.querySelector(".suggestion-list");n&&(n.innerHTML="",e.forEach(s=>{const i=document.createElement("label");i.className="suggestion-item",i.innerHTML=`
                <input type="checkbox" class="suggestion-item__checkbox" data-fact="${s.id}">
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${s.content}</div>
                    ${s.hint?`<div class="suggestion-item__hint">${s.hint}</div>`:""}
                </div>
            `,n.appendChild(i)}))}renderSectionSuggestions(e){const n=document.querySelectorAll(".suggestion-section")[1];if(!n)return;const s=n.querySelector(".suggestion-list");s&&(s.innerHTML="",e.forEach(i=>{const a=document.createElement("div");a.className="suggestion-item suggestion-item--section",a.dataset.section=i.id,a.innerHTML=`
                <button class="suggestion-item__add-btn">+</button>
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${i.title}</div>
                    <div class="suggestion-item__hint">${i.hint||"From Wikidata"}</div>
                </div>
            `,s.appendChild(a)}))}reinitializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons(),this.applyButton&&(this.applyButton.removeEventListener("click",this.handleApplyClick),this.applyButton.addEventListener("click",this.handleApplyClick)),this.clearButton&&(this.clearButton.removeEventListener("click",this.handleClearClick),this.clearButton.addEventListener("click",this.handleClearClick))}showLoadingState(){var t;const e=document.createElement("div");e.id="loading-suggestions",e.className="suggestions-loading",e.innerHTML=`
            <div class="suggestions-loading__content">
                <div class="suggestions-loading__spinner"></div>
                <p>Loading suggestions from Wikidata...</p>
            </div>
        `,(t=document.querySelector(".suggestions-page__main"))==null||t.prepend(e)}hideLoadingState(){const e=document.getElementById("loading-suggestions");e&&e.remove()}updateSuggestionCount(e){const t=document.getElementById("suggestionCount");t&&(t.textContent=`${e} ideas`)}initializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons(),this.applyButton&&(this.applyButton.removeEventListener("click",this.handleApplyClick),this.applyButton.addEventListener("click",this.handleApplyClick)),this.clearButton&&(this.clearButton.removeEventListener("click",this.handleClearClick),this.clearButton.addEventListener("click",this.handleClearClick))}initializeFactCheckboxes(){const e=document.querySelectorAll(".suggestion-item__checkbox");console.log(`Initializing ${e.length} fact checkboxes`),e.forEach(t=>{t.removeEventListener("change",this.handleFactCheckboxChange),t.addEventListener("change",this.handleFactCheckboxChange)})}initializeSectionButtons(){const e=document.querySelectorAll(".suggestion-item__add-btn");console.log(`Initializing ${e.length} section buttons`),e.forEach((t,n)=>{const s=t.closest(".suggestion-item--section"),i=s==null?void 0:s.getAttribute("data-section");console.log(`Button ${n}: section-${i}`),t.removeEventListener("click",this.handleSectionButtonClick),t.addEventListener("click",this.handleSectionButtonClick)})}updateActionButtons(){console.log(`updateActionButtons called with count: ${this.selectedSuggestions.size}`);const e=this.selectedSuggestions.size;if(!this.applyButton){console.error("Apply button not found!");return}this.applyButton.disabled=e===0;const t=document.getElementById("selectionCount"),n=document.getElementById("pluralS");if(!t||!n){console.error("Selection count elements not found!",{selectionCount:!!t,pluralS:!!n});return}t.textContent=e.toString(),n.style.display=e===1?"none":"inline",console.log(`Updated UI: count=${e}, buttonDisabled=${this.applyButton.disabled}`)}clearSelections(){document.querySelectorAll(".suggestion-item__checkbox").forEach(s=>{s.checked=!1}),document.querySelectorAll(".suggestion-item__add-btn").forEach(s=>{s.classList.remove("selected")}),document.querySelectorAll(".suggestion-item--section").forEach(s=>{s.classList.remove("selected")}),this.selectedSuggestions.clear(),this.updateActionButtons()}async applySuggestions(){if(console.log("=== APPLY SUGGESTIONS CALLED ==="),console.log("Selected suggestions:",Array.from(this.selectedSuggestions)),this.selectedSuggestions.size===0){console.warn("No suggestions selected");return}const e=Array.from(this.selectedSuggestions);sessionStorage.setItem("selectedSuggestions",JSON.stringify(e)),console.log("Stored in sessionStorage:",e),this.showSuccessFeedback(),this.storeWikidataBackground(),setTimeout(()=>{console.log("Navigating to expansion page...");try{window.location.assign("./section-expansion.html")}catch(t){console.error("Navigation failed, trying alternative:",t),window.location.replace("./section-expansion.html")}},500)}async storeWikidataBackground(){try{console.log("Starting background Wikidata storage...");const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);sessionStorage.setItem("wikidataSuggestions",JSON.stringify(t)),console.log("Background: Stored Wikidata suggestions:",t)}catch(e){console.error("Background: Error storing Wikidata suggestions:",e)}}showSuccessFeedback(){const e=this.selectedSuggestions.size,t=document.createElement("div");t.className="success-feedback",t.textContent=`âœ“ ${e} suggestion${e===1?"":"s"} will be applied!`,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{console.log("=== INITIALIZING SUGGESTIONS PAGE ==="),new d().initializeEventListeners()});
