var l=Object.defineProperty;var d=(c,e,t)=>e in c?l(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var o=(c,e,t)=>d(c,typeof e!="symbol"?e+"":e,t);import"./codex-BYAibwde.js";import{W as g}from"./WikidataEnhancementService-D8EZ4RgJ.js";class r{constructor(){o(this,"applyButton");o(this,"clearButton");o(this,"selectedSuggestions",new Set);o(this,"wikidataService");o(this,"isLoading",!1);o(this,"handleApplyClick",()=>{this.applySuggestions()});o(this,"handleClearClick",()=>{this.clearSelections()});o(this,"handleFactCheckboxChange",e=>{const t=e.target,s=t.dataset.fact;t.checked?this.selectedSuggestions.add(`fact-${s}`):this.selectedSuggestions.delete(`fact-${s}`),this.updateActionButtons()});o(this,"handleSectionButtonClick",e=>{const t=e.currentTarget,s=t.closest(".suggestion-item--section"),n=`section-${s.dataset.section}`;this.selectedSuggestions.has(n)?(this.selectedSuggestions.delete(n),t.classList.remove("selected"),s.classList.remove("selected")):(this.selectedSuggestions.add(n),t.classList.add("selected"),s.classList.add("selected")),this.updateActionButtons()});this.applyButton=document.getElementById("applyButton"),this.clearButton=document.getElementById("clearButton"),this.wikidataService=new g,this.initializeEventListeners(),this.updateActionButtons(),this.loadWikidataSuggestions().catch(e=>{console.error("Failed to load Wikidata suggestions:",e),setTimeout(()=>this.initializeEventListeners(),100)})}async loadWikidataSuggestions(){this.isLoading=!0,this.showLoadingState();try{const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);this.renderSuggestions(t),this.updateSuggestionCount(t.length)}catch(e){console.error("Error loading Wikidata suggestions:",e)}finally{this.isLoading=!1,this.hideLoadingState()}}getExistingArticleContent(){return`
            Katie Bouman is an American computer scientist and engineer.
            After earning her doctorate, Bouman joined Harvard University as a postdoctoral fellow 
            on the Event Horizon Telescope Imaging team. Bouman joined Event Horizon Telescope project in 2013.
            She led the development of an algorithm for imaging black holes, known as Continuous High-resolution 
            Image Reconstruction using Patch priors (CHIRP). Bouman received significant media attention after 
            a photo, showing her reaction to the detection of the black hole shadow in the EHT images, went viral.
        `}renderSuggestions(e){const t=e.filter(i=>i.type==="fact"),s=e.filter(i=>i.type==="section");t.length>0&&this.renderFactSuggestions(t),s.length>0&&this.renderSectionSuggestions(s),this.reinitializeEventListeners()}renderFactSuggestions(e){const t=document.querySelector(".suggestion-section");if(!t)return;const s=t.querySelector(".suggestion-list");s&&(s.innerHTML="",e.forEach(i=>{const n=document.createElement("label");n.className="suggestion-item",n.innerHTML=`
                <input type="checkbox" class="suggestion-item__checkbox" data-fact="${i.id}">
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${i.content}</div>
                    ${i.hint?`<div class="suggestion-item__hint">${i.hint}</div>`:""}
                </div>
            `,s.appendChild(n)}))}renderSectionSuggestions(e){const s=document.querySelectorAll(".suggestion-section")[1];if(!s)return;const i=s.querySelector(".suggestion-list");i&&(i.innerHTML="",e.forEach(n=>{const a=document.createElement("div");a.className="suggestion-item suggestion-item--section",a.dataset.section=n.id,a.innerHTML=`
                <button class="suggestion-item__add-btn">+</button>
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${n.title}</div>
                    <div class="suggestion-item__hint">${n.hint||"From Wikidata"}</div>
                </div>
            `,i.appendChild(a)}))}reinitializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons()}showLoadingState(){var t;const e=document.createElement("div");e.id="loading-suggestions",e.className="suggestions-loading",e.innerHTML=`
            <div class="suggestions-loading__content">
                <div class="suggestions-loading__spinner"></div>
                <p>Loading suggestions from Wikidata...</p>
            </div>
        `,(t=document.querySelector(".suggestions-page__main"))==null||t.prepend(e)}hideLoadingState(){const e=document.getElementById("loading-suggestions");e&&e.remove()}updateSuggestionCount(e){const t=document.getElementById("suggestionCount");t&&(t.textContent=`${e} ideas`)}initializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons(),this.applyButton&&(this.applyButton.removeEventListener("click",this.handleApplyClick),this.applyButton.addEventListener("click",this.handleApplyClick)),this.clearButton&&(this.clearButton.removeEventListener("click",this.handleClearClick),this.clearButton.addEventListener("click",this.handleClearClick))}initializeFactCheckboxes(){document.querySelectorAll(".suggestion-item__checkbox").forEach(t=>{t.removeEventListener("change",this.handleFactCheckboxChange),t.addEventListener("change",this.handleFactCheckboxChange.bind(this))})}initializeSectionButtons(){const e=document.querySelectorAll(".suggestion-item__add-btn");console.log(`Initializing ${e.length} section buttons`),e.forEach((t,s)=>{const i=t.closest(".suggestion-item--section"),n=i==null?void 0:i.getAttribute("data-section");console.log(`Button ${s}: section-${n}`),t.removeEventListener("click",this.handleSectionButtonClick),t.addEventListener("click",this.handleSectionButtonClick.bind(this))})}updateActionButtons(){const e=this.selectedSuggestions.size;this.applyButton.disabled=e===0;const t=document.getElementById("selectionCount"),s=document.getElementById("pluralS");t.textContent=e.toString(),s.style.display=e===1?"none":"inline"}clearSelections(){document.querySelectorAll(".suggestion-item__checkbox").forEach(i=>{i.checked=!1}),document.querySelectorAll(".suggestion-item__add-btn").forEach(i=>{i.classList.remove("selected")}),document.querySelectorAll(".suggestion-item--section").forEach(i=>{i.classList.remove("selected")}),this.selectedSuggestions.clear(),this.updateActionButtons()}async applySuggestions(){sessionStorage.setItem("selectedSuggestions",JSON.stringify(Array.from(this.selectedSuggestions)));const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);sessionStorage.setItem("wikidataSuggestions",JSON.stringify(t)),this.showSuccessFeedback(),setTimeout(()=>{window.location.href="./section-expansion.html"},1e3)}showSuccessFeedback(){const e=this.selectedSuggestions.size,t=document.createElement("div");t.className="success-feedback",t.textContent=`âœ“ ${e} suggestion${e===1?"":"s"} will be applied!`,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{new r});
