var h=Object.defineProperty;var m=(o,e,t)=>e in o?h(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>m(o,typeof e!="symbol"?e+"":e,t);import"./codex-BYAibwde.js";import{W as p}from"./WikidataEnhancementService-2MvXLlqh.js";class S{constructor(){a(this,"applyButton");a(this,"clearButton");a(this,"selectedSuggestions",new Set);a(this,"wikidataService");a(this,"isLoading",!1);a(this,"handleApplyClick",()=>{this.applySuggestions()});a(this,"handleClearClick",()=>{this.clearSelections()});a(this,"handleFactCheckboxChange",e=>{const t=e.target,i=t.dataset.fact;t.checked?this.selectedSuggestions.add(`fact-${i}`):this.selectedSuggestions.delete(`fact-${i}`),this.updateActionButtons()});a(this,"handleSectionButtonClick",e=>{const t=e.currentTarget,i=t.closest(".suggestion-item--section"),n=i.dataset.section,s=`section-${n}`;console.log(`Section clicked: ${n}, ID: ${s}`),console.log("Currently selected:",Array.from(this.selectedSuggestions)),this.selectedSuggestions.has(s)?(console.log(`Deselecting ${s}`),this.selectedSuggestions.delete(s),t.classList.remove("selected"),i.classList.remove("selected")):(console.log(`Selecting ${s}`),this.selectedSuggestions.add(s),t.classList.add("selected"),i.classList.add("selected")),console.log(`New selection count: ${this.selectedSuggestions.size}`),console.log(`Button has selected class: ${t.classList.contains("selected")}`),this.updateActionButtons()});this.applyButton=document.getElementById("applyButton"),this.clearButton=document.getElementById("clearButton"),this.wikidataService=new p,console.log("Class-based manager: Loading API data only"),this.loadWikidataSuggestions().catch(e=>{console.error("Failed to load Wikidata suggestions:",e)})}async loadWikidataSuggestions(){this.isLoading=!0,this.showLoadingState();try{const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);this.renderSuggestions(t),this.updateSuggestionCount(t.length)}catch(e){console.error("Error loading Wikidata suggestions:",e)}finally{this.isLoading=!1,this.hideLoadingState()}}getExistingArticleContent(){return`
            Katie Bouman is an American computer scientist and engineer.
            After earning her doctorate, Bouman joined Harvard University as a postdoctoral fellow 
            on the Event Horizon Telescope Imaging team. Bouman joined Event Horizon Telescope project in 2013.
            She led the development of an algorithm for imaging black holes, known as Continuous High-resolution 
            Image Reconstruction using Patch priors (CHIRP). Bouman received significant media attention after 
            a photo, showing her reaction to the detection of the black hole shadow in the EHT images, went viral.
        `}renderSuggestions(e){const t=e.filter(n=>n.type==="fact"),i=e.filter(n=>n.type==="section");t.length>0&&this.renderFactSuggestions(t),i.length>0&&this.renderSectionSuggestions(i),this.reinitializeEventListeners()}renderFactSuggestions(e){const t=document.querySelector(".suggestion-section");if(!t)return;const i=t.querySelector(".suggestion-list");i&&(i.innerHTML="",e.forEach(n=>{const s=document.createElement("label");s.className="suggestion-item",s.innerHTML=`
                <input type="checkbox" class="suggestion-item__checkbox" data-fact="${n.id}">
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${n.content}</div>
                    ${n.hint?`<div class="suggestion-item__hint">${n.hint}</div>`:""}
                </div>
            `,i.appendChild(s)}))}renderSectionSuggestions(e){const i=document.querySelectorAll(".suggestion-section")[1];if(!i)return;const n=i.querySelector(".suggestion-list");n&&(n.innerHTML="",e.forEach(s=>{const c=document.createElement("div");c.className="suggestion-item suggestion-item--section",c.dataset.section=s.id,c.innerHTML=`
                <button class="suggestion-item__add-btn">+</button>
                <div class="suggestion-item__content">
                    <div class="suggestion-item__text">${s.title}</div>
                    <div class="suggestion-item__hint">${s.hint||"From Wikidata"}</div>
                </div>
            `,n.appendChild(c)}))}reinitializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons()}showLoadingState(){var t;const e=document.createElement("div");e.id="loading-suggestions",e.className="suggestions-loading",e.innerHTML=`
            <div class="suggestions-loading__content">
                <div class="suggestions-loading__spinner"></div>
                <p>Loading suggestions from Wikidata...</p>
            </div>
        `,(t=document.querySelector(".suggestions-page__main"))==null||t.prepend(e)}hideLoadingState(){const e=document.getElementById("loading-suggestions");e&&e.remove()}updateSuggestionCount(e){const t=document.getElementById("suggestionCount");t&&(t.textContent=`${e} ideas`)}initializeEventListeners(){this.initializeFactCheckboxes(),this.initializeSectionButtons(),this.applyButton&&(this.applyButton.removeEventListener("click",this.handleApplyClick),this.applyButton.addEventListener("click",this.handleApplyClick)),this.clearButton&&(this.clearButton.removeEventListener("click",this.handleClearClick),this.clearButton.addEventListener("click",this.handleClearClick))}initializeFactCheckboxes(){document.querySelectorAll(".suggestion-item__checkbox").forEach(t=>{t.removeEventListener("change",this.handleFactCheckboxChange),t.addEventListener("change",this.handleFactCheckboxChange.bind(this))})}initializeSectionButtons(){const e=document.querySelectorAll(".suggestion-item__add-btn");console.log(`Initializing ${e.length} section buttons`),e.forEach((t,i)=>{const n=t.closest(".suggestion-item--section"),s=n==null?void 0:n.getAttribute("data-section");console.log(`Button ${i}: section-${s}`),t.removeEventListener("click",this.handleSectionButtonClick),t.addEventListener("click",this.handleSectionButtonClick.bind(this))})}updateActionButtons(){console.log(`updateActionButtons called with count: ${this.selectedSuggestions.size}`);const e=this.selectedSuggestions.size;if(!this.applyButton){console.error("Apply button not found!");return}this.applyButton.disabled=e===0;const t=document.getElementById("selectionCount"),i=document.getElementById("pluralS");if(!t||!i){console.error("Selection count elements not found!",{selectionCount:!!t,pluralS:!!i});return}t.textContent=e.toString(),i.style.display=e===1?"none":"inline",console.log(`Updated UI: count=${e}, buttonDisabled=${this.applyButton.disabled}`)}clearSelections(){document.querySelectorAll(".suggestion-item__checkbox").forEach(n=>{n.checked=!1}),document.querySelectorAll(".suggestion-item__add-btn").forEach(n=>{n.classList.remove("selected")}),document.querySelectorAll(".suggestion-item--section").forEach(n=>{n.classList.remove("selected")}),this.selectedSuggestions.clear(),this.updateActionButtons()}async applySuggestions(){sessionStorage.setItem("selectedSuggestions",JSON.stringify(Array.from(this.selectedSuggestions)));const e=this.getExistingArticleContent(),t=await this.wikidataService.getEnhancementSuggestions(e);sessionStorage.setItem("wikidataSuggestions",JSON.stringify(t)),this.showSuccessFeedback(),setTimeout(()=>{window.location.href="./section-expansion.html"},1e3)}showSuccessFeedback(){const e=this.selectedSuggestions.size,t=document.createElement("div");t.className="success-feedback",t.textContent=`✓ ${e} suggestion${e===1?"":"s"} will be applied!`,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{console.log("=== INITIALIZING API-DRIVEN SUGGESTIONS ==="),new S,console.log("=== OPTIMIZED SELECTION: Creating instant response ===");const o=new Set;function e(){const s=o.size,c=document.getElementById("applyButton"),l=document.getElementById("selectionCount"),d=document.getElementById("pluralS");!c||!l||!d||(console.log(`INSTANT UPDATE: count=${s}`),c.disabled=s===0,l.textContent=s.toString(),d.style.display=s===1?"none":"inline")}function t(){const s=document.querySelectorAll(".suggestion-item__add-btn");console.log(`Attaching instant listeners to ${s.length} buttons`),s.forEach(c=>{c.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();const d=l.currentTarget,r=d.closest(".suggestion-item--section"),u=r.dataset.section,g=`section-${u}`;o.has(g)?(o.delete(g),d.classList.remove("selected"),r.classList.remove("selected")):(o.add(g),d.classList.add("selected"),r.classList.add("selected")),e(),window.optimizedSelectedSuggestions=o,console.log(`INSTANT: ${u} ${o.has(g)?"selected":"deselected"}`)},{passive:!1})})}t(),new MutationObserver(()=>{t()}).observe(document.querySelector(".suggestions-page__main")||document.body,{childList:!0,subtree:!0});const n=document.getElementById("applyButton");n&&n.addEventListener("click",()=>{const s=window.optimizedSelectedSuggestions||o;if(s&&s.size>0){console.log("=== APPLYING OPTIMIZED SELECTIONS ===",Array.from(s)),sessionStorage.setItem("selectedSuggestions",JSON.stringify(Array.from(s)));const c=document.createElement("div");c.style.cssText=`
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: #00af89; color: white; padding: 16px 32px; border-radius: 8px;
                    font-weight: 500; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `,c.textContent=`✓ ${s.size} suggestion${s.size===1?"":"s"} will be applied!`,document.body.appendChild(c),setTimeout(()=>{window.location.href="./section-expansion.html"},1e3)}}),e(),console.log("=== OPTIMIZED SELECTION APPLIED ===")});
