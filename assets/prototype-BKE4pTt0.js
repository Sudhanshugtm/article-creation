var P=Object.defineProperty;var b=(u,e,t)=>e in u?P(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var l=(u,e,t)=>b(u,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";const R='<path d="M11 9V4H9v5H4v2h5v5h2v-5h5V9z"/>',k='<path d="M5 1a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2V3a2 2 0 00-2-2zm0 3h5v1H5zm0 2h5v1H5zm0 2h5v1H5zm10 7H5v-1h10zm0-2H5v-1h10zm0-2H5v-1h10zm0-2h-4V4h4z"/>',M='<path d="M8.46 1q2.325 0 3.9.45c1.07.29 1.86.77 2.39 1.44.54.66.8 1.55.8 2.67 0 .68-.1 1.29-.31 1.84a3.34 3.34 0 01-.94 1.37c-.39.35-.98.63-1.55.73.59.12 1.23.4 1.7.7.48.3.85.74 1.13 1.31s.42 1.33.42 2.27c0 1.1-.26 2.04-.79 2.83a4.9 4.9 0 01-2.2 1.79q-1.455.6-3.45.6H3V1zm.41 7c1.09 0 1.83-.04 2.24-.4.43-.35.64-.86.64-1.53 0-.7-.25-1.38-.74-1.68s-1.27-.4-2.33-.4H7v4h1.87ZM7 11v5h2.14a3.3 3.3 0 002.34-.8 2.5 2.5 0 00.66-1.8c0-.45-.1-.85-.3-1.18a2 2 0 00-.95-.93 5.1 5.1 0 00-1.87-.3H7Z"/>',$='<path d="M15 2a7.65 7.65 0 00-5 2 7.65 7.65 0 00-5-2H1v15h4a7.65 7.65 0 015 2 7.65 7.65 0 015-2h4V2zm2.5 13.5H14a4.38 4.38 0 00-3 1V5s1-1.5 4-1.5h2.5z"/><path d="M9 3.5h2v1H9z"/>',x='<path d="M15 3V1h-2v2H7V1H5v2H2a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V5a2 2 0 00-2-2zm3 14H2V8h16zm-2-6h-4v4h4z"/>',D='<path d="m4.34 2.93 12.73 12.73-1.41 1.41L2.93 4.35z"/><path d="M17.07 4.34 4.34 17.07l-1.41-1.41L15.66 2.93z"/>',B='<path d="M3 1a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V3a2 2 0 00-2-2zm2 16a2 2 0 112-2 2 2 0 01-2 2M5 7a2 2 0 112-2 2 2 0 01-2 2m5 5a2 2 0 112-2 2 2 0 01-2 2m5 5a2 2 0 112-2 2 2 0 01-2 2m0-10a2 2 0 112-2 2 2 0 01-2 2"/>',F='<circle cx="10" cy="10" r="2"/><circle cx="3" cy="10" r="2"/><circle cx="17" cy="10" r="2"/>',U='<path d="M12.2 17.94c1.26-2 2-4.45 2.14-7.06h3.86a8.26 8.26 0 01-6 7.06M1.8 10.88h3.86c.14 2.6.88 5.06 2.14 7.06a8.26 8.26 0 01-6-7.06m6-8.82c-1.26 2-2 4.45-2.14 7.07H1.8a8.26 8.26 0 016-7.07m4.79 8.82A12.5 12.5 0 0110 18a12.5 12.5 0 01-2.59-7.13zM7.4 9.13A12.5 12.5 0 0110 1.99a12.5 12.5 0 012.59 7.14zm10.8 0h-3.87a14.8 14.8 0 00-2.14-7.07 8.26 8.26 0 016 7.07M10 0a10 10 0 100 20 10 10 0 000-20"/>',H='<path d="M10 1 0 10h3v9h4v-4.6c0-1.47 1.31-2.66 3-2.66s3 1.19 3 2.66V19h4v-9h3z"/>',G='<path d="M2 2a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V4a2 2 0 00-2-2zm-.17 13 4.09-5.25 2.92 3.51L12.92 8l5.25 7z"/>',Q='<path d="m5 19 .33-1.51 2.17-.66 2.9-13.66-1.9-.63L9 1h7l-.71 1.6-2.29.57-2.83 13.66 2.14.66L12 19z"/>',z='<path d="M4.83 15h2.91a4.9 4.9 0 01-1.55-2H5a3 3 0 110-6h3a3 3 0 012.82 4h2.1a5 5 0 00.08-.83v-.34A4.83 4.83 0 008.17 5H4.83A4.83 4.83 0 000 9.83v.34A4.83 4.83 0 004.83 15"/><path d="M15.17 5h-2.91a4.9 4.9 0 011.55 2H15a3 3 0 110 6h-3a3 3 0 01-2.82-4h-2.1a5 5 0 00-.08.83v.34A4.83 4.83 0 0011.83 15h3.34A4.83 4.83 0 0020 10.17v-.34A4.83 4.83 0 0015.17 5"/>',Y='<path d="M7 1 5.6 2.5 13 10l-7.4 7.5L7 19l9-9z"/>',V='<path d="M1 8.5 8 14v-4h1c4 0 7 2 7 6v1h3v-1c0-6-5-9-10-9H8V3z"/>',W='<path d="M10 11c-5.92 0-8 3-8 5v3h16v-3c0-2-2.08-5-8-5"/><circle cx="10" cy="5.5" r="4.5"/>',S=R,_={ltr:k},j={langCodeMap:{en:M}},K={ltr:$},q=x,X=D,J=B,v=F,Z=U,ee=H,te=G,ie={langCodeMap:{en:Q}},ne=z,ae={ltr:Y},se={ltr:V},re=W;var o=(u=>(u.PERSON="Person/Biography",u.LOCATION="Geographic Location",u.SPECIES="Species/Biology",u.ORGANIZATION="Organization",u.CONCEPT="Academic/Concept",u.CREATIVE_WORK="Creative Work",u.EVENT="Event",u.OTHER="Other",u))(o||{});class L{static categorizeTopics(e){const t=e.map(a=>({...a,category:this.determineCategory(a.instanceOf)})),n=new Map;return t.forEach(a=>{const s=a.category;n.has(s)||n.set(s,[]),n.get(s).push(a)}),Array.from(n.entries()).sort(([a],[s])=>a==="Other"&&s!=="Other"?1:a!=="Other"&&s==="Other"?-1:0).map(([a,s])=>({...s[0],title:a,description:this.getCategoryDescription(a),category:a}))}static determineCategory(e){const t=["Person/Biography","Geographic Location","Species/Biology","Organization","Academic/Concept","Event","Creative Work","Other"],n=new Set;for(const i of e)this.CATEGORY_MAPPINGS.has(i)&&n.add(this.CATEGORY_MAPPINGS.get(i));for(const i of t)if(n.has(i))return i;return"Other"}static getCategoryDescription(e){switch(e){case"Person/Biography":return"About a notable individual or character";case"Geographic Location":return"About a place, city, country, or region";case"Species/Biology":return"About an animal, plant, or biological organism";case"Organization":return"About a company, institution, or group";case"Academic/Concept":return"About an idea, theory, or academic concept";case"Creative Work":return"About a book, film, artwork, or creative piece";case"Event":return"About a historical event or occurrence";case"Other":return"About a general topic or concept";default:return"About a topic or concept"}}static getCategoryIcon(e,t=20){const n=t===12?"12":"20";switch(e){case"Person/Biography":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${re}</svg>`;case"Geographic Location":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${Z}</svg>`;case"Species/Biology":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${J}</svg>`;case"Organization":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${ee}</svg>`;case"Academic/Concept":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${K.ltr}</svg>`;case"Creative Work":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${te}</svg>`;case"Event":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${q}</svg>`;case"Other":return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${_.ltr}</svg>`;default:return`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 20 20" aria-hidden="true">${_.ltr}</svg>`}}}l(L,"CATEGORY_MAPPINGS",new Map([["Q5","Person/Biography"],["Q95074","Person/Biography"],["Q215627","Person/Biography"],["Q3409032","Person/Biography"],["Q49614","Person/Biography"],["Q202444","Person/Biography"],["Q12308941","Person/Biography"],["Q11879590","Person/Biography"],["Q37221","Person/Biography"],["Q101352","Person/Biography"],["Q4167410","Person/Biography"],["Q82799","Person/Biography"],["Q515","Geographic Location"],["Q6256","Geographic Location"],["Q35657","Geographic Location"],["Q3957","Geographic Location"],["Q1021","Geographic Location"],["Q5119","Geographic Location"],["Q486972","Geographic Location"],["Q618123","Geographic Location"],["Q82794","Geographic Location"],["Q41176","Geographic Location"],["Q23413","Geographic Location"],["Q16560","Geographic Location"],["Q355304","Geographic Location"],["Q4022","Geographic Location"],["Q23397","Geographic Location"],["Q8502","Geographic Location"],["Q39594","Geographic Location"],["Q5107","Geographic Location"],["Q1549591","Geographic Location"],["Q15284","Geographic Location"],["Q532","Geographic Location"],["Q15343","Geographic Location"],["Q19953632","Geographic Location"],["Q7432","Species/Biology"],["Q16521","Species/Biology"],["Q729","Species/Biology"],["Q756","Species/Biology"],["Q10876","Species/Biology"],["Q19088","Species/Biology"],["Q23038290","Species/Biology"],["Q55983715","Species/Biology"],["Q2382443","Species/Biology"],["Q23058834","Species/Biology"],["Q17487588","Species/Biology"],["Q55984869","Species/Biology"],["Q55428727","Species/Biology"],["Q713623","Species/Biology"],["Q24238356","Species/Biology"],["Q25367","Species/Biology"],["Q25326","Species/Biology"],["Q7377","Species/Biology"],["Q25329","Species/Biology"],["Q25314","Species/Biology"],["Q35409","Species/Biology"],["Q7432","Species/Biology"],["Q427626","Species/Biology"],["Q2382443","Species/Biology"],["Q50379085","Species/Biology"],["Q3978","Species/Biology"],["Q783794","Organization"],["Q4830453","Organization"],["Q43229","Organization"],["Q3918","Organization"],["Q9842","Organization"],["Q875538","Organization"],["Q31855","Organization"],["Q327333","Organization"],["Q163740","Organization"],["Q4830453","Organization"],["Q6881511","Organization"],["Q1616075","Organization"],["Q15911314","Organization"],["Q484652","Organization"],["Q130019","Organization"],["Q1371037","Organization"],["Q215380","Organization"],["Q5373","Organization"],["Q4830453","Organization"],["Q891723","Organization"],["Q1616075","Organization"],["Q11862829","Academic/Concept"],["Q2996394","Academic/Concept"],["Q1914636","Academic/Concept"],["Q17108659","Academic/Concept"],["Q2725376","Academic/Concept"],["Q11205","Academic/Concept"],["Q47574","Academic/Concept"],["Q186588","Academic/Concept"],["Q7725634","Academic/Concept"],["Q901","Academic/Concept"],["Q395","Academic/Concept"],["Q11862829","Academic/Concept"],["Q1914636","Academic/Concept"],["Q11023","Academic/Concept"],["Q36754","Academic/Concept"],["Q413","Academic/Concept"],["Q420","Academic/Concept"],["Q8134","Academic/Concept"],["Q5891","Academic/Concept"],["Q1071","Academic/Concept"],["Q12473","Academic/Concept"],["Q9418","Academic/Concept"],["Q33999","Academic/Concept"],["Q571","Creative Work"],["Q11424","Creative Work"],["Q202866","Creative Work"],["Q134556","Creative Work"],["Q482994","Creative Work"],["Q15416","Creative Work"],["Q5398426","Creative Work"],["Q1060829","Creative Work"],["Q7725634","Creative Work"],["Q838948","Creative Work"],["Q7889","Creative Work"],["Q17517","Creative Work"],["Q1193514","Creative Work"],["Q11446","Creative Work"],["Q3305213","Creative Work"],["Q17537576","Creative Work"],["Q47461344","Creative Work"],["Q47461344","Creative Work"],["Q223393","Creative Work"],["Q1344","Creative Work"],["Q2088357","Creative Work"],["Q105543609","Creative Work"],["Q1656682","Event"],["Q198","Event"],["Q645883","Event"],["Q3839081","Event"],["Q18669875","Event"],["Q47566","Event"],["Q8065","Event"],["Q1190554","Event"],["Q1656682","Event"],["Q46855","Event"],["Q46855","Event"],["Q16510064","Event"],["Q1656682","Event"],["Q132241","Event"],["Q1190554","Event"],["Q1190554","Event"],["Q181278","Event"],["Q846570","Event"],["Q1371037","Event"]]));class I{static async searchTopics(e){if(!e||e.length<3)return[];try{const t=await this.searchEntities(e);if(t.length===0)return[];const n=t.map(s=>s.id),i=await this.getEntitiesWithCategories(n);return L.categorizeTopics(i)}catch(t){return console.error("Wikidata search error:",t),[]}}static async searchEntities(e){const t=new URLSearchParams({action:"wbsearchentities",search:e,language:"en",format:"json",limit:this.SEARCH_LIMIT.toString(),origin:"*"}),n=await fetch(`${this.BASE_URL}?${t}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();return!i.search||!Array.isArray(i.search)?[]:i.search.filter(a=>a.label&&a.description).slice(0,this.SEARCH_LIMIT)}static async getEntitiesWithCategories(e){var s,r,c;const t=new URLSearchParams({action:"wbgetentities",ids:e.join("|"),format:"json",languages:"en",props:"labels|descriptions|claims",origin:"*"}),n=await fetch(`${this.BASE_URL}?${t}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(!i.entities)return[];const a=[];for(const p of e){const d=i.entities[p];if(!d||!((s=d.labels)!=null&&s.en)||!((r=d.descriptions)!=null&&r.en))continue;const g=(((c=d.claims)==null?void 0:c.P31)||[]).map(m=>{var E,C,f;return((f=(C=(E=m.mainsnak)==null?void 0:E.datavalue)==null?void 0:C.value)==null?void 0:f.id)||""}).filter(Boolean);a.push({id:p,title:d.labels.en.value,description:d.descriptions.en.value,category:"Unknown",instanceOf:g})}return a}static async getEntityProperties(e,t){var i;const n=new URLSearchParams({action:"wbgetentities",ids:e,format:"json",languages:"en",props:"claims",origin:"*"});try{const a=await fetch(`${this.BASE_URL}?${n}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=(i=(await a.json()).entities)==null?void 0:i[e];if(!r||!r.claims)return{};const c={};for(const p of t){const d=r.claims[p];if(d&&d.length>0){const h=d[0],g=this.extractClaimValue(h);g&&(c[p]=g)}}return c}catch(a){return console.error(`Error fetching properties for ${e}:`,a),{}}}static extractClaimValue(e){var n,i;const t=(n=e.mainsnak)==null?void 0:n.datavalue;if(!t)return null;switch(t.type){case"string":return t.value;case"wikibase-entityid":return t.value.id;case"time":return this.formatDate(t.value.time);case"quantity":return t.value.amount;default:return((i=t.value)==null?void 0:i.toString())||null}}static async resolveEntityNames(e){var n,i,a;if(e.length===0)return{};const t=new URLSearchParams({action:"wbgetentities",ids:e.join("|"),format:"json",languages:"en",props:"labels",origin:"*"});try{const s=await fetch(`${this.BASE_URL}?${t}`);if(!s.ok)return{};const r=await s.json(),c={};for(const p of e){const d=(n=r.entities)==null?void 0:n[p];(a=(i=d==null?void 0:d.labels)==null?void 0:i.en)!=null&&a.value&&(c[p]=d.labels.en.value)}return c}catch{return{}}}static formatDate(e){try{const t=e.match(/^([+-]?\d{4,})-(\d{2})-(\d{2})/);if(t){const[,n,i,a]=t;return`${n}-${i}-${a}`}return e}catch{return e}}}l(I,"BASE_URL","https://www.wikidata.org/w/api.php"),l(I,"SEARCH_LIMIT",3);class oe{constructor(e){l(this,"templates",new Map);this.wikidataService=e,this.initializeTemplates()}initializeTemplates(){this.templates.set(o.SPECIES,{category:o.SPECIES,templates:{formal:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} of {{PARENT_TAXON}}{{CONSERVATION_STATUS}}. {{RANGE_INFO}}{{CHARACTERISTICS}}{{DISCOVERY_INFO}}",concise:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} of {{PARENT_TAXON}} native to {{HABITAT}}.",detailed:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} of {{PARENT_TAXON}} in the {{FAMILY}} family{{CONSERVATION_STATUS}}. {{RANGE_INFO}} {{CHARACTERISTICS}} {{BEHAVIOR}} {{DISCOVERY_INFO}} {{SIGNIFICANCE}}"},requiredProperties:["P225"],optionalProperties:["P171","P105","P141","P183","P181","P1843","P935"]}),this.templates.set(o.PERSON,{category:o.PERSON,templates:{formal:"{{FULL_NAME}} ({{BIRTH_DATE}}{{DEATH_DATE}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}}{{NOTABLE_FOR}}. {{PRONOUN}} {{ACHIEVEMENT}}{{EDUCATION}}{{CAREER}}",concise:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}} known for {{MAIN_WORK}}.",detailed:"{{FULL_NAME}} (born {{BIRTH_DETAILS}}{{DEATH_DETAILS}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}} who {{ACHIEVEMENT}}. {{EARLY_LIFE}} {{CAREER_DETAILS}} {{LEGACY}}"},requiredProperties:["P31"],optionalProperties:["P569","P570","P19","P20","P27","P106","P69","P166","P800"]}),this.templates.set(o.LOCATION,{category:o.LOCATION,templates:{formal:"{{NAME}} is {{ARTICLE}} {{TYPE}} in {{PARENT_LOCATION}}. {{POPULATION_INFO}}{{AREA_INFO}}{{SIGNIFICANCE}}{{HISTORY}}",concise:"{{NAME}} is {{ARTICLE}} {{TYPE}} in {{PARENT_LOCATION}} with a population of {{POPULATION}}.",detailed:"{{NAME}} is {{ARTICLE}} {{TYPE}} located in {{PARENT_LOCATION}}. {{ADMIN_INFO}} {{POPULATION_DETAILS}} {{GEOGRAPHY}} {{ECONOMY}} {{CULTURE}}"},requiredProperties:["P31","P17"],optionalProperties:["P131","P1082","P2046","P571","P421","P281"]}),this.templates.set(o.ORGANIZATION,{category:o.ORGANIZATION,templates:{formal:"{{NAME}} is {{ARTICLE}} organization{{FOUNDER}}{{HQ}}{{FOUNDING_DATE}}{{DESCRIPTION}}",concise:"{{NAME}} is {{ARTICLE}} organization founded on{{FOUNDING_DATE}}.",detailed:"{{NAME}} is {{ARTICLE}} organization{{FOUNDER}}{{HQ}} founded on{{FOUNDING_DATE}}.{{DESCRIPTION}}"},requiredProperties:[],optionalProperties:["P571","P112","P159"]}),this.templates.set(o.CONCEPT,{category:o.CONCEPT,templates:{formal:"{{NAME}} is {{ARTICLE}} {{SUBCLASS}} concept{{DESCRIPTION}}",concise:"{{NAME}}: {{DESCRIPTION}}",detailed:"{{NAME}} is {{ARTICLE}} {{SUBCLASS}} concept.{{DESCRIPTION}}"},requiredProperties:[],optionalProperties:["P279"]}),this.templates.set(o.CREATIVE_WORK,{category:o.CREATIVE_WORK,templates:{formal:"{{NAME}} is {{ARTICLE}} {{TYPE}}{{AUTHOR}}{{DATE}}{{DESCRIPTION}}",concise:"{{NAME}}: {{DESCRIPTION}}",detailed:"{{NAME}} is {{ARTICLE}} {{TYPE}}{{AUTHOR}}{{DATE}}.{{DESCRIPTION}}"},requiredProperties:[],optionalProperties:["P31","P50","P577"]}),this.templates.set(o.EVENT,{category:o.EVENT,templates:{formal:"{{NAME}} was {{ARTICLE}} event{{LOCATION}} held on{{DATE}}{{DESCRIPTION}}",concise:"{{NAME}}: {{DESCRIPTION}}",detailed:"{{NAME}} was {{ARTICLE}} event{{LOCATION}} on{{DATE}}.{{DESCRIPTION}}"},requiredProperties:[],optionalProperties:["P585","P131"]})}async generateLeadVariations(e,t){const n=this.templates.get(t);if(!n){const{title:a,description:s,instanceOf:r}=e;let c="";if(r&&r.length>0)try{const g=await I.resolveEntityNames(r),m=r.map(E=>g[E]||E);m.length>0&&(c=` It is an instance of ${m.join(", ")}.`)}catch{}const p=`The ${a} is ${s}.${c}`,d=`${a}: ${s}.`,h=`${a} is ${s}.${c}`;return{formal:p,concise:d,detailed:h}}const i=await this.fetchEntityProperties(e.id,n,e);return{formal:this.fillTemplate(n.templates.formal,i),concise:this.fillTemplate(n.templates.concise,i),detailed:this.fillTemplate(n.templates.detailed,i)}}async fetchEntityProperties(e,t,n){const i=[...t.requiredProperties,...t.optionalProperties],a=await I.getEntityProperties(e,i),s=[];Object.values(a).forEach(p=>{typeof p=="string"&&p.match(/^Q\d+$/)&&s.push(p)});const r=await I.resolveEntityNames(s),c={};return Object.entries(a).forEach(([p,d])=>{typeof d=="string"&&d.match(/^Q\d+$/)?c[p]=r[d]||d:c[p]=d}),this.mapPropertiesToPlaceholders(c,t.category,n)}mapPropertiesToPlaceholders(e,t,n){const i={};switch(t){case o.SPECIES:i.SCIENTIFIC_NAME=e.P225||"",i.COMMON_NAME=e.P1843||n.title,i.PARENT_TAXON=e.P171||"animals",i.TAXON_RANK=e.P105||"species",i.CONSERVATION_STATUS=e.P141?` (conservation status: ${e.P141})`:"",i.RANGE_INFO=e.P183?` It is found in ${e.P183}.`:"",i.CHARACTERISTICS=this.getCharacteristicsFromDescription(n.description),i.DISCOVERY_INFO="",i.ARTICLE=this.getArticle(i.TAXON_RANK),i.HABITAT=e.P183||"various habitats",i.FAMILY=e.P171||"",i.BEHAVIOR="",i.SIGNIFICANCE=this.getSignificanceFromDescription(n.description);break;case o.PERSON:i.FULL_NAME=e.P1477||n.title,i.BIRTH_DATE=e.P569||"",i.DEATH_DATE=e.P570?` – ${e.P570}`:"",i.LIFE_SPAN=`${e.P569||"birth year unknown"}${e.P570?` – ${e.P570}`:""}`,i.BIRTH_DETAILS=e.P569?`${e.P569}${e.P19?` in ${e.P19}`:""}`:"",i.DEATH_DETAILS=e.P570?`, died ${e.P570}${e.P20?` in ${e.P20}`:""}`:"",i.NATIONALITY=e.P27||this.extractNationalityFromDescription(n.description),i.OCCUPATION=e.P106||this.extractOccupationFromDescription(n.description),i.NOTABLE_FOR=e.P800?` known for ${e.P800}`:"",i.PRONOUN="They",i.ACHIEVEMENT=this.extractAchievementFromDescription(n.description),i.EDUCATION=e.P69?` ${i.PRONOUN} studied at ${e.P69}.`:"",i.CAREER="",i.MAIN_WORK=e.P800||this.extractMainWorkFromDescription(n.description),i.EARLY_LIFE="",i.CAREER_DETAILS="",i.LEGACY="",i.ARTICLE=this.getArticle(i.NATIONALITY);break;case o.LOCATION:i.NAME="",i.TYPE="",i.PARENT_LOCATION=e.P131||e.P17||"",i.POPULATION=e.P1082||"",i.POPULATION_INFO=e.P1082?` It has a population of ${e.P1082}.`:"",i.POPULATION_DETAILS=e.P1082?`The population is ${e.P1082}.`:"",i.AREA_INFO=e.P2046?` The area is ${e.P2046} square kilometers.`:"",i.SIGNIFICANCE="",i.HISTORY=e.P571?` It was established in ${e.P571}.`:"",i.ADMIN_INFO="",i.GEOGRAPHY="",i.ECONOMY="",i.CULTURE="",i.ARTICLE="a";break;case o.ORGANIZATION:i.NAME=n.title,i.FOUNDING_DATE=e.P571?` ${e.P571}`:"",i.FOUNDER=e.P112?` founded by ${e.P112}`:"",i.HQ=e.P159?` headquartered in ${e.P159}`:"",i.DESCRIPTION=n.description?` ${n.description}`:"",i.ARTICLE=this.getArticle("organization");break;case o.CONCEPT:i.NAME=n.title,i.SUBCLASS=e.P279||"concept",i.DESCRIPTION=n.description?` ${n.description}`:"",i.ARTICLE=this.getArticle("concept");break;case o.CREATIVE_WORK:i.NAME=n.title,i.TYPE=e.P31||"",i.AUTHOR=e.P50?` by ${e.P50}`:"",i.DATE=e.P577?` published in ${e.P577}`:"",i.DESCRIPTION=n.description?` ${n.description}`:"",i.ARTICLE=this.getArticle("work");break;case o.EVENT:i.NAME=n.title,i.DATE=e.P585||"",i.LOCATION=e.P131?` in ${e.P131}`:"",i.DESCRIPTION=n.description?` ${n.description}`:"",i.ARTICLE=this.getArticle("event");break}return i}getArticle(e){return e&&["a","e","i","o","u"].includes(e.toLowerCase().charAt(0))?"an":"a"}getCharacteristicsFromDescription(e){return e.includes("large")?" It is known for its large size.":e.includes("small")?" It is a small species.":e.includes("carnivorous")?" It is a carnivorous animal.":""}getSignificanceFromDescription(e){return e.includes("endangered")?" It is considered an endangered species.":e.includes("apex predator")?" It is an apex predator in its ecosystem.":""}extractNationalityFromDescription(e){const t=["American","British","German","French","Indian","Chinese","Japanese"];for(const n of t)if(e.includes(n.toLowerCase()))return n;return""}extractOccupationFromDescription(e){const t=["scientist","writer","politician","artist","musician","actor","director","philosopher","mathematician"];for(const n of t)if(e.includes(n))return n;return""}extractAchievementFromDescription(e){return e.includes("Nobel")?"won the Nobel Prize":e.includes("discovered")?"made significant discoveries":e.includes("invented")?"made important inventions":"made notable contributions to their field"}extractMainWorkFromDescription(e){return e.includes("theory")?"theoretical work":e.includes("novel")?"literary works":e.includes("film")?"cinematic works":"their professional work"}fillTemplate(e,t){let n=e;return Object.entries(t).forEach(([i,a])=>{n=n.replace(new RegExp(`{{${i}}}`,"g"),a)}),n=n.replace(/{{[^}]+}}/g,""),n=n.replace(/\s+/g," ").trim(),n=n.replace(/\s+([.,;!?])/g,"$1"),n}getDefaultLeads(e){return{formal:`${e.title} is ${e.description}.`,concise:`${e.title} is ${e.description}.`,detailed:`${e.title} is ${e.description}.`}}}class ce{constructor(e){l(this,"intelligentTemplates",new Map);l(this,"wikipediaPatterns",[]);this._wikidataService=e,this.initializeWikipediaPatterns(),this.initializeIntelligentTemplates()}initializeWikipediaPatterns(){this.wikipediaPatterns.push({category:o.PERSON,subcategory:"scientist",patterns:{opening:["{{NAME}} ({{DATES}}) was an {{NATIONALITY}} {{FIELD}} who {{MAIN_CONTRIBUTION}}","{{NAME}} ({{DATES}}) was {{ARTICLE}} {{NATIONALITY}} {{PROFESSION}} and {{SECONDARY_FIELD}}"],biographical:["Although few details of {{PRONOUN_POSSESSIVE}} life are known, {{PRONOUN}} is considered one of {{ACHIEVEMENT_LEVEL}}","{{PRONOUN}} developed many devices in fields such as {{FIELDS_LIST}}"],scientific:["{{PRONOUN}} anticipated modern {{FIELD}} by {{METHOD}}","{{PRONOUN_POSSESSIVE}} main discoveries include {{DISCOVERIES_LIST}}"],geographical:[]},contextualChips:["+ scientific field","+ major discovery","+ research method","+ theoretical contribution","+ practical applications","+ scientific impact"],evidenceFromFeatured:['Archimedes: "Ancient Greek mathematician, physicist, engineer"','Edison: "American inventor and businessman who developed many devices"','Faraday: "English chemist and physicist who contributed to electrochemistry"']}),this.wikipediaPatterns.push({category:o.LOCATION,subcategory:"city",patterns:{opening:["{{NAME}} is a {{TYPE}} and {{ADMINISTRATIVE_ROLE}} in {{REGION}}","{{NAME}} is {{ARTICLE}} {{TYPE}} in {{REGION}} with a population of {{POPULATION}}"],geographical:["It is the {{RANKING}} city in {{COUNTRY}} by {{METRIC}}","{{NAME}} borders {{NEIGHBORING_AREAS}} and forms {{METROPOLITAN_AREA}}"],biographical:[],scientific:[]},contextualChips:["+ city type","+ metropolitan status","+ regional significance","+ administrative role","+ population ranking","+ geographical features"],evidenceFromFeatured:['Birmingham: "city and metropolitan borough in the metropolitan county"','Naples: "regional capital of Campania and third-largest city of Italy"']}),this.wikipediaPatterns.push({category:o.SPECIES,subcategory:"bird",patterns:{opening:["The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TYPE}} native to {{HABITAT}}","The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} species of {{BROADER_TYPE}}"],scientific:["It is one of {{NUMBER}} extant species of {{GROUP}}","It derives its name from its {{DISTINCTIVE_FEATURE}}"],geographical:[],biographical:[]},contextualChips:["+ bird type","+ habitat","+ distinctive features","+ conservation status","+ taxonomic classification","+ behavioral traits"],evidenceFromFeatured:['Common Ostrich: "species of flightless bird native to certain areas of Africa"','Shoebill: "large long-legged wading bird" with "enormous shoe-shaped bill"']})}initializeIntelligentTemplates(){const e={category:o.PERSON,subcategories:new Map([["scientist",{name:"Scientist/Researcher",detectionKeywords:["scientist","researcher","mathematician","physicist","chemist","biologist","engineer","inventor"],templates:{formal:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{SCIENTIFIC_FIELD}} who {{MAJOR_CONTRIBUTION}}. {{PRONOUN_POSSESSIVE}} main discoveries include {{DISCOVERIES}}{{CAREER_CONTEXT}}{{LEGACY_IMPACT}}",concise:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{SCIENTIFIC_FIELD}} known for {{PRIMARY_DISCOVERY}}.",detailed:"{{FULL_NAME}} ({{BIRTH_DETAILS}}{{DEATH_DETAILS}}) was {{ARTICLE}} {{NATIONALITY}} {{SCIENTIFIC_FIELD}} and {{SECONDARY_ROLES}}. {{EARLY_CAREER}} {{PRONOUN_POSSESSIVE}} major contributions include {{DETAILED_DISCOVERIES}}{{METHODOLOGY}}{{RECOGNITION}}{{HISTORICAL_IMPACT}}"},contextualChips:["+ scientific field","+ major discovery","+ research method","+ theoretical contribution","+ practical applications","+ scientific institutions","+ awards received","+ historical significance"],wikipediaEvidence:["Archimedes: mathematician, physicist, engineer, astronomer, and inventor","Edison: inventor and businessman who developed many devices","Faraday: chemist and physicist who contributed to electrochemistry and electromagnetism"]}],["artist",{name:"Artist/Creative",detectionKeywords:["artist","painter","sculptor","writer","author","composer","musician","director"],templates:{formal:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{ARTISTIC_MEDIUM}} known for {{ARTISTIC_STYLE}}. {{PRONOUN_POSSESSIVE}} notable works include {{MAJOR_WORKS}}{{ARTISTIC_MOVEMENT}}{{CULTURAL_IMPACT}}",concise:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{ARTISTIC_MEDIUM}} known for {{PRIMARY_WORK}}.",detailed:"{{FULL_NAME}} ({{BIRTH_DETAILS}}{{DEATH_DETAILS}}) was {{ARTICLE}} {{NATIONALITY}} {{ARTISTIC_MEDIUM}} who {{ARTISTIC_INNOVATION}}. {{EARLY_DEVELOPMENT}} {{PRONOUN_POSSESSIVE}} body of work spans {{ARTISTIC_RANGE}}{{CULTURAL_CONTEXT}}{{LASTING_INFLUENCE}}"},contextualChips:["+ artistic medium","+ artistic style","+ notable works","+ artistic movement","+ cultural influence","+ creative innovations","+ exhibitions","+ critical reception"],wikipediaEvidence:["Pattern to be developed from featured artist articles"]}],["politician",{name:"Political Figure",detectionKeywords:["politician","president","minister","senator","governor","mayor","leader"],templates:{formal:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{POLITICAL_POSITION}} who {{MAJOR_POLICIES}}. {{PRONOUN}} served as {{OFFICES_HELD}}{{POLITICAL_ACHIEVEMENTS}}{{HISTORICAL_CONTEXT}}",concise:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{POLITICAL_POSITION}} known for {{PRIMARY_POLICY}}.",detailed:"{{FULL_NAME}} ({{BIRTH_DETAILS}}{{DEATH_DETAILS}}) was {{ARTICLE}} {{NATIONALITY}} {{POLITICAL_POSITION}} and {{SECONDARY_ROLES}}. {{POLITICAL_CAREER}} {{PRONOUN_POSSESSIVE}} administration focused on {{POLICY_AREAS}}{{POLITICAL_LEGACY}}{{HISTORICAL_SIGNIFICANCE}}"},contextualChips:["+ political position","+ political party","+ major policies","+ political achievements","+ offices held","+ political reforms","+ electoral history","+ political legacy"],wikipediaEvidence:["Pattern to be developed from featured political figures"]}]]),defaultTemplate:{formal:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}} who {{ACHIEVEMENT}}. {{PRONOUN}} {{CAREER_SUMMARY}}{{NOTABLE_CONTRIBUTIONS}}{{RECOGNITION}}",concise:"{{FULL_NAME}} ({{LIFE_SPAN}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}} known for {{MAIN_CONTRIBUTION}}.",detailed:"{{FULL_NAME}} ({{BIRTH_DETAILS}}{{DEATH_DETAILS}}) was {{ARTICLE}} {{NATIONALITY}} {{OCCUPATION}} who {{DETAILED_ACHIEVEMENT}}. {{BACKGROUND}} {{CAREER_DETAILS}}{{LEGACY}}"},intelligentProperties:["P569","P570","P19","P20","P27","P106","P69","P166","P800","P101","P108","P512","P184","P185"]},t={category:o.LOCATION,subcategories:new Map([["city",{name:"City/Urban Area",detectionKeywords:["city","town","municipality","urban","metropolitan"],templates:{formal:"{{NAME}} is {{ARTICLE}} {{CITY_TYPE}} and {{ADMINISTRATIVE_ROLE}} in {{REGION}}. {{POPULATION_CONTEXT}}{{GEOGRAPHICAL_SIGNIFICANCE}}{{ADMINISTRATIVE_DETAILS}}{{ECONOMIC_ROLE}}",concise:"{{NAME}} is {{ARTICLE}} {{CITY_TYPE}} in {{REGION}} with a population of {{POPULATION}}.",detailed:"{{NAME}} is {{ARTICLE}} {{CITY_TYPE}} located in {{DETAILED_LOCATION}}. {{ADMINISTRATIVE_STATUS}} {{DEMOGRAPHIC_DETAILS}}{{GEOGRAPHICAL_FEATURES}}{{ECONOMIC_OVERVIEW}}{{CULTURAL_SIGNIFICANCE}}{{HISTORICAL_CONTEXT}}"},contextualChips:["+ city type","+ metropolitan status","+ administrative role","+ population ranking","+ regional significance","+ economic importance","+ cultural landmarks","+ transportation hub"],wikipediaEvidence:['Birmingham: "city and metropolitan borough in the metropolitan county"','Naples: "regional capital and third-largest city of Italy"']}],["geographical_feature",{name:"Natural Feature",detectionKeywords:["mountain","river","lake","forest","desert","valley","island"],templates:{formal:"{{NAME}} is {{ARTICLE}} {{FEATURE_TYPE}} located in {{REGION}}. {{GEOGRAPHICAL_DETAILS}}{{FORMATION_INFO}}{{ECOLOGICAL_SIGNIFICANCE}}{{HUMAN_INTERACTION}}",concise:"{{NAME}} is {{ARTICLE}} {{FEATURE_TYPE}} in {{REGION}} known for {{PRIMARY_CHARACTERISTIC}}.",detailed:"{{NAME}} is {{ARTICLE}} {{FEATURE_TYPE}} situated in {{DETAILED_LOCATION}}. {{FORMATION_HISTORY}} {{PHYSICAL_CHARACTERISTICS}}{{ECOLOGICAL_ROLE}}{{CULTURAL_IMPORTANCE}}{{CONSERVATION_STATUS}}"},contextualChips:["+ geographical type","+ formation process","+ physical characteristics","+ ecological role","+ conservation status","+ human activities","+ cultural significance","+ scientific importance"],wikipediaEvidence:["Pattern to be developed from featured geographical articles"]}]]),defaultTemplate:{formal:"{{NAME}} is {{ARTICLE}} {{TYPE}} in {{PARENT_LOCATION}}. {{POPULATION_INFO}}{{AREA_INFO}}{{SIGNIFICANCE}}{{HISTORY}}",concise:"{{NAME}} is {{ARTICLE}} {{TYPE}} in {{PARENT_LOCATION}} with {{PRIMARY_STATISTIC}}.",detailed:"{{NAME}} is {{ARTICLE}} {{TYPE}} located in {{PARENT_LOCATION}}. {{ADMIN_INFO}} {{DETAILED_STATISTICS}}{{GEOGRAPHY}}{{ECONOMY}}{{CULTURE}}"},intelligentProperties:["P31","P17","P131","P1082","P2046","P571","P421","P281","P36","P610","P706","P206"]},n={category:o.SPECIES,subcategories:new Map([["bird",{name:"Avian Species",detectionKeywords:["bird","avian","eagle","hawk","duck","sparrow","owl","parrot"],templates:{formal:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{BIRD_TYPE}} native to {{HABITAT_REGIONS}}. {{TAXONOMIC_CONTEXT}}{{PHYSICAL_CHARACTERISTICS}}{{BEHAVIORAL_TRAITS}}{{CONSERVATION_STATUS}}",concise:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{BIRD_TYPE}} found in {{PRIMARY_HABITAT}}.",detailed:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} species of {{DETAILED_TYPE}} belonging to {{TAXONOMIC_CLASSIFICATION}}. {{EVOLUTIONARY_CONTEXT}} {{DETAILED_MORPHOLOGY}}{{ECOLOGICAL_ROLE}}{{REPRODUCTION}}{{DISTRIBUTION}}{{CONSERVATION_EFFORTS}}"},contextualChips:["+ bird type","+ habitat","+ migration patterns","+ feeding behavior","+ nesting habits","+ conservation status","+ distinctive features","+ ecological role"],wikipediaEvidence:['Common Ostrich: "species of flightless bird native to certain areas of Africa"','Shoebill: "large long-legged wading bird" with distinctive bill']}],["mammal",{name:"Mammalian Species",detectionKeywords:["mammal","primate","carnivore","herbivore","rodent","cetacean"],templates:{formal:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{MAMMAL_TYPE}} native to {{HABITAT_REGIONS}}. {{TAXONOMIC_POSITION}}{{SIZE_CHARACTERISTICS}}{{SOCIAL_BEHAVIOR}}{{CONSERVATION_STATUS}}",concise:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{MAMMAL_TYPE}} found in {{PRIMARY_HABITAT}}.",detailed:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} species of {{DETAILED_TYPE}} in the {{FAMILY}} family. {{EVOLUTIONARY_HISTORY}} {{PHYSICAL_DESCRIPTION}}{{BEHAVIORAL_ECOLOGY}}{{REPRODUCTION_LIFECYCLE}}{{DISTRIBUTION_RANGE}}{{HUMAN_INTERACTION}}"},contextualChips:["+ mammal type","+ habitat","+ social structure","+ diet","+ reproduction","+ conservation status","+ human interaction","+ evolutionary significance"],wikipediaEvidence:["Pattern to be developed from featured mammal articles"]}]]),defaultTemplate:{formal:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} of {{PARENT_TAXON}}{{CONSERVATION_STATUS}}. {{RANGE_INFO}}{{CHARACTERISTICS}}{{DISCOVERY_INFO}}",concise:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} native to {{HABITAT}}.",detailed:"The {{COMMON_NAME}} ({{SCIENTIFIC_NAME}}) is {{ARTICLE}} {{TAXON_RANK}} of {{PARENT_TAXON}} in the {{FAMILY}} family. {{DETAILED_CLASSIFICATION}} {{MORPHOLOGY}}{{ECOLOGY}}{{BEHAVIOR}}{{DISTRIBUTION}}"},intelligentProperties:["P225","P171","P105","P141","P183","P181","P1843","P935","P2067","P2048","P2049","P2044"]};this.intelligentTemplates.set(o.PERSON,e),this.intelligentTemplates.set(o.LOCATION,t),this.intelligentTemplates.set(o.SPECIES,n)}async generateIntelligentLeads(e,t){var c,p;const n=this.intelligentTemplates.get(t);if(!n)return this.generateFallbackLeads(e,t);const i=this.detectSubcategory(e,n),a=i&&((c=n.subcategories.get(i))==null?void 0:c.templates)||n.defaultTemplate,s=i?((p=n.subcategories.get(i))==null?void 0:p.contextualChips)||[]:this.getDefaultChipsForCategory(t),r=await this.fetchIntelligentProperties(e.id,n,e,i);return{formal:this.fillIntelligentTemplate(a.formal,r),concise:this.fillIntelligentTemplate(a.concise,r),detailed:this.fillIntelligentTemplate(a.detailed,r),contextualChips:s}}detectSubcategory(e,t){const n=e.description.toLowerCase();for(const[i,a]of t.subcategories)if(a.detectionKeywords.some(s=>n.includes(s.toLowerCase())))return i}async fetchIntelligentProperties(e,t,n,i){if(!e)return this.mapIntelligentPlaceholders({},t.category,n,i);const a=t.intelligentProperties,s=await I.getEntityProperties(e,a),r=[];Object.values(s).forEach(d=>{typeof d=="string"&&d.match(/^Q\d+$/)&&r.push(d)});const c=await I.resolveEntityNames(r),p={};return Object.entries(s).forEach(([d,h])=>{typeof h=="string"&&h.match(/^Q\d+$/)?p[d]=c[h]||h:p[d]=h}),this.mapIntelligentPlaceholders(p,t.category,n,i)}mapIntelligentPlaceholders(e,t,n,i){switch(t){case o.PERSON:return this.mapPersonPlaceholders(e,n,i);case o.LOCATION:return this.mapLocationPlaceholders(e,n,i);case o.SPECIES:return this.mapSpeciesPlaceholders(e,n,i);default:return{}}}mapPersonPlaceholders(e,t,n){const i={};return i.FULL_NAME=this.getSmartEntityName(t),i.NAME=i.FULL_NAME,i.LIFE_SPAN=this.formatLifeSpan(e.P569,e.P570),i.BIRTH_DETAILS=this.formatBirthDetails(e.P569,e.P19),i.DEATH_DETAILS=this.formatDeathDetails(e.P570,e.P20),i.NATIONALITY=e.P27||this.extractNationalityFromDescription(t.description),i.ARTICLE=this.getArticle(i.NATIONALITY),i.PRONOUN=this.getPersonPronoun(e),i.PRONOUN_POSSESSIVE=this.getPossessivePronoun(e),n==="scientist"?(i.SCIENTIFIC_FIELD=this.extractScientificField(e.P106,t.description),i.MAJOR_CONTRIBUTION=this.extractMajorContribution(t.description),i.DISCOVERIES=this.formatDiscoveries(e.P800),i.PRIMARY_DISCOVERY=this.extractPrimaryDiscovery(t.description),i.CAREER_CONTEXT=this.generateCareerContext(e),i.LEGACY_IMPACT=this.generateLegacyImpact(t.description)):n==="artist"&&(i.ARTISTIC_MEDIUM=this.extractArtisticMedium(e.P106,t.description),i.ARTISTIC_STYLE=this.extractArtisticStyle(t.description),i.MAJOR_WORKS=this.formatMajorWorks(e.P800)),i}mapLocationPlaceholders(e,t,n){const i={};return i.NAME=this.getSmartEntityName(t),i.REGION=e.P131||e.P17||this.inferRegionFromTitle(t.title),i.ARTICLE=this.getArticle("city"),(n||"city")==="city"&&(i.CITY_TYPE=this.extractCityType(e.P31,t.description)||"city",i.ADMINISTRATIVE_ROLE=this.extractAdministrativeRole(e,t.description)||"city",i.POPULATION=e.P1082||"+ population",i.POPULATION_CONTEXT=this.generatePopulationContext(e.P1082,e)||" with a population of + population",i.GEOGRAPHICAL_SIGNIFICANCE=this.extractGeographicalSignificance(t.description)||"",i.DETAILED_LOCATION=e.P131||e.P17||"+ state/province, + country",i.ADMINISTRATIVE_STATUS="It serves as + administrative role",i.DEMOGRAPHIC_DETAILS="The population is + population as of + year",i.GEOGRAPHICAL_FEATURES="The city is known for + geographical features",i.ECONOMIC_OVERVIEW="The economy is based on + economic sectors",i.CULTURAL_SIGNIFICANCE="It is notable for + cultural aspects",i.HISTORICAL_CONTEXT="The city was + historical information"),i}mapSpeciesPlaceholders(e,t,n){const i={};return i.COMMON_NAME=e.P1843||this.getSmartEntityName(t),i.SCIENTIFIC_NAME=e.P225||"",i.ARTICLE=this.getArticle(i.COMMON_NAME),n==="bird"&&(i.BIRD_TYPE=this.extractBirdType(e.P105,t.description),i.HABITAT_REGIONS=this.formatHabitatRegions(e.P183),i.TAXONOMIC_CONTEXT=this.generateTaxonomicContext(e),i.PHYSICAL_CHARACTERISTICS=this.extractPhysicalCharacteristics(t.description)),i}getSmartEntityName(e){return e.title.includes("[")||e.title.includes("+")||e.title.match(/^(new topic|untitled|article)/i)||e.title.toLowerCase().includes("example")||e.title.toLowerCase().includes("placeholder")?'<span class="detail-chip" data-detail="entity_name">entity name</span>':e.title}formatLifeSpan(e,t){return!e&&!t?'<span class="detail-chip" data-detail="birth_year">birth year</span>':e&&t?`${e}–${t}`:e?`born ${e}`:'<span class="detail-chip" data-detail="birth_year">birth year</span>'}formatBirthDetails(e,t){return e?t?`${e} in ${t}`:e:""}formatDeathDetails(e,t){return e?t?`, died ${e} in ${t}`:`, died ${e}`:""}extractScientificField(e,t){const n=["mathematician","physicist","chemist","biologist","engineer","astronomer"];for(const i of n)if(t.toLowerCase().includes(i)||e!=null&&e.toLowerCase().includes(i))return i;return e||"scientist"}extractMajorContribution(e){return e.includes("discovered")?"made significant discoveries":e.includes("invented")?"created important inventions":e.includes("theory")?"developed important theories":"made notable contributions to science"}getDefaultChipsForCategory(e){switch(e){case o.PERSON:return["+ nationality","+ occupation","+ birth year","+ achievements","+ education"];case o.LOCATION:return["+ location type","+ population","+ geographical features","+ administrative status"];case o.SPECIES:return["+ scientific classification","+ habitat","+ conservation status","+ physical description"];default:return["+ description","+ category","+ significance"]}}fillIntelligentTemplate(e,t){let n=e;return Object.entries(t).forEach(([i,a])=>{a&&a.trim()&&a!=="undefined"&&(n=n.replace(new RegExp(`{{${i}}}`,"g"),a))}),n=n.replace(/{{([^}]+)}}/g,(i,a)=>{const s=a.toLowerCase().replace(/_/g," ");return`<span class="detail-chip" data-detail="${a.toLowerCase()}">${s}</span>`}),n=n.replace(/\s+/g," ").trim(),n=n.replace(/\s+([.,;!?])/g,"$1"),n}generateFallbackLeads(e,t){return{formal:`${e.title} is ${e.description}.`,concise:`${e.title}: ${e.description}.`,detailed:`${e.title} is ${e.description}.`,contextualChips:this.getDefaultChipsForCategory(t)}}getArticle(e){return e&&["a","e","i","o","u"].includes(e.toLowerCase().charAt(0))?"an":"a"}extractNationalityFromDescription(e){const t=["American","British","German","French","Italian","Spanish","Indian","Chinese","Japanese"];for(const n of t)if(e.includes(n.toLowerCase()))return n;return""}getPersonPronoun(e){return"They"}getPossessivePronoun(e){return"Their"}extractCityType(e,t){return t.toLowerCase().includes("capital")?"capital city":t.toLowerCase().includes("port")?"port city":"city"}extractAdministrativeRole(e,t){return t.toLowerCase().includes("capital")?"capital and administrative center":"administrative center"}generatePopulationContext(e,t){return e?` It has a population of ${e}.`:""}extractGeographicalSignificance(e){return""}extractBirdType(e,t){return t.toLowerCase().includes("flightless")?"flightless bird":t.toLowerCase().includes("wading")?"wading bird":"bird"}formatHabitatRegions(e){return e||"various regions"}generateTaxonomicContext(e){return""}extractPhysicalCharacteristics(e){return""}formatDiscoveries(e){return e||""}extractPrimaryDiscovery(e){return"their work"}generateCareerContext(e){return""}generateLegacyImpact(e){return""}extractArtisticMedium(e,t){return"artist"}extractArtisticStyle(e){return"their distinctive style"}formatMajorWorks(e){return e||""}inferRegionFromTitle(e){const t={jaipur:"Rajasthan, India",mumbai:"Maharashtra, India",delhi:"Delhi, India",bangalore:"Karnataka, India",chennai:"Tamil Nadu, India",kolkata:"West Bengal, India",hyderabad:"Telangana, India",pune:"Maharashtra, India",ahmedabad:"Gujarat, India",surat:"Gujarat, India"},n=e.toLowerCase();return t[n]||"+ region/state, + country"}}class O{constructor(){l(this,"SEMANTIC_PATTERNS",{species:{sizeIndicators:["large","small","tiny","massive","giant","dwarf","medium-sized"],habitats:["forest","jungle","desert","ocean","mountain","grassland","arctic","tropical"],characteristics:["nocturnal","diurnal","carnivorous","herbivorous","omnivorous","predator","endangered"],behaviors:["migratory","territorial","social","solitary","pack-hunting","nest-building"],bodyParts:["tail","wings","claws","fur","scales","feathers","horn","antler","beak"]},person:{professions:["scientist","artist","writer","musician","politician","athlete","inventor","explorer"],achievements:["discovered","invented","founded","wrote","composed","painted","led","revolutionized"],timeMarkers:["ancient","medieval","renaissance","modern","contemporary","19th century","20th century"],nationalityHints:["american","british","french","german","italian","chinese","japanese","indian"]},location:{types:["city","town","village","region","province","state","country","island","mountain"],features:["river","lake","port","capital","historic","coastal","inland","mountainous"],significance:["commercial","cultural","religious","industrial","tourist","administrative"]}});l(this,"KNOWLEDGE_BASE",{commonSizes:{mammal:["1-2 meters long","50-100 kg","medium-sized","cat-sized","dog-sized"],bird:["wingspan of 1-2 meters","0.5-2 kg","pigeon-sized","eagle-sized"],reptile:["0.5-3 meters long","5-50 kg","lizard-like proportions"],fish:["20-60 cm long","1-5 kg","streamlined body"]},typicalHabitats:{mammal:["deciduous forests","tropical rainforests","grasslands","mountainous regions"],bird:["forest canopies","wetlands","coastal areas","open woodlands"],reptile:["arid regions","rocky outcrops","desert areas","warm climates"]},commonFeatures:{mammal:["thick fur coat","powerful limbs","keen sense of smell","social behavior"],bird:["distinctive plumage","strong flight capabilities","melodic calls","seasonal migration"],reptile:["scaled skin","excellent camouflage","heat-seeking behavior","powerful jaws"]}})}async generateContentSuggestions(e,t,n){const i=this.analyzeSemanticContext(e,t),a=[];switch(t){case o.SPECIES:a.push(...this.generateSpeciesSuggestions(i,n));break;case o.PERSON:a.push(...this.generatePersonSuggestions(i,n));break;case o.LOCATION:a.push(...this.generateLocationSuggestions(i,n));break;default:a.push(...this.generateGenericSuggestions(i,n))}return a.filter(s=>s.confidence>.3).sort((s,r)=>r.confidence-s.confidence)}analyzeSemanticContext(e,t){const n=(e.label||e.title||"").toLowerCase(),i=(e.description||"").toLowerCase(),a=`${n} ${i}`;return{entityName:e.label||e.title||"",category:t,description:e.description||"",inferredType:this.inferEntityType(a,t),semanticFeatures:this.extractSemanticFeatures(a,t),relatedConcepts:this.findRelatedConcepts(a,t)}}generateSpeciesSuggestions(e,t){const n=[],i=e.entityName,a=e.inferredType;if(!t||t==="description"){const s=this.inferSize(e);n.push({fieldId:"physical_features",suggestions:[`approximately ${s.size}`,`weighing ${s.weight}`,`characterized by ${this.generatePhysicalFeature(a)}`,`notable for its ${this.generateDistinctiveFeature(e)}`],confidence:.8,reasoning:`Inferred from entity name "${i}" and type "${a}"`,source:"semantic_analysis"});const r=this.inferHabitat(e);n.push({fieldId:"habitat",suggestions:[`${r.primary}`,`${r.secondary}`,`both ${r.primary} and ${r.secondary}`,`primarily in ${r.primary}`],confidence:.7,reasoning:`Based on typical habitats for ${a}`,source:"knowledge_base"}),n.push({fieldId:"size_data",suggestions:[`${s.measurement}`,`ranging from ${s.range}`,`adult specimens measure ${s.measurement}`,`typically ${s.size} in stature`],confidence:.6,reasoning:`Typical size range for ${a} species`,source:"knowledge_base"}),n.push({fieldId:"distinctive_characteristics",suggestions:[`${this.generateDistinctiveFeature(e)}`,`${this.generateBehavioralTrait(e)}`,`${this.generatePhysicalFeature(a)}`,`unique ${this.generateUniqueFeature(e)}`],confidence:.7,reasoning:"Generated from semantic analysis of entity name and description",source:"semantic_analysis"})}return n}generatePersonSuggestions(e,t){const n=[];e.entityName,n.push({fieldId:"profession",suggestions:[this.inferProfession(e),this.inferSecondaryRole(e),`${this.inferProfession(e)} and ${this.inferSecondaryRole(e)}`,this.inferFieldOfWork(e)],confidence:.6,reasoning:"Inferred from context and name patterns",source:"pattern_matching"});const i=this.inferTimePeriod(e);return n.push({fieldId:"time_period",suggestions:[`${i.era}`,`${i.century}`,`active during the ${i.period}`,`lived in the ${i.era}`],confidence:.5,reasoning:"Contextual inference from available information",source:"contextual_inference"}),n}generateLocationSuggestions(e,t){const n=[],i=this.inferLocationType(e);return n.push({fieldId:"location_type",suggestions:[i.primary,i.secondary,i.administrative],confidence:.7,reasoning:"Inferred from entity name and description patterns",source:"pattern_matching"}),n}generateGenericSuggestions(e,t){return[{fieldId:"description",suggestions:[`notable ${e.inferredType}`,`significant ${e.inferredType}`,`important ${e.inferredType}`,`well-known ${e.inferredType}`],confidence:.4,reasoning:"Generic fallback suggestions",source:"pattern_matching"}]}inferEntityType(e,t){switch(t){case o.SPECIES:return e.includes("bird")||e.includes("fly")||e.includes("wing")?"bird":e.includes("mammal")||e.includes("fur")||e.includes("pack")?"mammal":e.includes("fish")||e.includes("aquatic")||e.includes("swim")?"fish":e.includes("reptile")||e.includes("scale")||e.includes("cold")?"reptile":"animal";case o.PERSON:return"person";case o.LOCATION:return"place";default:return"entity"}}extractSemanticFeatures(e,t){const n=[],i=t.toLowerCase(),a=this.SEMANTIC_PATTERNS[i]||{};return Object.values(a).flat().forEach(s=>{typeof s=="string"&&e.includes(s)&&n.push(s)}),n}findRelatedConcepts(e,t){const n=[];return t===o.SPECIES&&(e.includes("forest")&&n.push("woodland creature","tree-dwelling","forest ecosystem"),e.includes("large")&&n.push("apex predator","territorial behavior","pack leader"),e.includes("small")&&n.push("agile movement","quick reflexes","social groups")),n}inferSize(e){const t=e.entityName.toLowerCase(),n=e.description.toLowerCase(),i=e.inferredType;if(t.includes("giant")||n.includes("large"))return{size:"large for its species",weight:"15-25 kg",measurement:"1.2-1.8 meters in length",range:"1.0-2.0 meters"};if(t.includes("mini")||t.includes("dwarf")||n.includes("small"))return{size:"compact and agile",weight:"2-5 kg",measurement:"30-50 cm in length",range:"25-60 cm"};const a=this.KNOWLEDGE_BASE.commonSizes[i]||["medium-sized","5-15 kg","0.5-1.2 meters","0.4-1.5 meters"];return{size:a[2]||"medium-sized",weight:a[1]||"5-15 kg",measurement:a[0]||"0.5-1.2 meters in length",range:a[3]||"0.4-1.5 meters"}}inferHabitat(e){const t=e.semanticFeatures,n=e.inferredType;if(t.includes("forest"))return{primary:"temperate forests",secondary:"woodland areas"};if(t.includes("mountain"))return{primary:"mountainous regions",secondary:"rocky terrain"};const i=this.KNOWLEDGE_BASE.typicalHabitats[n]||["various habitats","diverse environments"];return{primary:i[0]||"natural habitats",secondary:i[1]||"suitable environments"}}generatePhysicalFeature(e){const t=this.KNOWLEDGE_BASE.commonFeatures[e]||["distinctive appearance","notable characteristics"];return t[Math.floor(Math.random()*t.length)]}generateDistinctiveFeature(e){const t=e.entityName.toLowerCase();return t.includes("horn")?"prominent horns":t.includes("stripe")?"distinctive striped pattern":t.includes("wing")?"powerful wing structure":t.includes("tail")?"elongated tail":"unique physical characteristics"}generateBehavioralTrait(e){const t=["territorial behavior","social interaction patterns","nocturnal activity","migratory tendencies","pack hunting behavior"];return t[Math.floor(Math.random()*t.length)]}generateUniqueFeature(e){const t=e.entityName.toLowerCase();return t.includes("saurus")?"prehistoric-like characteristics":t.includes("wing")?"wing configuration":t.includes("claw")?"claw structure":"anatomical adaptations"}inferProfession(e){const t=e.description.toLowerCase(),n=this.SEMANTIC_PATTERNS.person.professions;for(const i of n)if(t.includes(i))return i;return"professional"}inferSecondaryRole(e){const t=["researcher","educator","innovator","leader","pioneer","advocate"];return t[Math.floor(Math.random()*t.length)]}inferFieldOfWork(e){const t=["academic field","professional domain","area of expertise","specialized field"];return t[Math.floor(Math.random()*t.length)]}inferTimePeriod(e){const t=e.description.toLowerCase();return t.includes("ancient")?{era:"ancient times",century:"early centuries",period:"classical period"}:t.includes("modern")?{era:"modern era",century:"20th century",period:"contemporary period"}:{era:"historical period",century:"relevant century",period:"significant era"}}inferLocationType(e){const t=e.entityName.toLowerCase(),n=e.description.toLowerCase();return t.includes("port")||n.includes("port")?{primary:"port city",secondary:"coastal settlement",administrative:"maritime hub"}:t.includes("mount")||n.includes("mountain")?{primary:"mountainous region",secondary:"elevated area",administrative:"highland territory"}:{primary:"geographic location",secondary:"notable place",administrative:"administrative area"}}formatSuggestionsForUI(e){return e.map(t=>({chipId:t.fieldId,chipLabel:this.formatFieldLabel(t.fieldId),suggestedValues:t.suggestions,confidence:t.confidence,placeholder:this.generateContextualPlaceholder(t.fieldId,t.suggestions[0])}))}formatFieldLabel(e){return{physical_features:"Physical Features",habitat:"Habitat",size_data:"Size Information",distinctive_characteristics:"Distinctive Features",profession:"Profession",time_period:"Time Period",location_type:"Location Type"}[e]||e.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}generateContextualPlaceholder(e,t){return`e.g., ${t}`}}class le{constructor(e){l(this,"categorySections",new Map);l(this,"templateUsageCount",new Map);l(this,"contentGenerator");this.wikidataService=e,this.contentGenerator=new O,this.initializeSectionTemplates()}initializeSectionTemplates(){const e={category:o.PERSON,subcategorySections:new Map([["scientist",[{title:"Early life and education",description:"Childhood, family background, and educational journey",icon:"🎓",contentTemplate:"{{NAME}} was born {{BIRTH_DETAILS}}. {{EARLY_EDUCATION}} {{FAMILY_BACKGROUND}} {{EDUCATIONAL_INSTITUTIONS}}",templateVariations:["{{NAME}} entered the world {{BIRTH_DETAILS}}. {{FAMILY_BACKGROUND}} {{EDUCATIONAL_JOURNEY}} shaped their future pursuits.","Born {{BIRTH_DETAILS}}, {{NAME}} showed early promise in academic endeavors. {{FAMILY_INFLUENCE}} {{EDUCATIONAL_FOUNDATION}} provided the groundwork for later achievements.","The early years of {{NAME}} began {{BIRTH_DETAILS}}. {{CHILDHOOD_INFLUENCES}} {{ACADEMIC_DEVELOPMENT}} would prove instrumental in their career.","{{NAME}}'s formative years commenced {{BIRTH_DETAILS}}. {{EARLY_ENVIRONMENT}} {{EDUCATIONAL_PATH}} established the foundation for their scholarly pursuits."],wikidataProperties:["P569","P19","P22","P25","P69","P512"],priority:1,wikipediaEvidence:["Standard section in scientist biographies like Einstein, Newton"]},{title:"Career and research",description:"Professional career, research positions, and major work",icon:"🔬",contentTemplate:"{{NAME}} began {{CAREER_START}} at {{INSTITUTIONS}}. {{RESEARCH_FOCUS}} {{MAJOR_POSITIONS}} {{COLLABORATIONS}}",templateVariations:["{{NAME}}'s professional journey commenced {{CAREER_START}} with {{INSTITUTIONS}}. {{RESEARCH_SPECIALIZATION}} {{CAREER_PROGRESSION}} {{SCIENTIFIC_COLLABORATIONS}}","The scientific career of {{NAME}} took shape {{CAREER_START}} at {{INSTITUTIONS}}. {{RESEARCH_DIRECTION}} {{PROFESSIONAL_DEVELOPMENT}} {{ACADEMIC_PARTNERSHIPS}}","{{NAME}} embarked on their research path {{CAREER_START}} through {{INSTITUTIONS}}. {{INVESTIGATIVE_FOCUS}} {{CAREER_ADVANCEMENT}} {{COLLABORATIVE_EFFORTS}}"],wikidataProperties:["P108","P101","P184","P185","P800"],priority:2,wikipediaEvidence:["Essential section in scientific biographies"]},{title:"Major discoveries",description:"Key scientific contributions and breakthrough discoveries",icon:"💡",contentTemplate:"{{NAME}} is best known for {{MAJOR_DISCOVERY}}. {{DISCOVERY_DETAILS}} {{SCIENTIFIC_IMPACT}} {{RECOGNITION}}",wikidataProperties:["P800","P166","P2184"],priority:3,wikipediaEvidence:["Core section highlighting scientific achievements"]},{title:"Legacy and influence",description:"Long-term impact on science and society",icon:"🏛️",contentTemplate:"{{NAME}}'s work has had lasting impact on {{FIELD}}. {{INFLUENCE_ON_OTHERS}} {{MODERN_APPLICATIONS}} {{COMMEMORATIONS}}",wikidataProperties:["P166","P2184","P1411"],priority:4,wikipediaEvidence:["Standard conclusion section in notable scientist articles"]}]],["artist",[{title:"Early life",description:"Childhood and formative experiences",icon:"👶",contentTemplate:"{{NAME}} was born {{BIRTH_DETAILS}}. {{EARLY_INFLUENCES}} {{FAMILY_ARTISTIC_BACKGROUND}}",wikidataProperties:["P569","P19","P22","P25"],priority:1},{title:"Artistic development",description:"Training, influences, and style evolution",icon:"🎨",contentTemplate:"{{NAME}} developed {{ARTISTIC_STYLE}} through {{TRAINING}}. {{INFLUENCES}} {{STYLE_EVOLUTION}}",wikidataProperties:["P69","P184","P135"],priority:2},{title:"Major works",description:"Notable creations and masterpieces",icon:"🖼️",contentTemplate:"Among {{NAME}}'s most celebrated works are {{MAJOR_WORKS}}. {{WORK_DESCRIPTIONS}} {{CRITICAL_RECEPTION}}",wikidataProperties:["P800","P1441"],priority:3}]],["politician",[{title:"Political career",description:"Rise to power and major political positions",icon:"🏛️",contentTemplate:"{{NAME}} entered politics {{CAREER_START}}. {{MAJOR_POSITIONS}} {{POLITICAL_ACHIEVEMENTS}}",wikidataProperties:["P39","P102","P1365","P1366"],priority:1},{title:"Policies and reforms",description:"Major policy initiatives and governmental reforms",icon:"📜",contentTemplate:"During {{TENURE}}, {{NAME}} implemented {{MAJOR_POLICIES}}. {{POLICY_IMPACT}} {{REFORMS}}",wikidataProperties:["P39","P793"],priority:2}]]]),defaultSections:[{title:"Personal life",description:"Family, relationships, and personal interests",icon:"👥",contentTemplate:"{{NAME}} {{PERSONAL_DETAILS}}. {{FAMILY_INFO}} {{PERSONAL_INTERESTS}}",wikidataProperties:["P26","P40","P551"],priority:5},{title:"Death and legacy",description:"Final years and posthumous recognition",icon:"⚰️",contentTemplate:"{{NAME}} died {{DEATH_DETAILS}}. {{LEGACY}} {{MEMORIALS}} {{CONTINUING_INFLUENCE}}",wikidataProperties:["P570","P20","P509"],priority:6}]},t={category:o.LOCATION,subcategorySections:new Map([["city",[{title:"History",description:"Historical development and founding",icon:"📚",contentTemplate:"{{NAME}} was {{FOUNDING_DETAILS}}. {{HISTORICAL_DEVELOPMENT}} {{MAJOR_HISTORICAL_EVENTS}}",wikidataProperties:["P571","P112","P793"],priority:1,wikipediaEvidence:["Standard section in city articles like Paris, London"]},{title:"Geography",description:"Physical location, climate, and geographical features",icon:"🗺️",contentTemplate:"{{NAME}} is located {{GEOGRAPHICAL_POSITION}}. {{CLIMATE}} {{GEOGRAPHICAL_FEATURES}} {{TOPOGRAPHY}}",wikidataProperties:["P625","P206","P706","P2044"],priority:2,wikipediaEvidence:["Essential geographical information section"]},{title:"Demographics",description:"Population statistics and demographic composition",icon:"👥",contentTemplate:"As of {{CENSUS_YEAR}}, {{NAME}} has a population of {{POPULATION}}. {{DEMOGRAPHIC_BREAKDOWN}} {{POPULATION_TRENDS}}",wikidataProperties:["P1082","P6"],priority:3,wikipediaEvidence:["Standard demographic section in city articles"]},{title:"Economy",description:"Economic activities and major industries",icon:"💼",contentTemplate:"{{NAME}}'s economy is based on {{MAJOR_INDUSTRIES}}. {{ECONOMIC_INDICATORS}} {{MAJOR_EMPLOYERS}}",wikidataProperties:["P1081","P2131"],priority:4,wikipediaEvidence:["Important section for understanding city significance"]},{title:"Culture and attractions",description:"Cultural institutions, landmarks, and tourist attractions",icon:"🎭",contentTemplate:"{{NAME}} is known for {{CULTURAL_ATTRACTIONS}}. {{LANDMARKS}} {{CULTURAL_INSTITUTIONS}} {{FESTIVALS}}",wikidataProperties:["P1435","P138"],priority:5,wikipediaEvidence:["Highlights what makes the city notable culturally"]}]],["geographical_feature",[{title:"Formation",description:"Geological formation and natural history",icon:"🌋",contentTemplate:"{{NAME}} was formed {{FORMATION_PROCESS}}. {{GEOLOGICAL_HISTORY}} {{FORMATION_TIMELINE}}",wikidataProperties:["P571","P2673"],priority:1},{title:"Physical characteristics",description:"Size, elevation, and physical properties",icon:"📏",contentTemplate:"{{NAME}} {{PHYSICAL_DIMENSIONS}}. {{ELEVATION_DATA}} {{PHYSICAL_PROPERTIES}}",wikidataProperties:["P2044","P2048","P2049","P2046"],priority:2}]]]),defaultSections:[{title:"Climate",description:"Weather patterns and seasonal variations",icon:"🌡️",contentTemplate:"{{NAME}} experiences {{CLIMATE_TYPE}}. {{SEASONAL_PATTERNS}} {{WEATHER_EXTREMES}}",wikidataProperties:["P2564"],priority:6}]},n={category:o.SPECIES,subcategorySections:new Map([["bird",[{title:"Description",description:"Physical appearance and distinguishing features",icon:"🔍",contentTemplate:"The {{COMMON_NAME}} {{PHYSICAL_DESCRIPTION}}. {{DISTINGUISHING_FEATURES}} {{SIZE_COMPARISON}}",wikidataProperties:["P2067","P2048","P2049"],priority:1,wikipediaEvidence:["Standard opening section in bird articles"]},{title:"Distribution and habitat",description:"Geographic range and preferred environments",icon:"🌍",contentTemplate:"The {{COMMON_NAME}} is found in {{GEOGRAPHIC_RANGE}}. {{HABITAT_PREFERENCES}} {{SEASONAL_MOVEMENTS}}",wikidataProperties:["P183","P1082"],priority:2,wikipediaEvidence:["Essential for understanding species ecology"]},{title:"Behavior",description:"Feeding, breeding, and social behaviors",icon:"🐦",contentTemplate:"{{COMMON_NAME}} {{FEEDING_BEHAVIOR}}. {{BREEDING_BEHAVIOR}} {{SOCIAL_STRUCTURE}}",wikidataProperties:["P1303","P1589"],priority:3,wikipediaEvidence:["Key behavioral information section"]},{title:"Conservation status",description:"Population trends and conservation efforts",icon:"🛡️",contentTemplate:"The {{COMMON_NAME}} is classified as {{CONSERVATION_STATUS}}. {{POPULATION_TRENDS}} {{CONSERVATION_EFFORTS}}",wikidataProperties:["P141","P1843"],priority:4,wikipediaEvidence:["Important for species protection awareness"]}]],["mammal",[{title:"Physical characteristics",description:"Size, appearance, and anatomical features",icon:"📐",contentTemplate:"The {{COMMON_NAME}} {{PHYSICAL_DESCRIPTION}}. {{SIZE_DATA}} {{DISTINCTIVE_FEATURES}}",wikidataProperties:["P2067","P2048"],priority:1},{title:"Ecology and behavior",description:"Habitat use, diet, and behavioral patterns",icon:"🌿",contentTemplate:"{{COMMON_NAME}} {{HABITAT_USE}}. {{DIET}} {{BEHAVIORAL_PATTERNS}}",wikidataProperties:["P183","P1303"],priority:2}]]]),defaultSections:[{title:"Taxonomy",description:"Scientific classification and evolutionary relationships",icon:"🧬",contentTemplate:"The {{COMMON_NAME}} belongs to {{TAXONOMIC_CLASSIFICATION}}. {{EVOLUTIONARY_RELATIONSHIPS}} {{SUBSPECIES}}",wikidataProperties:["P171","P105","P225"],priority:5}]};this.categorySections.set(o.PERSON,e),this.categorySections.set(o.LOCATION,t),this.categorySections.set(o.SPECIES,n)}async getSuggestedSections(e,t){const n=this.categorySections.get(t);if(!n)return this.getGenericSections();const i=this.detectSubcategory(e,t);let a=[];if(i&&n.subcategorySections.has(i)){a=n.subcategorySections.get(i);for(const[s,r]of n.subcategorySections)if(s!==i){const c=r.map(p=>({...p,priority:p.priority+10}));a=[...a,...c]}}else for(const[,s]of n.subcategorySections)a=[...a,...s];return a=[...a,...n.defaultSections],a.sort((s,r)=>s.priority-r.priority),a}async generateSectionContent(e,t,n){try{console.log("DEBUG: Section engine received topic:",t),console.log("DEBUG: Topic title:",t.title),console.log("DEBUG: Topic description:",t.description);const i=await this.contentGenerator.generateContentSuggestions(t,n,e.title.toLowerCase());return await this.generateIntelligentTemplate(e,t,n,i)}catch(i){return console.error("Error generating intelligent section content:",i),this.generateSimpleContextualTemplate(e,t,n)}}async generateIntelligentTemplate(e,t,n,i){const a=t.category||n.toString()||"unknown",s=this.generateContextualEntityName(t.title,a),r=e.title.toLowerCase();return r.includes("physical")||r.includes("characteristics")?this.generatePhysicalCharacteristicsContent(s,n,i):r.includes("habitat")||r.includes("distribution")?this.generateHabitatContent(s,n,i):r.includes("ecology")||r.includes("behavior")?this.generateEcologyContent(s,n,i):r.includes("description")?this.generateDescriptionContent(s,n,i):this.generateGenericSectionContent(s,n,i,r)}generatePhysicalCharacteristicsContent(e,t,n){if(t===o.SPECIES){let i=`${e} is a <span class="detail-chip" data-detail="size_category">medium to large-sized</span> species that typically measures <span class="detail-chip" data-detail="length_measurement">1.2 to 1.8 meters in length</span> and weighs between <span class="detail-chip" data-detail="weight_range">15 to 25 kilograms</span>. Adult specimens display <span class="detail-chip" data-detail="sexual_dimorphism">sexual dimorphism</span>, with males generally being <span class="detail-chip" data-detail="size_difference">10-15% larger</span> than females.

`;return i+=`The most distinctive feature of ${e} is its <span class="detail-chip" data-detail="primary_distinguishing_feature">prominent physical characteristic</span>, which serves both <span class="detail-chip" data-detail="feature_function_1">defensive purposes</span> and <span class="detail-chip" data-detail="feature_function_2">communication functions</span>. The species possesses <span class="detail-chip" data-detail="body_covering">specialized body covering</span> that provides <span class="detail-chip" data-detail="protection_type">environmental protection</span> and aids in <span class="detail-chip" data-detail="adaptive_function">thermoregulation</span>.

`,i+=`The head structure of ${e} is characterized by <span class="detail-chip" data-detail="skull_features">distinctive cranial features</span>, including <span class="detail-chip" data-detail="sensory_organs">highly developed sensory organs</span>. The eyes are <span class="detail-chip" data-detail="eye_description">large and forward-facing</span>, adapted for <span class="detail-chip" data-detail="vision_type">keen visual acuity</span> in <span class="detail-chip" data-detail="lighting_conditions">various lighting conditions</span>. The limbs are <span class="detail-chip" data-detail="limb_structure">powerfully built</span> and equipped with <span class="detail-chip" data-detail="extremity_features">specialized appendages</span> that enable <span class="detail-chip" data-detail="locomotion_ability">efficient movement</span> across <span class="detail-chip" data-detail="terrain_types">diverse terrain types</span>.`,i}else return this.generateGenericSectionContent(e,t,n,"physical characteristics")}generateHabitatContent(e,t,n){if(t===o.SPECIES){let i=`${e} inhabits a diverse range of ecosystems, primarily found in <span class="detail-chip" data-detail="primary_habitat">temperate forest regions</span> across <span class="detail-chip" data-detail="geographic_distribution">continental areas</span>. The species demonstrates remarkable adaptability to various environmental conditions, thriving in <span class="detail-chip" data-detail="habitat_types">multiple habitat types</span> including <span class="detail-chip" data-detail="secondary_habitats">woodland areas, grasslands, and riparian zones</span>.

`;return i+=`The preferred habitat consists of <span class="detail-chip" data-detail="vegetation_type">dense canopy forests</span> with <span class="detail-chip" data-detail="canopy_coverage">60-80% canopy coverage</span>, providing both <span class="detail-chip" data-detail="shelter_benefits">protection from predators</span> and <span class="detail-chip" data-detail="resource_availability">abundant food resources</span>. ${e} typically establishes territories in areas with <span class="detail-chip" data-detail="terrain_features">specific topographical features</span>, such as <span class="detail-chip" data-detail="landscape_elements">rocky outcrops, water sources, and elevated positions</span> that offer strategic advantages.

`,i+='Seasonal migrations occur between <span class="detail-chip" data-detail="seasonal_range_1">breeding grounds</span> and <span class="detail-chip" data-detail="seasonal_range_2">winter refugia</span>, with populations traveling distances of up to <span class="detail-chip" data-detail="migration_distance">several hundred kilometers</span>. Climate change has begun to impact traditional habitat ranges, forcing populations to adapt to <span class="detail-chip" data-detail="climate_adaptations">changing environmental conditions</span> and seek <span class="detail-chip" data-detail="alternative_habitats">alternative suitable areas</span> at <span class="detail-chip" data-detail="elevation_changes">higher elevations or different latitudes</span>.',i}else return this.generateGenericSectionContent(e,t,n,"habitat and distribution")}generateEcologyContent(e,t,n){if(t===o.SPECIES){let i=`${e} exhibits complex behavioral patterns that vary significantly between <span class="detail-chip" data-detail="seasonal_behaviors">seasonal periods</span> and <span class="detail-chip" data-detail="life_stages">different life stages</span>. As a <span class="detail-chip" data-detail="feeding_classification">dietary specialist</span>, the species primarily feeds on <span class="detail-chip" data-detail="primary_food_sources">specific food sources</span>, supplemented by <span class="detail-chip" data-detail="secondary_diet">opportunistic feeding</span> during periods of <span class="detail-chip" data-detail="resource_scarcity">food scarcity</span>.

`;return i+=`Social structure within ${e} populations is characterized by <span class="detail-chip" data-detail="social_organization">hierarchical organization</span>, with individuals forming <span class="detail-chip" data-detail="group_size">stable groups</span> of <span class="detail-chip" data-detail="group_composition">mixed age and sex composition</span>. Communication occurs through a combination of <span class="detail-chip" data-detail="communication_methods">vocalizations, visual displays, and chemical signals</span>, with <span class="detail-chip" data-detail="communication_complexity">over 20 distinct calls</span> documented for different contexts including <span class="detail-chip" data-detail="call_functions">territory defense, mating, and alarm signals</span>.

`,i+='Reproductive behavior follows a <span class="detail-chip" data-detail="breeding_pattern">seasonal breeding pattern</span>, with courtship rituals beginning in <span class="detail-chip" data-detail="breeding_season">early spring</span>. Mating pairs engage in <span class="detail-chip" data-detail="courtship_behavior">elaborate courtship displays</span> that can last for <span class="detail-chip" data-detail="courtship_duration">several weeks</span>. Parental care is <span class="detail-chip" data-detail="parental_strategy">biparental</span>, with both adults participating in <span class="detail-chip" data-detail="care_activities">nest construction, incubation, and offspring protection</span> for approximately <span class="detail-chip" data-detail="care_duration">3-4 months</span> post-hatching.',i}else return this.generateGenericSectionContent(e,t,n,"ecology and behavior")}generateDescriptionContent(e,t,n){let i="";return t===o.SPECIES?(i+=`${e} is <span class="detail-chip" data-detail="taxonomic_classification">a species</span> belonging to the <span class="detail-chip" data-detail="family_classification">family classification</span> within the order <span class="detail-chip" data-detail="order_classification">taxonomic order</span>. The species was first scientifically described in <span class="detail-chip" data-detail="discovery_year">year of description</span> by <span class="detail-chip" data-detail="describing_scientist">taxonomist name</span>, based on specimens collected from <span class="detail-chip" data-detail="type_locality">type locality</span>.

`,i+=`${e} is distinguished from closely related species by several key morphological features, including <span class="detail-chip" data-detail="distinguishing_feature_1">primary distinguishing characteristic</span>, <span class="detail-chip" data-detail="distinguishing_feature_2">secondary feature</span>, and <span class="detail-chip" data-detail="distinguishing_feature_3">tertiary diagnostic trait</span>. The species exhibits <span class="detail-chip" data-detail="phenotypic_variation">phenotypic variation</span> across its range, with <span class="detail-chip" data-detail="subspecies_number">multiple recognized subspecies</span> adapted to different environmental conditions.

`,i+=`Ecologically, ${e} plays a crucial role as <span class="detail-chip" data-detail="ecological_role">keystone species</span> in its ecosystem, serving as both <span class="detail-chip" data-detail="predator_role">predator</span> and <span class="detail-chip" data-detail="prey_role">prey species</span> in complex food webs. The species' conservation status is currently classified as <span class="detail-chip" data-detail="conservation_status">conservation classification</span> due to <span class="detail-chip" data-detail="threat_factors">primary threats</span> including <span class="detail-chip" data-detail="specific_threats">habitat loss, climate change, and human activities</span>.`):t===o.PERSON?(i+=`${e} is <span class="detail-chip" data-detail="profession">professional role</span> known for <span class="detail-chip" data-detail="major_achievements">groundbreaking contributions</span> to <span class="detail-chip" data-detail="field_of_work">area of expertise</span>. Born in <span class="detail-chip" data-detail="birth_year">year</span> in <span class="detail-chip" data-detail="birthplace">location</span>, they pursued <span class="detail-chip" data-detail="education">educational background</span> before establishing themselves as <span class="detail-chip" data-detail="career_description">prominent figure in their field</span>.

`,i+=`Throughout their career, ${e} has been recognized for <span class="detail-chip" data-detail="specific_contributions">specific achievements</span>, earning numerous accolades including <span class="detail-chip" data-detail="awards">prestigious awards</span> and <span class="detail-chip" data-detail="honors">professional honors</span>. Their work has had lasting impact on <span class="detail-chip" data-detail="impact_areas">areas of influence</span>, influencing <span class="detail-chip" data-detail="influenced_fields">related disciplines</span> and inspiring <span class="detail-chip" data-detail="legacy">future generations</span>.`):i+=`${e} is <span class="detail-chip" data-detail="primary_description">comprehensive description</span> characterized by <span class="detail-chip" data-detail="key_features">distinctive features</span> and <span class="detail-chip" data-detail="notable_aspects">significant aspects</span>. <span class="detail-chip" data-detail="historical_context">Historical background</span> and <span class="detail-chip" data-detail="contemporary_relevance">modern significance</span> contribute to its <span class="detail-chip" data-detail="overall_importance">overall importance</span> in <span class="detail-chip" data-detail="relevant_context">relevant field or context</span>.`,i}generateGenericSectionContent(e,t,n,i){return`${e} <span class="detail-chip" data-detail="section_content">${i} information</span>. <span class="detail-chip" data-detail="details">Additional details</span> about <span class="detail-chip" data-detail="specific_information">specific aspects</span>.`}generateSimpleContextualTemplate(e,t,n){const i=t.category||n.toString()||"unknown",a=this.generateContextualEntityName(t.title,i);return this.generateGenericSectionContent(a,n,[],e.title.toLowerCase())}detectSubcategory(e,t){const n=e.description.toLowerCase(),i=this.categorySections.get(t);if(i){for(const[a,s]of i.subcategorySections)if(this.getSubcategoryKeywords(a,t).some(c=>n.includes(c.toLowerCase())))return a}}getSubcategoryKeywords(e,t){var i;return((i={[o.PERSON]:{scientist:["scientist","researcher","mathematician","physicist","chemist","biologist","engineer"],artist:["artist","painter","sculptor","writer","author","composer","musician"],politician:["politician","president","minister","senator","governor","mayor"]},[o.LOCATION]:{city:["city","town","municipality","urban","metropolitan"],geographical_feature:["mountain","river","lake","forest","desert","valley"]},[o.SPECIES]:{bird:["bird","avian","eagle","hawk","duck","sparrow"],mammal:["mammal","primate","carnivore","herbivore","rodent"]}}[t])==null?void 0:i[e])||[]}mapSectionPlaceholders(e,t,n,i){const a={};switch(t||(console.warn("mapSectionPlaceholders: topic is undefined, using fallback"),t={id:"",title:"Entity Name",description:"A person, place, or thing",category:n}),a.NAME=this.getSmartEntityName(t),a.COMMON_NAME=e.P1843||this.getSmartEntityName(t),n){case o.PERSON:this.mapPersonSectionPlaceholders(a,e,t,i);break;case o.LOCATION:this.mapLocationSectionPlaceholders(a,e,t,i);break;case o.SPECIES:this.mapSpeciesSectionPlaceholders(a,e,t,i);break}return a}mapPersonSectionPlaceholders(e,t,n,i){e.BIRTH_DETAILS=this.formatBirthDetails(t.P569,t.P19),e.DEATH_DETAILS=this.formatDeathDetails(t.P570,t.P20),e.EARLY_EDUCATION=t.P69?`${e.NAME} studied at ${t.P69}.`:`${e.NAME} pursued education in relevant fields.`,e.FAMILY_BACKGROUND=t.P22||t.P25?"Coming from an educated family, ":"",e.EDUCATIONAL_INSTITUTIONS=t.P69||"+ educational institutions",e.EDUCATIONAL_JOURNEY=t.P69?`Their academic journey through ${t.P69}`:"Their educational path",e.FAMILY_INFLUENCE=t.P22||t.P25?"Family connections":"Personal motivation",e.EDUCATIONAL_FOUNDATION=t.P512?`earning ${t.P512}`:"building academic credentials",e.CHILDHOOD_INFLUENCES="Early exposure to intellectual pursuits",e.ACADEMIC_DEVELOPMENT=t.P69?`Studies at ${t.P69}`:"Academic preparation",e.EARLY_ENVIRONMENT="The intellectual climate of their youth",e.EDUCATIONAL_PATH=t.P69?`formal education at ${t.P69}`:"scholarly preparation",e.CAREER_START=t.P108?`their career at ${t.P108}`:"their professional career",e.INSTITUTIONS=t.P108||"+ institutions",e.RESEARCH_FOCUS=`${e.NAME} focused on + research areas.`,e.MAJOR_POSITIONS=t.P39?`holding positions including ${t.P39}`:"advancing through various positions",e.RESEARCH_SPECIALIZATION="Their work concentrated on + specialized field",e.CAREER_PROGRESSION="They advanced through + career stages",e.SCIENTIFIC_COLLABORATIONS="working alongside + collaborators",e.RESEARCH_DIRECTION="Their investigations centered on + research focus",e.PROFESSIONAL_DEVELOPMENT="progressing through + professional roles",e.ACADEMIC_PARTNERSHIPS="collaborating with + research partners",e.INVESTIGATIVE_FOCUS="concentrating on + investigation areas",e.CAREER_ADVANCEMENT="rising through + academic positions",e.COLLABORATIVE_EFFORTS="partnering with + fellow researchers",e.MAJOR_DISCOVERY=t.P800||"their groundbreaking work",e.DISCOVERY_DETAILS=`This ${i.title.includes("discover")?"discovery":"work"} demonstrated + key findings.`,e.SCIENTIFIC_IMPACT="The implications of this work were significant for the field.",e.FIELD=this.extractFieldFromDescription(n.description),e.INFLUENCE_ON_OTHERS=`${e.NAME}'s work influenced subsequent researchers and practitioners.`,e.MODERN_APPLICATIONS="Modern applications of this work can be seen in + current examples.",e.PERSONAL_DETAILS=t.P26?`was married to ${t.P26}`:"maintained + personal life",e.FAMILY_INFO=t.P40?`and had ${t.P40} children`:""}mapLocationSectionPlaceholders(e,t,n,i){e.FOUNDING_DETAILS=t.P571?`founded in ${t.P571}`:"established in + founding year",e.HISTORICAL_DEVELOPMENT=`Over the centuries, ${e.NAME} grew from + early settlement to + modern status.`,e.GEOGRAPHICAL_POSITION=t.P625?`at coordinates ${t.P625}`:"in + geographical region",e.CLIMATE=t.P2564||`${e.NAME} experiences + climate type`,e.POPULATION=t.P1082||"+ population number",e.CENSUS_YEAR="+ census year",e.DEMOGRAPHIC_BREAKDOWN="The population consists of + demographic groups.",e.MAJOR_INDUSTRIES="+ primary industries and + secondary industries",e.CULTURAL_ATTRACTIONS="+ major attractions and + cultural sites"}mapSpeciesSectionPlaceholders(e,t,n,i){e.SCIENTIFIC_NAME=t.P225||"+ scientific name",e.PHYSICAL_DESCRIPTION="measures + size and is characterized by + physical features",e.DISTINGUISHING_FEATURES="Key identifying features include + distinctive characteristics.",e.GEOGRAPHIC_RANGE=t.P183||"+ geographical regions",e.HABITAT_PREFERENCES="preferring + habitat types",e.CONSERVATION_STATUS=t.P141||"+ conservation status",e.TAXONOMIC_CLASSIFICATION=t.P171||"+ taxonomic family"}selectTemplateVariation(e){if(!e.templateVariations||e.templateVariations.length===0)return e.contentTemplate;const t=[e.contentTemplate,...e.templateVariations],n=e.title.toLowerCase().replace(/\s+/g,"_");let i=t[0],a=this.templateUsageCount.get(`${n}_0`)||0;t.forEach((c,p)=>{const d=`${n}_${p}`,h=this.templateUsageCount.get(d)||0;h<a&&(a=h,i=c)});const s=t.indexOf(i),r=`${n}_${s}`;return this.templateUsageCount.set(r,(this.templateUsageCount.get(r)||0)+1),i}fillSectionTemplate(e,t){let n=e;return Object.entries(t).forEach(([i,a])=>{a&&a.trim()&&a!=="undefined"&&(n=n.replace(new RegExp(`{{${i}}}`,"g"),a))}),n=n.replace(/{{([^}]+)}}/g,(i,a)=>{const s=this.getIntelligentPlaceholderText(a);return`<span class="detail-chip" data-detail="${a.toLowerCase()}">${s}</span>`}),n=n.replace(/\+\s*\[([^\]]+)\]/g,(i,a)=>`<span class="detail-chip" data-detail="${a.toLowerCase().replace(/\s+/g,"_")}">+ ${a}</span>`),n=n.replace(/\+\s+([a-zA-Z\s]+?)(?=\s*[.!?]|$)/g,(i,a)=>`<span class="detail-chip" data-detail="${a.trim().toLowerCase().replace(/\s+/g,"_")}">+ ${a.trim()}</span>`),n=n.replace(/\s+/g," ").trim(),n}getIntelligentPlaceholderText(e){switch(e.toLowerCase()){case"name":case"common_name":return"entity name";case"physical_description":return"physical description";case"size_data":return"size information";case"distinctive_features":return"distinctive features";case"habitat_use":return"habitat preferences";case"diet":return"dietary habits";case"behavioral_patterns":return"behavioral characteristics";case"physical_dimensions":return"dimensions";case"elevation_data":return"elevation details";case"physical_properties":return"physical properties";case"birth_details":return"birth information";case"family_background":return"family background";case"educational_journey":return"education details";default:return e.toLowerCase().replace(/_/g," ")}}getGenericSections(){return[{title:"Overview",description:"General introduction and background",icon:"📋",contentTemplate:"{{NAME}} is + description. + Additional context and background information.",priority:1},{title:"History",description:"Historical background and development",icon:"📚",contentTemplate:"The history of {{NAME}} + historical information. + Key historical events and developments.",priority:2}]}getSmartEntityName(e){return!e||!e.title||typeof e.title!="string"||e.title.includes("[")||e.title.includes("+")||e.title.match(/^(new topic|untitled|article)/i)||e.title.toLowerCase().includes("example")||e.title.toLowerCase().includes("placeholder")?'<span class="detail-chip" data-detail="entity_name">entity name</span>':this.generateContextualEntityName(e.title,e.category)}generateContextualEntityName(e,t){if(!t||!e)return`**${e||"Entity"}**`;const n=t.toLowerCase(),i=e.toLowerCase();return n==="species"||n.includes("biology")?i.includes("saurus")?`**The ${e}**`:i.includes("bird")||i.includes("fly")?`**The ${e}**`:`**${e}**`:n==="person"?`**${e}**`:n==="location"?`**${e}**`:`**${e}**`}formatBirthDetails(e,t){return e?t?`on ${e} in ${t}`:`on ${e}`:"+ birth information"}formatDeathDetails(e,t){return e?t?`on ${e} in ${t}`:`on ${e}`:"+ death information"}extractFieldFromDescription(e){const t=["mathematics","physics","chemistry","biology","engineering","medicine"];for(const n of t)if(e.toLowerCase().includes(n))return n;return"their field"}}class A{static async detectLinksInText(e){if(!e||e.length<10)return[];try{const t=this.extractLinkCandidates(e),n=[];for(const i of t){const a=await this.validateWikipediaLink(i.text);a.exists&&n.push({text:i.text,wikipediaTitle:a.title,confidence:a.confidence,startIndex:i.startIndex,endIndex:i.endIndex,url:`https://en.wikipedia.org/wiki/${encodeURIComponent(a.title)}`,description:a.description})}return this.removeOverlappingSuggestions(n)}catch(t){return console.error("Error detecting links:",t),[]}}static extractLinkCandidates(e){const t=[],n=/\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g;let i;for(;(i=n.exec(e))!==null;){const r=i[0].trim();r.length<3||r.length>60||this.SKIP_WORDS.has(r.toLowerCase())||t.push({text:r,startIndex:i.index,endIndex:i.index+r.length})}const a=/\b(?:University of|Institute of|College of|School of)\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g;for(;(i=a.exec(e))!==null;){const r=i[0].trim();t.push({text:r,startIndex:i.index,endIndex:i.index+r.length})}const s=[/\b[A-Z][a-z]+\s+(?:University|Institute|College|Hospital|Museum|Library|Center|Centre)\b/g,/\b(?:United States|United Kingdom|New York|Los Angeles|San Francisco|Washington|London|Paris|Berlin|Tokyo|Beijing)\b/g,/\b[A-Z][a-z]+\s+(?:Award|Prize|Medal|Foundation|Society|Association|Organization)\b/g];for(const r of s)for(;(i=r.exec(e))!==null;){const c=i[0].trim();t.push({text:c,startIndex:i.index,endIndex:i.index+c.length})}return t}static async validateWikipediaLink(e){try{const t=new URLSearchParams({action:"opensearch",search:e,format:"json",limit:"3",origin:"*"}),n=await fetch(`${this.WIKIPEDIA_API}?${t}`);if(!n.ok)return{exists:!1,title:e,confidence:0};const i=await n.json(),[a,s,r,c]=i;if(!s||s.length===0)return{exists:!1,title:e,confidence:0};const p=s.find(h=>h.toLowerCase()===e.toLowerCase());if(p){const h=s.indexOf(p);return{exists:!0,title:p,confidence:.95,description:r[h]}}const d=s.find(h=>h.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(h.toLowerCase()));if(d){const h=s.indexOf(d),g=this.calculateSimilarity(e,d);if(g>=this.MIN_CONFIDENCE)return{exists:!0,title:d,confidence:g,description:r[h]}}return{exists:!1,title:e,confidence:0}}catch(t){return console.error(`Error validating Wikipedia link for "${e}":`,t),{exists:!1,title:e,confidence:0}}}static calculateSimilarity(e,t){const n=e.length>t.length?e.toLowerCase():t.toLowerCase(),i=e.length>t.length?t.toLowerCase():e.toLowerCase();if(n.length===0)return 1;const a=this.levenshteinDistance(n,i);return(n.length-a)/n.length}static levenshteinDistance(e,t){const n=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=0;i<=t.length;i++)n[i][0]=i;for(let i=1;i<=t.length;i++)for(let a=1;a<=e.length;a++){const s=e[a-1]===t[i-1]?0:1;n[i][a]=Math.min(n[i][a-1]+1,n[i-1][a]+1,n[i-1][a-1]+s)}return n[t.length][e.length]}static removeOverlappingSuggestions(e){const t=e.sort((i,a)=>a.confidence-i.confidence),n=[];for(const i of t)n.some(s=>i.startIndex>=s.startIndex&&i.startIndex<s.endIndex||i.endIndex>s.startIndex&&i.endIndex<=s.endIndex||i.startIndex<=s.startIndex&&i.endIndex>=s.endIndex)||n.push(i);return n.sort((i,a)=>i.startIndex-a.startIndex)}static createLinkHtml(e){return`<a href="${e.url}" target="_blank" class="wikipedia-link" title="${e.description||e.wikipediaTitle}">${e.text}</a>`}}l(A,"WIKIPEDIA_API","https://en.wikipedia.org/w/api.php"),l(A,"MIN_CONFIDENCE",.7),l(A,"SKIP_WORDS",new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","can","must","shall","this","that","these","those","he","she","it","they","we","you","i","his","her","its","their","our","your","my","me","him","them","us","who","what","when","where","why","how","said","says","went","go","come","came","get","got","make","made","take","took","see","saw","know","knew","think","thought","look","looked","first","last","long","great","little","own","other","old","right","big","high","different","small","large","next","early","young","important","few","public","bad","same","able"]));class de{constructor(){l(this,"currentState","input");l(this,"searchTerm","");l(this,"selectedTopic",null);l(this,"titleInput");l(this,"inputSection");l(this,"categorySection");l(this,"creationSection");l(this,"editingSection");l(this,"categoryList");l(this,"categoryTitle");l(this,"creationTitle");l(this,"chipsContainer");l(this,"creationChipsContainer");l(this,"newTopicBtn");l(this,"startCreatingBtn");l(this,"articleTitleText");l(this,"boldBtn");l(this,"italicBtn");l(this,"linkBtn");l(this,"undoBtn");l(this,"moreBtn");l(this,"articleContent");l(this,"snippetModal");l(this,"snippetTitleSpan");l(this,"snippetCardsContainer");l(this,"snippetCancelBtn");l(this,"closeBtn");l(this,"nextBtn");l(this,"globalToolbar");l(this,"leadEngine");l(this,"intelligentEngine");l(this,"sectionEngine");l(this,"contentGenerator");l(this,"referenceDialog");l(this,"referenceForm");l(this,"referenceUrlInput");l(this,"referenceAccessInput");l(this,"referencePreview");l(this,"referencePreviewContent");l(this,"referenceLoading");l(this,"referenceError");l(this,"referenceCancelBtn");l(this,"referenceInsertBtn");l(this,"referenceAccessField");l(this,"referenceCount",0);l(this,"addLinkDialog");l(this,"addLinkStep1");l(this,"addLinkStep2");l(this,"addLinkStep3");l(this,"addLinkUrlInput");l(this,"addLinkSubmitUrl");l(this,"addLinkLoading");l(this,"addLinkError");l(this,"addLinkSourceTitle");l(this,"addLinkSourceDomain");l(this,"addLinkQuestion");l(this,"addLinkSuggestions");l(this,"addLinkPreview");l(this,"addLinkCancelBtn");l(this,"addLinkNextBtn");l(this,"addLinkInsertBtn");l(this,"currentExtractedContent",null);l(this,"currentLinkSuggestions",[]);l(this,"isLinkDetectionActive",!1);this.leadEngine=new oe(new I),this.intelligentEngine=new ce(new I),this.sectionEngine=new le(new I),this.contentGenerator=new O,this.initializeDOM(),this.setupEventListeners(),this.restoreState()}initializeDOM(){if(this.titleInput=document.getElementById("articleTitleInput"),this.inputSection=document.querySelector(".article-creator__input-section"),this.categorySection=document.getElementById("categorySection"),this.creationSection=document.getElementById("creationSection"),this.editingSection=document.getElementById("editingSection"),this.categoryList=document.getElementById("categoryList"),this.categoryTitle=document.getElementById("categoryTitle"),this.creationTitle=document.getElementById("creationTitle"),this.chipsContainer=document.getElementById("chipsContainer"),this.creationChipsContainer=document.getElementById("creationChipsContainer"),this.newTopicBtn=document.getElementById("newTopicBtn"),this.startCreatingBtn=document.getElementById("startCreatingBtn"),this.articleTitleText=document.getElementById("articleTitleText"),this.boldBtn=document.getElementById("boldBtn"),this.italicBtn=document.getElementById("italicBtn"),this.linkBtn=document.getElementById("linkBtn"),this.undoBtn=document.getElementById("undoBtn"),this.moreBtn=document.getElementById("moreBtn"),this.articleContent=document.getElementById("articleContent"),this.closeBtn=document.getElementById("closeBtn"),this.nextBtn=document.getElementById("nextBtn"),this.globalToolbar=document.getElementById("globalToolbar"),this.snippetModal=document.getElementById("snippetModal"),this.snippetTitleSpan=document.getElementById("snippetTitle"),this.snippetCardsContainer=document.getElementById("snippetSuggestionCards"),this.snippetCancelBtn=document.getElementById("snippetCancelBtn"),this.snippetCancelBtn.addEventListener("click",()=>this.closeSnippetModal()),this.referenceDialog=document.getElementById("referenceDialog"),this.referenceForm=document.getElementById("referenceForm"),this.referenceUrlInput=document.getElementById("referenceUrl"),this.referenceAccessInput=document.getElementById("referenceAccess"),this.referencePreview=document.getElementById("referencePreview"),this.referencePreviewContent=document.getElementById("referencePreviewContent"),this.referenceLoading=document.getElementById("referenceLoading"),this.referenceError=document.getElementById("referenceError"),this.referenceCancelBtn=document.getElementById("referenceCancelBtn"),this.referenceInsertBtn=document.getElementById("referenceInsertBtn"),this.referenceAccessField=document.getElementById("referenceAccessField"),this.addLinkDialog=document.getElementById("addLinkDialog"),this.addLinkStep1=document.getElementById("addLinkStep1"),this.addLinkStep2=document.getElementById("addLinkStep2"),this.addLinkStep3=document.getElementById("addLinkStep3"),this.addLinkUrlInput=document.getElementById("addLinkUrl"),this.addLinkSubmitUrl=document.getElementById("addLinkSubmitUrl"),this.addLinkLoading=document.getElementById("addLinkLoading"),this.addLinkError=document.getElementById("addLinkError"),this.addLinkSourceTitle=document.getElementById("addLinkSourceTitle"),this.addLinkSourceDomain=document.getElementById("addLinkSourceDomain"),this.addLinkQuestion=document.getElementById("addLinkQuestion"),this.addLinkSuggestions=document.getElementById("addLinkSuggestions"),this.addLinkPreview=document.getElementById("addLinkPreview"),this.addLinkCancelBtn=document.getElementById("addLinkCancelBtn"),this.addLinkNextBtn=document.getElementById("addLinkNextBtn"),this.addLinkInsertBtn=document.getElementById("addLinkInsertBtn"),!this.titleInput)throw new Error("Required DOM elements not found");const e=this.newTopicBtn.querySelector(".cdx-button__icon");e&&(e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${S}</svg>`),this.initializeToolbarIcons()}setupEventListeners(){this.titleInput.addEventListener("input",e=>{const t=e.target;this.searchTerm=t.value.trim(),this.saveState(),this.searchTerm.length>=3?this.showCategorySelection():this.setState("input")}),this.newTopicBtn.addEventListener("click",()=>{this.showCategorySelection()}),this.startCreatingBtn.addEventListener("click",()=>{this.showArticleEditor()}),this.closeBtn.addEventListener("click",()=>{this.exitArticleEditor()}),this.linkBtn.addEventListener("click",()=>{this.detectLinksManually()}),this.titleInput.focus()}showCategorySelection(){this.setState("category-selection"),this.categoryTitle.textContent=`What is ${this.searchTerm}?`,this.displayCategories(),this.renderChips(this.chipsContainer,null)}displayCategories(){this.categoryList.innerHTML="",[o.PERSON,o.LOCATION,o.SPECIES,o.ORGANIZATION,o.CONCEPT,o.CREATIVE_WORK,o.EVENT].forEach(t=>{const n=this.createCategoryItem(t);this.categoryList.appendChild(n)})}createCategoryItem(e){const t=L.getCategoryIcon(e),n=this.getCategoryDescription(e),i=document.createElement("div");return i.className="category-item",i.innerHTML=`
            <div class="category-item__icon">${t}</div>
            <div class="category-item__content">
                <h3 class="category-item__title">${e}</h3>
                <p class="category-item__description">${n}</p>
            </div>
        `,i.addEventListener("click",()=>{this.selectCategory(e)}),i}getCategoryDescription(e){switch(e){case o.PERSON:return"About a notable individual or character";case o.LOCATION:return"About a place, city, country, or region";case o.SPECIES:return"About an animal, plant, or biological organism";case o.ORGANIZATION:return"About a company, institution, or group";case o.CONCEPT:return"About an idea, theory, or academic concept";case o.CREATIVE_WORK:return"About a book, film, artwork, or creative piece";case o.EVENT:return"About a historical event or occurrence";default:return"About a topic or concept"}}selectCategory(e){this.selectedTopic={wikidataId:null,label:this.searchTerm,description:"",category:e},this.saveState(),this.showArticleCreation()}showArticleCreation(){this.setState("article-creation"),this.articleContent.innerHTML="",this.selectedTopic&&(this.creationTitle.textContent=`Creating ${this.selectedTopic.category} article about "${this.searchTerm}"`,this.renderChips(this.creationChipsContainer,this.selectedTopic))}renderChips(e,t){e.innerHTML="";const n=this.createNewTopicChip();if(e.appendChild(n),t){const i=this.createCategoryChip(t);e.appendChild(i)}}createNewTopicChip(){const e=document.createElement("div");return e.className="cdx-info-chip cdx-info-chip--notice",e.innerHTML=`
            <span class="cdx-demo-css-icon--article"></span>
            <span class="cdx-info-chip__text">New topic</span>
        `,e}createCategoryChip(e){const t=document.createElement("div");t.className="cdx-info-chip cdx-info-chip--notice";const n=this.getCategoryIconClass(e.category);return t.innerHTML=`
            <span class="${n}"></span>
            <span class="cdx-info-chip__text">${e.category}</span>
        `,t}getCategoryIconClass(e){switch(e){case o.PERSON:return"cdx-demo-css-icon--user-avatar";case o.LOCATION:return"cdx-demo-css-icon--globe";case o.SPECIES:return"cdx-demo-css-icon--die";case o.ORGANIZATION:return"cdx-demo-css-icon--home";case o.CONCEPT:return"cdx-demo-css-icon--book";case o.CREATIVE_WORK:return"cdx-demo-css-icon--image";case o.EVENT:return"cdx-demo-css-icon--calendar";case o.OTHER:default:return"cdx-demo-css-icon--article"}}setState(e){this.currentState=e,this.updateDisplay(),this.saveState()}updateDisplay(){this.categorySection.style.display="none",this.creationSection.style.display="none",this.editingSection.style.display="none";const e=document.querySelector(".article-creator__header");switch(this.currentState==="article-editing"?(this.inputSection.style.display="none",e&&(e.style.display="none")):(this.inputSection.style.display="block",e&&(e.style.display="block")),this.currentState){case"category-selection":this.categorySection.style.display="block";break;case"article-creation":this.creationSection.style.display="block";break;case"article-editing":this.editingSection.style.display="block";break}}saveState(){const e={currentState:this.currentState,searchTerm:this.searchTerm,selectedTopic:this.selectedTopic};localStorage.setItem("articleCreatorState",JSON.stringify(e))}restoreState(){const e=localStorage.getItem("articleCreatorState");if(e)try{const t=JSON.parse(e);if(this.searchTerm=t.searchTerm||"",this.selectedTopic=t.selectedTopic||null,this.titleInput.value=this.searchTerm,this.searchTerm)switch(t.currentState){case"category-selection":this.showCategorySelection();break;case"article-creation":this.showArticleCreation();break;case"article-editing":this.showArticleEditor();break}}catch(t){console.error("Failed to restore state:",t)}}showArticleEditor(){var e;this.setState("article-editing"),this.setupArticleEditor(),this.globalToolbar.style.display="flex",(e=document.querySelector(".article-creator"))==null||e.classList.add("article-creator--editing"),this.articleContent.focus()}exitArticleEditor(){var e;this.globalToolbar.style.display="none",(e=document.querySelector(".article-creator"))==null||e.classList.remove("article-creator--editing"),this.showArticleCreation(),setTimeout(()=>{this.titleInput.focus(),this.titleInput.select()},100)}setupArticleEditor(){if(!this.selectedTopic)return;this.articleContent.innerHTML="";const e=this.searchTerm;this.articleTitleText.textContent=e;const n=this.getManualLeads(this.selectedTopic.label,this.selectedTopic.category).formal,i=document.createElement("p");i.className="article-lead",i.innerHTML=n,this.articleContent.appendChild(i),i.querySelectorAll(".detail-chip").forEach(r=>{const c=r.getAttribute("data-detail");r.addEventListener("click",p=>{p.preventDefault(),this.handleDetailChipClick(c||"",r)})});const s=document.getElementById("editorChipsContainer");s&&(s.innerHTML="",[{type:"snippet",icon:S,label:"Snippet"},{type:"fact",icon:S,label:"Fact"},{type:"more",icon:v,label:"More"}].forEach(c=>{const p=document.createElement("div");p.className="cdx-info-chip cdx-info-chip--notice",p.setAttribute("data-chip-type",c.type),p.innerHTML=`
                    <span class="editor-chip-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" aria-hidden="true">${c.icon}</svg>
                    </span>
                    <span class="cdx-info-chip__text">${c.label}</span>
                `,p.addEventListener("click",()=>this.handleEditorChipClick(c.type)),s.appendChild(p)}))}handleEditorChipClick(e){switch(e){case"snippet":this.openSnippetModal();break;case"fact":this.openAddLinkDialog();break;case"more":this.showEditorMoreMenu();break}}getManualLeads(e,t,n){const i=this.getArticleForWord(e),a=this.getCategoryContextualDescription(t,e);return this.generateChipBasedLeads(e,t,a,i,n)}getArticleForWord(e){return e&&["a","e","i","o","u"].includes(e.toLowerCase().charAt(0))?"an":"a"}generateChipBasedLeads(e,t,n,i,a){const s=a&&a.length>0?this.getContextualChips(a):this.getCategorySpecificChips(t),r='<span class="detail-chip detail-chip--reference" data-detail="reference">📎 Reference</span>',c='<span class="detail-chip detail-chip--more" data-detail="more">...more</span>';switch(t){case o.SPECIES:return{formal:`${e} is ${i} ${s.type} that ${s.description}. ${s.additional} ${r}`,concise:`${e} is ${i} ${s.type} from ${s.location}.`,detailed:`${e} is ${i} ${s.type} that ${s.description}. ${s.habitat} ${s.additional} ${c} ${r}`};case o.PERSON:return{formal:`${e} (${s.lifespan}) was ${i} ${s.nationality} ${s.occupation} known for ${s.achievement}. ${r}`,concise:`${e}: ${s.nationality} ${s.occupation} (${s.period}).`,detailed:`${e} (${s.lifespan}) was ${i} ${s.nationality} ${s.occupation} who ${s.achievement}. ${s.education} ${c} ${r}`};case o.LOCATION:return{formal:`${e} is ${i} ${s.type} in ${s.location} with a population of ${s.population}. ${r}`,concise:`${e}: ${s.type} in ${s.location}.`,detailed:`${e} is ${i} ${s.type} located in ${s.location}. ${s.demographics} ${s.significance} ${r}`};case o.ORGANIZATION:return{formal:`${e} is ${i} ${s.type} founded in ${s.foundingYear} by ${s.founder}. ${r}`,concise:`${e}: ${s.type} founded in ${s.foundingYear}.`,detailed:`${e} is ${i} ${s.type} established in ${s.foundingYear} by ${s.founder}. ${s.mission} ${r}`};case o.CONCEPT:return{formal:`${e} is ${i} ${s.type} in the field of ${s.field}. ${r}`,concise:`${e}: ${s.type} in ${s.field}.`,detailed:`${e} is ${i} ${s.type} that ${s.description}. ${s.applications} ${r}`};case o.CREATIVE_WORK:return{formal:`${e} is ${i} ${s.type} by ${s.creator} published in ${s.year}. ${r}`,concise:`${e}: ${s.type} by ${s.creator} (${s.year}).`,detailed:`${e} is ${i} ${s.type} created by ${s.creator} and published in ${s.year}. ${s.significance} ${r}`};case o.EVENT:return{formal:`${e} was ${i} ${s.type} that occurred in ${s.location} on ${s.date}. ${r}`,concise:`${e}: ${s.type} in ${s.location} (${s.year}).`,detailed:`${e} was ${i} ${s.type} that took place in ${s.location} on ${s.date}. ${s.significance} ${r}`};default:return{formal:`${e} is ${i} ${n}. ${r}`,concise:`${e}: ${n}.`,detailed:`${e} is ${i} ${n}. This article provides comprehensive information about ${e}. ${r}`}}}getContextualChips(e){const t=(i,a)=>`<span class="detail-chip" data-detail="${i}">${a}</span>`,n={};return e.forEach((i,a)=>{const r=i.replace(/^\+\s*/,"").toLowerCase().replace(/\s+/g,"_");n[`chip_${a}`]=t(r,i)}),e.length>=3&&(n.type=t("type",e[0]),n.description=t("description",e[1]),n.additional=t("additional",e[2])),n}getCategorySpecificChips(e){const t=(n,i)=>`<span class="detail-chip" data-detail="${n}">+ ${i}</span>`;switch(e){case o.SPECIES:return{type:t("species_type","species type"),description:`lives in ${t("habitat","habitat")}`,location:t("native_region","region"),habitat:`It inhabits ${t("habitat_details","habitat type")}.`,additional:`The species is ${t("conservation_status","conservation status")}.`};case o.PERSON:return{lifespan:`${t("birth_year","birth year")}`,nationality:t("nationality","nationality"),occupation:t("occupation","occupation"),achievement:t("main_achievement","main achievement"),period:t("active_period","period"),education:`They studied at ${t("education","institution")}.`};case o.LOCATION:return{type:t("location_type","type"),location:t("parent_location","location"),population:t("population","population"),demographics:`The area is ${t("area","area")} square kilometers.`,significance:`It is known for ${t("known_for","notable feature")}.`};case o.ORGANIZATION:return{type:t("org_type","type"),foundingYear:t("founding_year","year"),founder:t("founder","founder"),mission:`The organization focuses on ${t("mission","mission")}.`};case o.CONCEPT:return{type:t("concept_type","concept type"),field:t("field","field"),description:`${t("description","describes")}`,applications:`It is applied in ${t("applications","applications")}.`};case o.CREATIVE_WORK:return{type:t("work_type","type"),creator:t("creator","creator"),year:t("publication_year","year"),significance:`The work is notable for ${t("significance","significance")}.`};case o.EVENT:return{type:t("event_type","event type"),location:t("location","location"),date:t("date","date"),year:t("year","year"),significance:`The event was significant because ${t("significance","significance")}.`};default:return{type:t("type","type"),description:t("description","description")}}}getCategoryContextualDescription(e,t){const n=t.toLowerCase();switch(e){case o.SPECIES:return n.includes("saurus")||n.includes("dinosaur")?"extinct dinosaur species":"biological species";case o.PERSON:return"notable individual";case o.LOCATION:return n.includes("city")?"city":n.includes("country")?"country":"geographic location";case o.ORGANIZATION:return"organization";case o.CONCEPT:return n.includes("theory")?"theoretical concept":n.includes("principle")?"scientific principle":"conceptual framework";case o.CREATIVE_WORK:return n.includes("book")?"literary work":n.includes("film")?"cinematic work":"creative work";case o.EVENT:return"historical event";default:return e.toLowerCase()}}async openSnippetModal(){if(!this.selectedTopic)return;this.snippetTitleSpan.textContent=this.selectedTopic.label;let e,t=[];if(this.selectedTopic.wikidataId){const i={id:this.selectedTopic.wikidataId,title:this.selectedTopic.label,description:this.selectedTopic.description,category:this.selectedTopic.category,instanceOf:[]};try{const a=await this.intelligentEngine.generateIntelligentLeads(i,this.selectedTopic.category);e={formal:a.formal,concise:a.concise,detailed:a.detailed},t=a.contextualChips,console.log("Generated intelligent leads with contextual chips:",t)}catch(a){console.error("Error generating intelligent leads, falling back to basic templates:",a);try{e=await this.leadEngine.generateLeadVariations(i,this.selectedTopic.category)}catch(s){console.error("Error with fallback template engine:",s),e=this.getManualLeads(this.selectedTopic.label,this.selectedTopic.category,t)}}}else try{const i={id:"",title:this.selectedTopic.label,description:this.getCategoryContextualDescription(this.selectedTopic.category,this.selectedTopic.label),category:this.selectedTopic.category,instanceOf:[]},a=await this.intelligentEngine.generateIntelligentLeads(i,this.selectedTopic.category);e={formal:a.formal,concise:a.concise,detailed:a.detailed},t=a.contextualChips,console.log("Generated intelligent leads for manual topic with contextual chips:",t)}catch(i){console.error("Error generating intelligent leads for manual topic:",i),e=this.getManualLeads(this.selectedTopic.label,this.selectedTopic.category,t)}this.snippetCardsContainer.innerHTML="",[{type:"Professional",content:e.formal,description:"Formal tone"},{type:"Concise",content:e.concise,description:"Brief & clear"},{type:"Comprehensive",content:e.detailed,description:"Detailed coverage"}].forEach((i,a)=>{if(i.content.trim()){const s=document.createElement("div");s.className="snippet-modal__card",s.innerHTML=`
                        <div class="snippet-card__header">
                            <h3 class="snippet-card__title">${i.type}</h3>
                            <span class="snippet-card__description">${i.description}</span>
                        </div>
                        <p class="snippet-card__content">${i.content}</p>
                        <div class="snippet-card__footer">
                            <span class="snippet-card__length">${i.content.split(" ").length} words</span>
                        </div>
                    `,s.addEventListener("click",()=>{this.insertSelectedSnippet(i.content),this.closeSnippetModal()}),this.snippetCardsContainer.appendChild(s)}}),this.snippetCardsContainer.children.length===0&&(this.snippetCardsContainer.innerHTML=`
                    <div class="snippet-modal__card">
                        <p>${this.selectedTopic.label} is ${this.selectedTopic.description}.</p>
                    </div>
                `),this.snippetModal.style.display="flex"}insertSelectedSnippet(e){this.articleContent.innerHTML=e;const t=this.articleContent.querySelectorAll(".detail-chip");console.log("Found chips:",t.length),t.forEach(a=>{const s=a.getAttribute("data-detail");console.log("Attaching handler to chip:",s,a),a.addEventListener("click",r=>{r.preventDefault(),console.log("Chip clicked:",s),this.handleDetailChipClick(s||"",a)})});const n=document.createRange(),i=window.getSelection();n.selectNodeContents(this.articleContent),n.collapse(!1),i&&(i.removeAllRanges(),i.addRange(n)),this.articleContent.focus()}handleDetailChipClick(e,t){var a;if(console.log("handleDetailChipClick called with:",e),e==="reference"){console.log("Opening reference dialog"),this.openReferenceDialog();return}if(e==="more"){console.log("Showing more chip menu"),this.showMoreChipMenu(t);return}if(t.querySelector("input"))return;const n=((a=t.textContent)==null?void 0:a.replace(/^\+\s*/,""))||"",i=t.textContent||"";this.getIntelligentSuggestions(e).then(s=>{s.length>0?this.isMobileDevice()?this.createMobileModal(t,e,n,i,s):this.createIntelligentDropdown(t,e,n,i,s):this.createStandardInput(t,e,n,i)}).catch(s=>{console.error("Error getting suggestions:",s),this.createStandardInput(t,e,n,i)})}createStandardInput(e,t,n,i){const a=document.createElement("input");a.type="text",a.value=n,a.className="detail-chip__input",a.placeholder=`Enter ${t}`,e.innerHTML="",e.appendChild(a),e.classList.add("detail-chip--editing"),a.focus(),a.select(),this.setupInputHandlers(a,e,i)}setupInputHandlers(e,t,n){const i=()=>{const s=e.value.trim();s?(t.textContent=s,t.classList.add("detail-chip--filled")):t.textContent=n,t.classList.remove("detail-chip--editing")},a=()=>{t.textContent=n,t.classList.remove("detail-chip--editing")};e.addEventListener("blur",i),e.addEventListener("keydown",s=>{s.key==="Enter"?(s.preventDefault(),i()):s.key==="Escape"&&(s.preventDefault(),a())})}async getIntelligentSuggestions(e){var n;const t=(n=this.selectedTopic)==null?void 0:n.category;console.log(`Getting suggestions for detailType: ${e}, category: ${t}`);try{const i=await this.fetchDynamicSuggestions(e,t);if(console.log(`Dynamic suggestions for ${e}:`,i),i.length>0)return[...i,"Custom..."];{const a=this.getFallbackSuggestions(e,t);return console.log(`Fallback suggestions for ${e}:`,a),a}}catch(i){console.error("Error fetching dynamic suggestions:",i);const a=this.getFallbackSuggestions(e,t);return console.log(`Error fallback suggestions for ${e}:`,a),a}}async fetchDynamicSuggestions(e,t){switch(t){case o.LOCATION:return await this.getLocationSuggestions(e);case o.PERSON:return await this.getPersonSuggestions(e);case o.SPECIES:return await this.getSpeciesSuggestions(e);default:return[]}}async getLocationSuggestions(e){try{switch(e){case"population":const n=await this.queryWikidata(`
                        SELECT DISTINCT ?population WHERE {
                            ?city wdt:P31/wdt:P279* wd:Q515 .
                            ?city wdt:P17 wd:Q668 .
                            ?city wdt:P1082 ?population .
                            FILTER(?population > 100000)
                        } ORDER BY DESC(?population) LIMIT 10
                    `);return this.formatPopulationSuggestions(n);case"administrative_role":const a=await this.queryWikidata(`
                        SELECT DISTINCT ?roleLabel WHERE {
                            ?city wdt:P31/wdt:P279* wd:Q515 .
                            ?city wdt:P31 ?role .
                            ?role rdfs:label ?roleLabel .
                            FILTER(LANG(?roleLabel) = "en")
                            FILTER(CONTAINS(LCASE(?roleLabel), "capital") || CONTAINS(LCASE(?roleLabel), "city"))
                        } LIMIT 8
                    `);return this.extractLabels(a);case"geographical_features":const r=await this.queryWikidata(`
                        SELECT DISTINCT ?featureLabel WHERE {
                            ?city wdt:P31/wdt:P279* wd:Q515 .
                            ?city wdt:P138 ?feature .
                            ?feature rdfs:label ?featureLabel .
                            FILTER(LANG(?featureLabel) = "en")
                        } LIMIT 10
                    `);return this.extractLabels(r);default:return[]}}catch(t){return console.error("Error fetching location suggestions:",t),[]}}async getPersonSuggestions(e){try{switch(e){case"nationality":const n=await this.queryWikidata(`
                        SELECT DISTINCT ?nationalityLabel WHERE {
                            ?person wdt:P31 wd:Q5 .
                            ?person wdt:P27 ?nationality .
                            ?nationality rdfs:label ?nationalityLabel .
                            FILTER(LANG(?nationalityLabel) = "en")
                        } GROUP BY ?nationalityLabel ORDER BY DESC(COUNT(?person)) LIMIT 15
                    `);return this.extractLabels(n);case"occupation":const a=await this.queryWikidata(`
                        SELECT DISTINCT ?occupationLabel WHERE {
                            ?person wdt:P31 wd:Q5 .
                            ?person wdt:P106 ?occupation .
                            ?occupation rdfs:label ?occupationLabel .
                            FILTER(LANG(?occupationLabel) = "en")
                        } GROUP BY ?occupationLabel ORDER BY DESC(COUNT(?person)) LIMIT 15
                    `);return this.extractLabels(a);case"scientific_field":const r=await this.queryWikidata(`
                        SELECT DISTINCT ?fieldLabel WHERE {
                            ?person wdt:P31 wd:Q5 .
                            ?person wdt:P106 wd:Q901 .
                            ?person wdt:P101 ?field .
                            ?field rdfs:label ?fieldLabel .
                            FILTER(LANG(?fieldLabel) = "en")
                        } LIMIT 10
                    `);return this.extractLabels(r);default:return[]}}catch(t){return console.error("Error fetching person suggestions:",t),[]}}async getSpeciesSuggestions(e){try{switch(e){case"habitat":const n=await this.queryWikidata(`
                        SELECT DISTINCT ?habitatLabel WHERE {
                            ?species wdt:P31 wd:Q16521 .
                            ?species wdt:P183 ?habitat .
                            ?habitat rdfs:label ?habitatLabel .
                            FILTER(LANG(?habitatLabel) = "en")
                        } LIMIT 10
                    `);return this.extractLabels(n);case"conservation_status":const a=await this.queryWikidata(`
                        SELECT DISTINCT ?statusLabel WHERE {
                            ?species wdt:P31 wd:Q16521 .
                            ?species wdt:P141 ?status .
                            ?status rdfs:label ?statusLabel .
                            FILTER(LANG(?statusLabel) = "en")
                        } LIMIT 8
                    `);return this.extractLabels(a);default:return[]}}catch(t){return console.error("Error fetching species suggestions:",t),[]}}async queryWikidata(e){try{return console.log("SPARQL query (placeholder):",e),{results:{bindings:[]}}}catch(t){throw console.error("SPARQL query failed:",t),t}}extractLabels(e){var t;return(t=e==null?void 0:e.results)!=null&&t.bindings?e.results.bindings.map(n=>{var s;const i=Object.keys(n),a=i.find(r=>r.includes("Label"))||i[0];return(s=n[a])==null?void 0:s.value}).filter(n=>n&&n.length>0).slice(0,8):[]}formatPopulationSuggestions(e){var t;return(t=e==null?void 0:e.results)!=null&&t.bindings?e.results.bindings.map(n=>{var a;const i=parseInt((a=n.population)==null?void 0:a.value);return i>1e6?`${(i/1e6).toFixed(1)} million`:i>1e3?`${(i/1e3).toFixed(0)},000`:i.toString()}).filter(n=>n).slice(0,6):[]}getFallbackSuggestions(e,t){var i;return((i={[o.LOCATION]:{location_type:["city","town","village","region","country","Custom..."],population:["over 1 million","about 500,000","about 100,000","about 50,000","Custom..."],administrative_role:["capital city","major city","municipality","administrative center","Custom..."],parent_location:["United States","United Kingdom","India","Canada","Australia","Custom..."]},[o.PERSON]:{nationality:["American","British","Indian","Canadian","Australian","German","French","Custom..."],occupation:["writer","scientist","artist","politician","musician","actor","engineer","Custom..."],birth_year:["1950","1960","1970","1980","1990","2000","Custom..."],main_achievement:["notable works","scientific discoveries","artistic contributions","political reforms","Custom..."],birth_date:["January 1, 1970","March 15, 1965","June 10, 1980","Custom..."],birth_place:["New York","London","Paris","Mumbai","Toronto","Sydney","Custom..."],family_background:["middle-class family","academic family","working-class origins","aristocratic lineage","Custom..."],early_education:["local schools","private tutoring","prestigious academy","public education","Custom..."],career_start_institution:["Harvard University","Oxford University","MIT","Stanford University","Custom..."],career_start_year:["1990","1995","2000","2005","2010","Custom..."],primary_research:["theoretical physics","molecular biology","computer science","political theory","Custom..."],major_contributions:["groundbreaking research","innovative policies","artistic innovations","technological advances","Custom..."],political_start_year:["1990","1995","2000","2005","2010","Custom..."],first_office:["city councilor","state representative","mayor","senator","Custom..."],major_offices:["Governor","Senator","Prime Minister","President","Cabinet Minister","Custom..."],political_achievements:["landmark legislation","policy reforms","international agreements","social programs","Custom..."],spouse_name:["Jane Smith","John Doe","Custom..."],marriage_year:["1990","1995","2000","2005","Custom..."],children_details:["two children","three sons","one daughter","no children","Custom..."],personal_interests:["reading","music","sports","travel","gardening","Custom..."]},[o.SPECIES]:{species_type:["bird","mammal","reptile","fish","amphibian","insect","plant","fungus","Custom..."],habitat:["forests","grasslands","wetlands","deserts","mountains","rivers","oceans","Custom..."],conservation_status:["Least Concern","Near Threatened","Vulnerable","Endangered","Critically Endangered","Custom..."],native_region:["North America","South America","Europe","Asia","Africa","Australia","Custom..."],habitat_details:["tropical forests","temperate forests","freshwater lakes","coastal areas","mountain regions","Custom..."],size_category:["small","medium-sized","large","very large","tiny","compact","Custom..."],length_measurement:["30-50 cm","1-2 meters","2-3 meters","50-100 cm","10-30 cm","Custom..."],weight_range:["1-5 kg","10-25 kg","25-50 kg","50-100 kg","100-200 kg","Custom..."],sexual_dimorphism:["pronounced sexual dimorphism","minimal sexual dimorphism","no sexual dimorphism","males larger than females","females larger than males","Custom..."],size_difference:["10-15% larger","20-30% larger","50% larger","twice the size","similar sizes","Custom..."],primary_distinguishing_feature:["prominent crest","distinctive coloration","long tail","large ears","powerful build","unique markings","Custom..."],feature_function_1:["defensive purposes","territorial display","mating ritual","heat regulation","camouflage","Custom..."],feature_function_2:["communication","navigation","protection","hunting","social bonding","Custom..."],body_covering:["thick fur","smooth scales","feathers","tough skin","protective shell","Custom..."],protection_type:["weather protection","predator defense","UV protection","thermal insulation","Custom..."],adaptive_function:["thermoregulation","water conservation","energy efficiency","sensory enhancement","Custom..."],skull_features:["elongated skull","reinforced cranium","specialized jaw structure","enlarged brain case","Custom..."],sensory_organs:["acute hearing","enhanced vision","sensitive smell","specialized touch receptors","Custom..."],eye_description:["large round eyes","forward-facing eyes","small beady eyes","compound eyes","Custom..."],vision_type:["excellent night vision","color vision","motion detection","depth perception","Custom..."],lighting_conditions:["bright daylight","low light conditions","complete darkness","underwater","Custom..."],limb_structure:["muscular limbs","elongated limbs","short sturdy limbs","flexible appendages","Custom..."],extremity_features:["sharp claws","webbed feet","opposable thumbs","suction cups","hooves","Custom..."],locomotion_ability:["rapid running","precise climbing","efficient swimming","sustained flight","Custom..."],terrain_types:["rocky surfaces","sandy terrain","muddy ground","tree branches","water surfaces","Custom..."],taxonomic_classification:["vertebrate species","invertebrate species","flowering plant","coniferous tree","Custom..."],family_classification:["Felidae family","Canidae family","Ursidae family","Corvidae family","Custom..."],order_classification:["Carnivora","Primates","Rodentia","Passeriformes","Lepidoptera","Custom..."],discovery_year:["1758","1859","1901","1950","1975","2000","Custom..."],describing_scientist:["Carl Linnaeus","Charles Darwin","Alfred Wallace","John Smith","Custom..."],type_locality:["Madagascar","Amazon rainforest","Galápagos Islands","Australian Outback","Custom..."],distinguishing_feature_1:["unique coloration pattern","distinctive size","specialized appendages","unusual behavior","Custom..."],distinguishing_feature_2:["vocal characteristics","mating displays","feeding habits","seasonal changes","Custom..."],distinguishing_feature_3:["habitat preferences","social structure","reproductive cycle","migration patterns","Custom..."],phenotypic_variation:["significant color variation","size polymorphism","seasonal dimorphism","geographic variation","Custom..."],subspecies_number:["three recognized subspecies","five distinct populations","no subspecies","numerous local variants","Custom..."],ecological_role:["apex predator","keystone species","pollinator","seed disperser","decomposer","Custom..."],predator_role:["top predator","secondary predator","opportunistic hunter","ambush predator","Custom..."],prey_role:["primary prey","occasional prey","rarely preyed upon","protected by defenses","Custom..."],seasonal_behaviors:["winter hibernation","spring migration","summer breeding","autumn feeding","Custom..."],life_stages:["juvenile development","adult maturity","elderly decline","metamorphosis stages","Custom..."],feeding_classification:["strict carnivore","herbivore","omnivore","insectivore","filter feeder","Custom..."],primary_food_sources:["small mammals","insects","fruits and seeds","aquatic plants","nectar","Custom..."],secondary_diet:["seasonal fruits","emergency protein sources","mineral supplements","occasional scavenging","Custom..."],resource_scarcity:["winter months","drought periods","territorial competition","climate changes","Custom..."],social_organization:["matriarchal groups","alpha-dominated packs","loose aggregations","solitary individuals","Custom..."],group_size:["small family units","large flocks","mated pairs","temporary gatherings","Custom..."],group_composition:["mixed-age groups","age-segregated clusters","breeding pairs only","female-dominated groups","Custom..."],communication_methods:["complex vocalizations","visual displays","chemical signals","tactile interactions","Custom..."],communication_complexity:["15+ distinct calls","30+ vocalizations","simple sound repertoire","elaborate signal system","Custom..."],call_functions:["alarm calls","mating songs","territorial warnings","parent-offspring communication","Custom..."],breeding_pattern:["annual breeding cycle","biannual reproduction","opportunistic breeding","continuous reproduction","Custom..."],breeding_season:["spring months","late summer","dry season","year-round","Custom..."],courtship_behavior:["complex dances","vocal performances","gift presentations","territorial displays","Custom..."],courtship_duration:["several days","multiple weeks","brief encounters","extended seasons","Custom..."],parental_strategy:["biparental care","female-only care","male-only care","communal raising","Custom..."],care_activities:["nest building","food provisioning","protection duties","teaching behaviors","Custom..."],care_duration:["2-3 months","6 months","one year","until independence","Custom..."],primary_habitat:["dense forests","open grasslands","wetland areas","rocky mountains","coastal regions","Custom..."],geographic_distribution:["widespread across continents","limited to specific regions","island populations","fragmented habitats","Custom..."],habitat_types:["diverse ecosystems","specialized niches","edge environments","transitional zones","Custom..."],secondary_habitats:["agricultural areas","urban parks","secondary forests","disturbed habitats","Custom..."],vegetation_type:["old-growth forests","deciduous woodlands","coniferous stands","mixed vegetation","Custom..."],canopy_coverage:["dense canopy (80-90%)","moderate coverage (50-70%)","open canopy (30-50%)","sparse coverage","Custom..."],shelter_benefits:["predator avoidance","weather protection","nesting sites","roosting locations","Custom..."],resource_availability:["year-round food sources","seasonal abundance","water access","nesting materials","Custom..."],terrain_features:["river valleys","steep slopes","plateau areas","cave systems","Custom..."],landscape_elements:["natural clearings","fallen logs","boulder fields","stream corridors","Custom..."],seasonal_range_1:["northern breeding areas","mountain highlands","tropical regions","coastal zones","Custom..."],seasonal_range_2:["southern wintering grounds","lowland areas","temperate zones","inland regions","Custom..."],migration_distance:["short local movements","medium-distance travel","transcontinental journeys","no migration","Custom..."],climate_adaptations:["temperature tolerance","drought resistance","flood adaptations","seasonal adjustments","Custom..."],alternative_habitats:["human-modified landscapes","protected reserves","restoration areas","corridor habitats","Custom..."],elevation_changes:["higher altitudes","lower elevations","sea level areas","mountain peaks","Custom..."]}}[t])==null?void 0:i[e])||["Custom..."]}isMobileDevice(){return window.innerWidth<=768||"ontouchstart"in window}createMobileModal(e,t,n,i,a){var N;const s=document.createElement("div");s.className="mobile-chip-overlay";const r=document.createElement("div");r.className="mobile-chip-modal";const c=document.createElement("div");c.className="mobile-chip-header",c.innerHTML=`
            <h3>${t.replace(/_/g," ")}</h3>
            <button class="mobile-chip-close">×</button>
        `;const p=document.createElement("div");p.className="mobile-chip-input-section";const d=document.createElement("input");d.type="text",d.value=n,d.className="mobile-chip-input",d.placeholder=`Enter ${t.replace(/_/g," ")}`,p.appendChild(d);const h=document.createElement("div");h.className="mobile-chip-suggestions";const g=document.createElement("h4");g.textContent="Quick options:",h.appendChild(g),a.forEach(T=>{const y=document.createElement("button");y.className="mobile-chip-suggestion",y.textContent=T,y.addEventListener("click",()=>{d.value=T}),h.appendChild(y)});const m=document.createElement("div");m.className="mobile-chip-actions";const E=document.createElement("button");E.className="mobile-chip-cancel",E.textContent="Cancel";const C=document.createElement("button");C.className="mobile-chip-save",C.textContent="Save",m.appendChild(E),m.appendChild(C),r.appendChild(c),r.appendChild(p),r.appendChild(h),r.appendChild(m),s.appendChild(r);const f=()=>{document.body.removeChild(s),document.body.style.overflow=""},w=()=>{const T=d.value.trim();T&&(e.textContent=T,e.classList.remove("detail-chip--placeholder")),f()};(N=c.querySelector(".mobile-chip-close"))==null||N.addEventListener("click",f),E.addEventListener("click",f),C.addEventListener("click",w),s.addEventListener("click",T=>{T.target===s&&f()}),document.body.appendChild(s),document.body.style.overflow="hidden",d.focus(),d.select()}createIntelligentDropdown(e,t,n,i,a){const s=document.createElement("div");s.className="detail-chip__dropdown";const r=document.createElement("input");r.type="text",r.value=n,r.className="detail-chip__input detail-chip__input--dropdown",r.placeholder=`Enter ${t} or select below`;const c=document.createElement("div");c.className="detail-chip__suggestions",a.forEach(p=>{const d=document.createElement("div");d.className="detail-chip__suggestion",p==="Custom..."&&(d.className+=" detail-chip__suggestion--custom"),d.textContent=p,d.addEventListener("click",()=>{p==="Custom..."?(r.focus(),r.value="",r.placeholder=`Enter custom ${t}...`):this.applySuggestion(e,p,i)}),c.appendChild(d)}),s.appendChild(r),s.appendChild(c),e.innerHTML="",e.appendChild(s),e.classList.add("detail-chip--editing","detail-chip--dropdown"),r.focus(),r.select(),this.setupDropdownHandlers(r,e,i)}applySuggestion(e,t,n){e.textContent=t,e.classList.remove("detail-chip","detail-chip--editing","detail-chip--dropdown","detail-chip--filled"),e.style.background="transparent",e.style.border="none",e.style.padding="0",e.style.cursor="text"}setupDropdownHandlers(e,t,n){const i=()=>{const s=e.value.trim();s?(t.textContent=s,t.classList.remove("detail-chip","detail-chip--editing","detail-chip--dropdown","detail-chip--filled"),t.style.background="transparent",t.style.border="none",t.style.padding="0",t.style.cursor="text"):(t.textContent=n,t.classList.remove("detail-chip--editing","detail-chip--dropdown"))},a=()=>{t.textContent=n,t.classList.remove("detail-chip--editing","detail-chip--dropdown")};e.addEventListener("blur",s=>{setTimeout(()=>{t.contains(document.activeElement)||i()},150)}),e.addEventListener("keydown",s=>{s.key==="Enter"?(s.preventDefault(),i()):s.key==="Escape"&&(s.preventDefault(),a())})}showMoreChipMenu(e){console.log("showMoreChipMenu called"),document.querySelectorAll(".detail-chip__menu").forEach(s=>s.remove());const t=document.createElement("div");t.className="detail-chip__menu",this.getMoreChipOptions().forEach(s=>{const r=document.createElement("div");r.className="detail-chip__menu-option",r.textContent=s.label,r.addEventListener("click",()=>{this.insertMoreChip(e,s),t.remove()}),t.appendChild(r)});const i=e.getBoundingClientRect();t.style.position="absolute",t.style.top=`${i.bottom+5}px`,t.style.left=`${i.left}px`,t.style.zIndex="1001",document.body.appendChild(t);const a=s=>{!t.contains(s.target)&&s.target!==e&&(t.remove(),document.removeEventListener("click",a))};setTimeout(()=>document.addEventListener("click",a),0)}getMoreChipOptions(){return[{label:"Etymology",detail:"etymology"},{label:"History",detail:"history"},{label:"Related topics",detail:"related"},{label:"Notable features",detail:"features"},{label:"Cultural impact",detail:"impact"},{label:"Current status",detail:"status"}]}insertMoreChip(e,t){var i;const n=document.createElement("span");n.className="detail-chip",n.setAttribute("data-detail",t.detail),n.textContent=`+ ${t.label.toLowerCase()}`,n.addEventListener("click",a=>{a.preventDefault(),this.handleDetailChipClick(t.detail,n)}),(i=e.parentNode)==null||i.insertBefore(n,e)}showEditorMoreMenu(){var i;console.log("showEditorMoreMenu called");let e=document.getElementById("editorMoreSection");if(e){e.style.display==="none"?e.style.display="block":e.style.display="none";return}const t=document.getElementById("editorChipsContainer");if(!t){console.log("Editor chips container not found");return}e=document.createElement("div"),e.id="editorMoreSection",e.className="editor-more-section",e.innerHTML=`
            <div class="editor-more-subsection">
                <h3 class="editor-more-subsection__title">Add...</h3>
            </div>
            
            <div class="editor-more-subsection">
                <h3 class="editor-more-subsection__title">Snippets</h3>
                <div class="editor-more-card" data-action="snippet-intro">
                    <div class="editor-more-card__title">The basic intro</div>
                    <div class="editor-more-card__subtitle">Wikisaurus (...) is a genus of...</div>
                </div>
            </div>
            
            <div class="editor-more-subsection">
                <h3 class="editor-more-subsection__title">New fact</h3>
                <div class="editor-more-card" data-action="add-from-link">
                    <div class="editor-more-card__title">Add from link</div>
                </div>
            </div>
            
            <div class="editor-more-subsection">
                <h3 class="editor-more-subsection__title">New section</h3>
                <div id="intelligentSectionsContainer">
                    <!-- Intelligent sections will be populated here -->
                </div>
            </div>
        `,e.querySelectorAll(".editor-more-card").forEach(a=>{a.addEventListener("click",()=>{const s=a.getAttribute("data-action");this.handleEditorMoreCardClick(s||"")})}),(i=t.parentNode)==null||i.insertBefore(e,t.nextSibling),this.populateIntelligentSections()}async populateIntelligentSections(){if(!this.selectedTopic){console.log("No selected topic for section suggestions");return}const e=document.getElementById("intelligentSectionsContainer");if(!e){console.log("Intelligent sections container not found");return}try{const t=this.selectedTopic.category,n={id:this.selectedTopic.wikidataId||"",title:this.selectedTopic.label,description:this.selectedTopic.description,category:this.selectedTopic.category,instanceOf:[]},a=(await this.sectionEngine.getSuggestedSections(n,t)).slice(0,4);a.forEach((s,r)=>{const c=document.createElement("div");c.className="editor-more-card",c.setAttribute("data-action",`intelligent-section-${r}`),c.setAttribute("data-section-title",s.title),c.innerHTML=`
                    <div class="editor-more-card__title">${s.icon} ${s.title}</div>
                    <div class="editor-more-card__subtitle">${s.description}</div>
                `,c.addEventListener("click",()=>{this.handleIntelligentSectionClick(s)}),e.appendChild(c)}),a.length===0&&(e.innerHTML=`
                    <div class="editor-more-card" data-action="origin-name">
                        <div class="editor-more-card__title">📚 Origin of the name</div>
                        <div class="editor-more-card__subtitle">Historical background and etymology</div>
                    </div>
                `)}catch(t){console.error("Error loading section suggestions:",t),e.innerHTML=`
                <div class="editor-more-card" data-action="origin-name">
                    <div class="editor-more-card__title">📚 Origin of the name</div>
                    <div class="editor-more-card__subtitle">Historical background and etymology</div>
                </div>
            `}}async handleIntelligentSectionClick(e){var t;console.log("Intelligent section clicked:",e.title),this.selectedTopic||(console.log("No selected topic for section generation"),this.selectedTopic={id:"",title:"Entity Name",description:"A person, place, or thing",category:"Person"});try{const n=(t=this.selectedTopic)==null?void 0:t.category;if(console.log("Generating section content for:",e.title,"category:",n),!this.selectedTopic)throw new Error("No selected topic available");console.log("DEBUG: selectedTopic structure:",this.selectedTopic);const i={id:this.selectedTopic.wikidataId||"",title:this.selectedTopic.label,description:this.selectedTopic.description,category:this.selectedTopic.category,instanceOf:[]};console.log("DEBUG: Topic title:",i.title);const a=await this.sectionEngine.generateSectionContent(e,i,n);console.log("Generated section content:",a);const s=a&&a.trim()?a:await this.createFallbackSectionWithChips(e.title);this.insertSectionWithFormatting(e.title,s),this.closeEditorMoreSection(),this.articleContent.focus()}catch(n){console.error("Error generating section content:",n),console.error("Error details:",n);const i=await this.createFallbackSectionWithChips(e.title);this.insertSectionWithFormatting(e.title,i),this.closeEditorMoreSection(),this.articleContent.focus()}}async createFallbackSectionWithChips(e){var s,r,c;const t=e.toLowerCase();console.log("Creating intelligent fallback section for:",e,"lowercased:",t);const n=((s=this.selectedTopic)==null?void 0:s.label)||"entity",i=((r=this.selectedTopic)==null?void 0:r.category)||o.PERSON,a={id:"",title:n,label:n,description:this.getCategoryContextualDescription(i,n),category:((c=this.selectedTopic)==null?void 0:c.category)||"person",instanceOf:[]};try{const p=await this.contentGenerator.generateContentSuggestions(a,i,t),d=this.getIntelligentEntityChip(n,i);return t.includes("early life")||t.includes("education")||t.includes("childhood")||t.includes("youth")?`${d} was born <span class="detail-chip" data-detail="birth_date">birth date</span> in <span class="detail-chip" data-detail="birth_place">birth place</span>. <span class="detail-chip" data-detail="family_background">Family background</span> and <span class="detail-chip" data-detail="early_education">early education</span> shaped their development.`:t.includes("career")||t.includes("research")||t.includes("work")||t.includes("profession")?`${d} began their career at <span class="detail-chip" data-detail="career_start_institution">institution</span> in <span class="detail-chip" data-detail="career_start_year">year</span>. Their work focused on <span class="detail-chip" data-detail="primary_research">research area</span> and <span class="detail-chip" data-detail="major_contributions">key contributions</span>.`:t.includes("political")||t.includes("government")||t.includes("office")||t.includes("leadership")?`${d} entered politics in <span class="detail-chip" data-detail="political_start_year">year</span> as <span class="detail-chip" data-detail="first_office">first position</span>. They later served as <span class="detail-chip" data-detail="major_offices">major positions</span> and achieved <span class="detail-chip" data-detail="political_achievements">key accomplishments</span>.`:t.includes("personal")||t.includes("family")||t.includes("private")?`${d} married <span class="detail-chip" data-detail="spouse_name">spouse</span> in <span class="detail-chip" data-detail="marriage_year">year</span>. They have <span class="detail-chip" data-detail="children_details">children information</span> and <span class="detail-chip" data-detail="personal_interests">personal interests</span>.`:t.includes("legacy")||t.includes("death")||t.includes("later life")||t.includes("impact")?`${d} passed away <span class="detail-chip" data-detail="death_date">date</span> in <span class="detail-chip" data-detail="death_place">place</span>. Their legacy includes <span class="detail-chip" data-detail="lasting_impact">lasting contributions</span> and <span class="detail-chip" data-detail="commemorations">commemorations</span>.`:t.includes("awards")||t.includes("recognition")||t.includes("honors")||t.includes("achievements")?`${d} received <span class="detail-chip" data-detail="major_awards">major awards</span> including <span class="detail-chip" data-detail="prestigious_honors">prestigious honors</span>. Their work was recognized by <span class="detail-chip" data-detail="recognition_institutions">institutions</span> and <span class="detail-chip" data-detail="peer_recognition">peers</span>.`:t.includes("publications")||t.includes("works")||t.includes("writings")||t.includes("books")?`${d} published <span class="detail-chip" data-detail="major_publications">major works</span> including <span class="detail-chip" data-detail="notable_books">notable books</span>. Their <span class="detail-chip" data-detail="publication_themes">key themes</span> influenced <span class="detail-chip" data-detail="field_impact">field impact</span>.`:(console.log("Using intelligent generic fallback for section:",e),`${d} <span class="detail-chip" data-detail="section_context">section context</span>. <span class="detail-chip" data-detail="key_information">Key information</span> about <span class="detail-chip" data-detail="specific_details">specific details</span> and <span class="detail-chip" data-detail="relevant_facts">relevant facts</span>.`)}catch(p){return console.error("Error generating intelligent section content:",p),`${`<span class="detail-chip" data-detail="entity_name">${n}</span>`} <span class="detail-chip" data-detail="section_context">section context</span>. <span class="detail-chip" data-detail="key_information">Key information</span> about <span class="detail-chip" data-detail="specific_details">specific details</span> and <span class="detail-chip" data-detail="relevant_facts">relevant facts</span>.`}}getIntelligentEntityChip(e,t){return`<span class="detail-chip" data-detail="entity_name">${this.generateContextualEntityName(e,t)}</span>`}generateContextualEntityName(e,t){switch(t){case o.SPECIES:return e.toLowerCase().includes("saurus")?`The ${e}`:e.toLowerCase().includes("bird")||e.toLowerCase().includes("fly")?`The ${e}`:`**${e}**`;case o.PERSON:return`**${e}**`;case o.LOCATION:return`**${e}**`;default:return`**${e}**`}}insertSectionWithFormatting(e,t){const n=document.createElement("div");n.className="article-section";const i=document.createElement("h2");i.className="article-section__heading",i.textContent=e,n.appendChild(i),t.split(`

`).filter(r=>r.trim().length>0).forEach(r=>{const c=document.createElement("p");c.className="article-section__content",c.innerHTML=r.trim(),n.appendChild(c)}),this.articleContent.appendChild(n),n.querySelectorAll(".detail-chip").forEach(r=>{const c=r.getAttribute("data-detail");r.addEventListener("click",p=>{p.preventDefault(),this.handleDetailChipClick(c||"",r)})}),n.scrollIntoView({behavior:"smooth",block:"nearest"})}handleEditorMoreCardClick(e){switch(console.log("Editor more card clicked:",e),e){case"snippet-intro":this.insertBasicIntro();break;case"add-from-link":this.openAddLinkDialog();break;case"origin-name":const t=`

## Origin of the name

[Add information about the name origin]`;this.articleContent.innerHTML+=t;break;default:console.log("Unknown card action:",e)}this.closeEditorMoreSection(),this.articleContent.focus()}closeEditorMoreSection(){const e=document.getElementById("editorMoreSection");e&&e.remove()}async insertBasicIntro(){if(!this.selectedTopic){console.log("No selected topic for intro generation");return}console.log("Generating template-based intro for:",this.selectedTopic.label);const t=this.getManualLeads(this.selectedTopic.label,this.selectedTopic.category).formal;this.insertSelectedSnippet(t),console.log("Template-based intro inserted:",t)}_handleEditorMoreOption(e){console.log("Editor more option selected:",e);const n={image:"[Image placeholder]",list:`
• Item 1
• Item 2
• Item 3`,table:`
| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |`,quote:`
> Quote text here`,citation:"[Citation needed]",infobox:"[Infobox placeholder]"}[e]||`[${e}]`,i=this.articleContent.innerHTML;this.articleContent.innerHTML=i+n,this.articleContent.focus()}closeSnippetModal(){this.snippetModal.style.display="none"}initializeToolbarIcons(){var p,d;const t=this.closeBtn.querySelector(".cdx-button__icon");t&&(t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${X}</svg>`);const n=this.boldBtn.querySelector(".cdx-button__icon");if(n){const h=(p=j.langCodeMap)==null?void 0:p.en;n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${h}</svg>`}const i=this.italicBtn.querySelector(".cdx-button__icon");if(i){const h=(d=ie.langCodeMap)==null?void 0:d.en;i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${h}</svg>`}const a=this.linkBtn.querySelector(".cdx-button__icon");a&&(a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${ne}</svg>`);const s=this.undoBtn.querySelector(".cdx-button__icon");if(s){const h=se.ltr;s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${h}</svg>`}const r=this.moreBtn.querySelector(".cdx-button__icon");r&&(r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${v}</svg>`);const c=this.nextBtn.querySelector(".cdx-button__icon");if(c){const h=ae.ltr;c.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">${h}</svg>`}}openReferenceDialog(){this.referenceDialog.style.display="flex",this.referenceUrlInput.focus(),this.setupReferenceDialogEventListeners();const e=new Date().toISOString().split("T")[0];this.referenceAccessInput.value=e}closeReferenceDialog(){this.referenceDialog.style.display="none",this.resetReferenceDialog()}resetReferenceDialog(){this.referenceForm.reset(),this.referencePreview.style.display="none",this.referenceLoading.style.display="none",this.referenceError.style.display="none",this.referenceAccessField.style.display="none",this.referenceInsertBtn.disabled=!0}setupReferenceDialogEventListeners(){this.referenceCancelBtn.removeEventListener("click",this.closeReferenceDialog),this.referenceInsertBtn.removeEventListener("click",this.insertReference),this.referenceUrlInput.removeEventListener("input",this.validateReference),this.referenceCancelBtn.addEventListener("click",()=>this.closeReferenceDialog()),this.referenceInsertBtn.addEventListener("click",()=>this.insertReference()),this.referenceUrlInput.addEventListener("input",()=>this.validateReference()),this.referenceDialog.addEventListener("click",e=>{e.target===this.referenceDialog&&this.closeReferenceDialog()})}async validateReference(){const e=this.referenceUrlInput.value.trim();if(!e){this.referencePreview.style.display="none",this.referenceInsertBtn.disabled=!0,this.referenceError.style.display="none";return}this.referenceLoading.style.display="flex",this.referenceError.style.display="none",this.referencePreview.style.display="none";try{await new Promise(n=>setTimeout(n,1e3));let t;this.isValidUrl(e)?(t=await this.fetchUrlMetadata(e),this.referenceAccessField.style.display="block"):(t=this.createTitleReference(e),this.referenceAccessField.style.display="none"),this.showReferencePreview(t),this.referenceInsertBtn.disabled=!1}catch{this.showReferenceError("Unable to validate reference. Please check the URL or article title."),this.referenceInsertBtn.disabled=!0}finally{this.referenceLoading.style.display="none"}}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}async fetchUrlMetadata(e){return new Promise(t=>{setTimeout(()=>{const n=new URL(e).hostname;t({type:"web",title:`Article from ${n}`,url:e,domain:n,accessDate:this.referenceAccessInput.value})},500)})}createTitleReference(e){return{type:"article",title:e,accessDate:null}}showReferencePreview(e){let t="";e.type==="web"?t=`
                <strong>${e.title}</strong><br>
                <em>${e.domain}</em><br>
                ${e.accessDate?`Retrieved ${e.accessDate}`:""}
            `:t=`<strong>${e.title}</strong>`,this.referencePreviewContent.innerHTML=t,this.referencePreview.style.display="block"}showReferenceError(e){this.referenceError.textContent=e,this.referenceError.style.display="block",this.referencePreview.style.display="none"}insertReference(){var i;const e=this.referenceUrlInput.value.trim();if(!e)return;this.referenceCount++;const t=document.createElement("a");t.href="#",t.className="wiki-reference",t.textContent=`[${this.referenceCount}]`,t.title=e;const n=this.articleContent.querySelectorAll('[data-detail="reference"]');if(n.length>0){const a=n[0];(i=a.parentNode)==null||i.replaceChild(t,a)}this.closeReferenceDialog(),console.log(`Inserted reference [${this.referenceCount}] for: ${e}`)}openAddLinkDialog(){this.addLinkDialog.style.display="flex",this.resetAddLinkDialog(),this.addLinkUrlInput.focus(),this.setupAddLinkEventListeners()}closeAddLinkDialog(){this.addLinkDialog.style.display="none",this.resetAddLinkDialog()}resetAddLinkDialog(){this.addLinkStep1.style.display="block",this.addLinkStep2.style.display="none",this.addLinkStep3.style.display="none",this.addLinkUrlInput.value="",this.addLinkQuestion.value="",this.addLinkSubmitUrl.disabled=!0,this.addLinkNextBtn.style.display="none",this.addLinkInsertBtn.style.display="none",this.addLinkLoading.style.display="none",this.addLinkError.style.display="none",this.addLinkSuggestions.innerHTML="",this.addLinkPreview.innerHTML="",this.currentExtractedContent=null}setupAddLinkEventListeners(){this.addLinkUrlInput.addEventListener("input",()=>{const e=this.addLinkUrlInput.value.trim();this.addLinkSubmitUrl.disabled=!this.isValidUrl(e)}),this.addLinkSubmitUrl.addEventListener("click",()=>{this.extractContentFromUrl()}),this.addLinkCancelBtn.addEventListener("click",()=>{this.closeAddLinkDialog()}),this.addLinkNextBtn.addEventListener("click",()=>{this.generateContentFromQuestion()}),this.addLinkInsertBtn.addEventListener("click",()=>{this.insertGeneratedContent()}),this.addLinkQuestion.addEventListener("input",()=>{const e=this.addLinkQuestion.value.trim().length>0;this.addLinkNextBtn.style.display=e?"block":"none"}),this.addLinkDialog.addEventListener("click",e=>{e.target===this.addLinkDialog&&this.closeAddLinkDialog()}),this.addLinkUrlInput.addEventListener("keydown",e=>{e.key==="Enter"&&!this.addLinkSubmitUrl.disabled&&this.extractContentFromUrl()})}async extractContentFromUrl(){var t;const e=this.addLinkUrlInput.value.trim();if(e){this.addLinkLoading.style.display="flex",this.addLinkError.style.display="none";try{await new Promise(i=>setTimeout(i,2e3));const n=new URL(e).hostname;this.currentExtractedContent={url:e,title:`Research Article from ${n}`,domain:n,content:`This article discusses important findings related to ${((t=this.selectedTopic)==null?void 0:t.label)||"the topic"}. The research provides valuable insights that could enhance understanding of the subject matter.`,suggestions:["Who made the discovery?","What was the research method?","When was this discovery made?","What are the implications?"]},this.showExtractedContent()}catch{this.showAddLinkError("Unable to extract content from the provided URL. Please check the URL and try again.")}finally{this.addLinkLoading.style.display="none"}}}showExtractedContent(){this.currentExtractedContent&&(this.addLinkStep1.style.display="none",this.addLinkStep2.style.display="block",this.addLinkSourceTitle.textContent=this.currentExtractedContent.title,this.addLinkSourceDomain.textContent=this.currentExtractedContent.domain,this.addLinkSuggestions.innerHTML="",this.currentExtractedContent.suggestions.forEach(e=>{const t=document.createElement("div");t.className="add-link-dialog__suggestion-item",t.innerHTML=`
                <div class="add-link-dialog__suggestion-icon">🔍</div>
                <div class="add-link-dialog__suggestion-text">${e}</div>
            `,t.addEventListener("click",()=>{this.addLinkSuggestions.querySelectorAll(".add-link-dialog__suggestion-item").forEach(n=>{n.classList.remove("selected")}),t.classList.add("selected"),this.addLinkQuestion.value=e,this.addLinkNextBtn.style.display="block"}),this.addLinkSuggestions.appendChild(t)}))}async generateContentFromQuestion(){var t,n,i,a;const e=this.addLinkQuestion.value.trim();if(!(!e||!this.currentExtractedContent)){this.addLinkLoading.style.display="flex";try{await new Promise(r=>setTimeout(r,1500));let s="";e.toLowerCase().includes("who made")||e.toLowerCase().includes("discovery")?s=`According to research published on ${this.currentExtractedContent.domain}, recent discoveries have provided new insights into ${((t=this.selectedTopic)==null?void 0:t.label)||"the subject"}. The findings suggest that previous understanding may need to be revised in light of these new observations.`:e.toLowerCase().includes("method")||e.toLowerCase().includes("how")?s=`Research methodology described in the ${this.currentExtractedContent.domain} publication indicates that advanced techniques were employed to analyze ${((n=this.selectedTopic)==null?void 0:n.label)||"the subject"}. The study utilized both theoretical frameworks and empirical data to reach its conclusions.`:e.toLowerCase().includes("when")||e.toLowerCase().includes("date")?s=`Recent studies published on ${this.currentExtractedContent.domain} have established a timeline for events related to ${((i=this.selectedTopic)==null?void 0:i.label)||"the subject"}. This chronological framework helps researchers better understand the sequence of developments.`:s=`Research from ${this.currentExtractedContent.domain} provides valuable context for understanding ${((a=this.selectedTopic)==null?void 0:a.label)||"the subject"}. The study's findings contribute to the broader academic discourse and offer new perspectives on the topic.`,s+=` [${this.referenceCount+1}]`,this.showGeneratedContent(s)}catch{this.showAddLinkError("Unable to generate content. Please try again.")}finally{this.addLinkLoading.style.display="none"}}}showGeneratedContent(e){this.addLinkStep2.style.display="none",this.addLinkStep3.style.display="block",this.addLinkPreview.innerHTML=e,this.addLinkInsertBtn.style.display="block",this.addLinkNextBtn.style.display="none"}insertGeneratedContent(){if(!this.currentExtractedContent)return;const e=this.addLinkPreview.textContent||"";if(!e)return;this.referenceCount++;const t=document.createElement("p");t.innerHTML=e.replace(`[${this.referenceCount}]`,`<a href="#" class="wiki-reference" title="${this.currentExtractedContent.url}">[${this.referenceCount}]</a>`),this.articleContent.appendChild(t),this.closeAddLinkDialog(),console.log(`Inserted generated content with reference [${this.referenceCount}] from: ${this.currentExtractedContent.url}`)}showAddLinkError(e){this.addLinkError.textContent=e,this.addLinkError.style.display="block"}detectLinksManually(){if(this.isLinkDetectionActive)return;this.clearLinkSuggestions();const e=this.getTextContentForLinkDetection();if(!e||e.length<20){this.showLinkDetectionMessage("No content available for link detection. Please add some text first.");return}this.showLinkDetectionMessage("Scanning for potential Wikipedia links..."),this.detectAndShowLinkSuggestions()}showLinkDetectionMessage(e){const t=document.createElement("div");t.className="link-detection-message",t.textContent=e,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3366cc;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 0.875rem;
            z-index: 1006;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        `,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}async detectAndShowLinkSuggestions(){if(this.isLinkDetectionActive)return;const e=this.getTextContentForLinkDetection();if(!(!e||e.length<20)&&!(this.articleContent.querySelectorAll(".potential-link").length>0)){this.isLinkDetectionActive=!0;try{console.log("Detecting links in text:",e.substring(0,100)+"...");const t=await A.detectLinksInText(e);console.log("Found suggestions:",t.length),this.currentLinkSuggestions=t,t.length>0?(this.renderLinkSuggestions(t),this.showLinkDetectionMessage(`Found ${t.length} potential Wikipedia link${t.length>1?"s":""}. Click to review.`)):this.showLinkDetectionMessage("No potential Wikipedia links found in the current text.")}catch(t){console.error("Error detecting links:",t)}finally{this.isLinkDetectionActive=!1}}}getTextContentForLinkDetection(){const e=this.articleContent.cloneNode(!0);return e.querySelectorAll(".wikipedia-link, .detail-chip, .potential-link").forEach(t=>{t.replaceWith(t.textContent||"")}),e.textContent||""}renderLinkSuggestions(e){this.clearLinkSuggestions(),this.addLinkSuggestionsToDOM(e),this.setupPotentialLinkListeners()}addLinkSuggestionsToDOM(e){const t=document.createTreeWalker(this.articleContent,NodeFilter.SHOW_TEXT,null),n=[];let i;for(;i=t.nextNode();)n.push(i);let a="";const s=[];for(const c of n){const p=c.textContent||"",d=a.length,h=d+p.length;s.push({node:c,start:d,end:h}),a+=p}const r=[...e].sort((c,p)=>p.startIndex-c.startIndex);for(const c of r)this.applySuggestionToDOM(c,s,a)}applySuggestionToDOM(e,t,n){const i=n.substring(e.startIndex,e.endIndex),a=t.find(f=>f.start<=e.startIndex&&f.end>e.startIndex);if(!a)return;const s=a.node.textContent||"",r=e.startIndex-a.start,c=e.endIndex-a.start;if(s.substring(r,c).toLowerCase()!==i.toLowerCase())return;const d=document.createElement("span");d.className="potential-link",d.setAttribute("data-wikipedia-title",e.wikipediaTitle),d.setAttribute("data-confidence",e.confidence.toString()),d.setAttribute("data-url",e.url),d.setAttribute("data-original-text",e.text),d.setAttribute("title",`Suggested link: ${e.wikipediaTitle}`),d.innerHTML=`
            ${e.text}
            <span class="link-suggestion-tooltip">${this.escapeHtml(e.description||e.wikipediaTitle)}</span>
            <div class="link-suggestion-actions">
                <button class="link-action-btn link-action-btn--primary" data-action="accept">Link</button>
                <button class="link-action-btn" data-action="reject">Ignore</button>
            </div>
        `;const h=s.substring(0,r),g=s.substring(c),m=a.node.parentNode;if(!m)return;const E=document.createTextNode(h),C=document.createTextNode(g);h&&m.insertBefore(E,a.node),m.insertBefore(d,a.node),g&&m.insertBefore(C,a.node),m.removeChild(a.node)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}setupPotentialLinkListeners(){const e=this.articleContent.querySelectorAll(".potential-link");e.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),e.forEach(a=>{a.classList.remove("potential-link--active")}),t.classList.toggle("potential-link--active")}),t.querySelectorAll(".link-action-btn").forEach(i=>{i.addEventListener("click",a=>{a.stopPropagation();const s=i.dataset.action;s==="accept"?this.acceptLinkSuggestion(t):s==="reject"&&this.rejectLinkSuggestion(t)})})})}acceptLinkSuggestion(e){var s;const t=e.dataset.wikipediaTitle||"",n=e.dataset.url||"",i=e.dataset.originalText||"",a=document.createElement("a");a.href=n,a.target="_blank",a.className="wikipedia-link",a.textContent=i,a.title=t,(s=e.parentNode)==null||s.replaceChild(a,e)}rejectLinkSuggestion(e){var i;const t=e.dataset.originalText||"",n=document.createTextNode(t);(i=e.parentNode)==null||i.replaceChild(n,e)}clearLinkSuggestions(){this.articleContent.querySelectorAll(".potential-link").forEach(t=>{var i;const n=((i=t.textContent)==null?void 0:i.replace(/LinkIgnore/,"").trim())||"";t.outerHTML=n}),this.currentLinkSuggestions=[]}}new de;
