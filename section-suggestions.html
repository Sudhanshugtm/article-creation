<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">What to improve?</title>
  <!-- Dev-friendly: load source entry and CSS; Vite will bundle for prod -->
  <script type="module" src="./src/section-suggestions.ts"></script>
  <link rel="stylesheet" href="./src/styles/codex.css">
  <link rel="stylesheet" href="./src/styles/section-suggestions.css">
</head>
<body>
    <div class="suggestions-page">
        <header class="suggestions-page__header">
            <div class="suggestions-page__nav">
                <button class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled" onclick="window.location.href='./section-expansion.html'">
                    <span class="cdx-icon cdx-icon--medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                            <path d="M4 10l5-5v3h7v4h-7v3z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="suggestions-page__title-section">
                <h1 class="suggestions-page__title">
                    <span class="suggestions-page__icon">ðŸ’¡</span>
                    What to improve?
                </h1>
                <p class="suggestions-page__subtitle" id="articleSubtitle">Katie Bouman article â€¢ <span id="suggestionCount">8 ideas</span></p>
            </div>
        </header>

        <main class="suggestions-page__main">
            <div class="suggestions-page__content">
                <!-- Add a new section (moved first) -->
                <section class="suggestion-section">
                    <h2 class="suggestion-section__title">Add a new section</h2>
                    <div class="suggestion-list" id="sectionList">
                        <div class="suggestion-item suggestion-item--section" data-section="awards-section">
                            <button class="suggestion-item__add-btn">+</button>
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">Awards</div>
                                <div class="suggestion-item__hint">Mention all awards received</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M2 3v2h12V3H2zm0 4v2h12V7H2zm0 4v2h12v-2H2z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will be positioned after "Recognition" section</span>
                                </div>
                            </div>
                        </div>
                        <div class="suggestion-item suggestion-item--section" data-section="works-section">
                            <button class="suggestion-item__add-btn">+</button>
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">Notable Works</div>
                                <div class="suggestion-item__hint">Highlight significant works listed on Wikidata</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M2 3v2h12V3H2zm0 4v2h12V7H2zm0 4v2h12v-2H2z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will be positioned after "Research and career" section</span>
                                </div>
                            </div>
                        </div>
                        <div class="suggestion-item suggestion-item--section" data-section="education-section">
                            <button class="suggestion-item__add-btn">+</button>
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">Education</div>
                                <div class="suggestion-item__hint">Academic background and degrees</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M2 3v2h12V3H2zm0 4v2h12V7H2zm0 4v2h12v-2H2z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will enhance "Early life and education" section</span>
                                </div>
                            </div>
                        </div>
                        <div class="suggestion-item suggestion-item--section" data-section="personal-section">
                            <button class="suggestion-item__add-btn">+</button>
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">Personal life</div>
                                <div class="suggestion-item__hint">Background and personal information</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M2 3v2h12V3H2zm0 4v2h12V7H2zm0 4v2h12v-2H2z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will be positioned after "Early life and education" section</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Add a fact (moved second) -->
                <section class="suggestion-section">
                    <h2 class="suggestion-section__title">Add a fact</h2>
                    <div class="suggestion-list" id="factList">
                        <label class="suggestion-item">
                            <input type="checkbox" class="suggestion-item__checkbox" data-fact="harvard">
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">Bouman joined Harvard University as a postdoctoral fellow on the Event Horizon Telescope Imaging team (2018)</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M8 0L6.586 1.414 12.172 7H0v2h12.172l-5.586 5.586L8 16l8-8z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will be added to "Research and career" section, first paragraph</span>
                                </div>
                            </div>
                        </label>
                        <label class="suggestion-item">
                            <input type="checkbox" class="suggestion-item__checkbox" data-fact="caltech">
                            <div class="suggestion-item__content">
                                <div class="suggestion-item__text">She then joined the California Institute of Technology (Caltech) as an assistant professor in June 2019, later promoted to associate professor</div>
                                <div class="suggestion-item__placement">
                                    <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M8 0L6.586 1.414 12.172 7H0v2h12.172l-5.586 5.586L8 16l8-8z"/>
                                        </svg>
                                    </span>
                                    <span class="suggestion-item__placement-text">Will be added to "Research and career" section, after paragraph about Caltech</span>
                                </div>
                            </div>
                        </label>
                    </div>
                </section>

                </section>
            </div>
        </main>

        <!-- Fixed bottom action bar -->
        <div class="suggestions-page__actions">
            <button class="cdx-button cdx-button--action-default" id="clearButton">
                Clear all
            </button>
            <button class="cdx-button cdx-button--action-progressive cdx-button--weight-primary" id="applyButton" disabled>
                Apply <span id="selectionCount">0</span> suggestion<span id="pluralS">s</span>
            </button>
        </div>
    </div>

    <script>
        // Make the suggestions page dynamic based on selected article
        document.addEventListener('DOMContentLoaded', function() {
            const selectedArticleData = sessionStorage.getItem('selectedArticle');
            
            if (selectedArticleData) {
                const article = JSON.parse(selectedArticleData);
                updatePageForArticle(article);
            } else {
                // Fallback to Katie Bouman if no selection found
                updatePageForArticle({
                    title: 'Katie Bouman',
                    description: 'American computer scientist and engineer'
                });
            }
        });

        function updatePageForArticle(article) {
            // Update page title and subtitle
            document.getElementById('pageTitle').textContent = `What to improve? - ${article.title}`;
            document.getElementById('articleSubtitle').innerHTML = `${article.title} article â€¢ <span id="suggestionCount">8 ideas</span>`;
            
            // Load suggestions dynamically from cached Wikidata or fall back to presets
            loadSuggestionsFromCacheOrFallback(article.id || 'katie-bouman');
        }

        function loadSuggestionsFromCacheOrFallback(articleId) {
            // Prefer suggestions prefetched from Wikidata and stored in sessionStorage
            try {
                const raw = sessionStorage.getItem('wikidataSuggestions');
                if (raw) {
                    const arr = JSON.parse(raw) || [];
                    const facts = arr.filter(s => s.type === 'fact').map(s => ({
                        id: s.id,
                        text: s.content,
                        placement: s.hint || 'Will be added where relevant'
                    }));
                    const sections = arr.filter(s => s.type === 'section').map(s => ({
                        id: s.id,
                        title: s.title,
                        hint: s.hint || 'Suggested based on Wikidata',
                        placement: 'Positioned based on article structure'
                    }));
                    if (facts.length + sections.length > 0) {
                        updateSuggestionContent({ facts, sections });
                        if (window.suggestionsManager && window.suggestionsManager.initializeEventListeners) {
                            window.suggestionsManager.initializeEventListeners();
                        }
                        return; // Done
                    }
                }
            } catch (e) {
                console.warn('Failed to load cached Wikidata suggestions:', e);
            }

            // Fallback: static presets per article
            const suggestionSets = {
                'katie-bouman': {
                    facts: [
                        {
                            id: 'harvard',
                            text: 'Bouman joined Harvard University as a postdoctoral fellow on the Event Horizon Telescope Imaging team (2018)',
                            placement: 'Will be added to "Research and career" section, first paragraph'
                        },
                        {
                            id: 'caltech',
                            text: 'She then joined the California Institute of Technology (Caltech) as an assistant professor in June 2019, later promoted to associate professor',
                            placement: 'Will be added to "Research and career" section, after paragraph about Caltech'
                        }
                    ],
                    sections: [
                        {
                            id: 'awards-section',
                            title: 'Awards',
                            hint: 'Mention all awards received',
                            placement: 'Will be positioned after "Recognition" section'
                        },
                        {
                            id: 'works-section',
                            title: 'Notable Works',
                            hint: 'Highlight significant works listed on Wikidata',
                            placement: 'Will be positioned after "Research and career" section'
                        }
                    ]
                },
                'john-langford': {
                    facts: [
                        {
                            id: 'education',
                            text: 'Langford studied Physics and Computer Science at Caltech, earning a double bachelor\'s degree in 1997',
                            placement: 'Will be added to new "Education" section'
                        },
                        {
                            id: 'phd',
                            text: 'He received his Ph.D. in computer science from Carnegie Mellon University in 2002',
                            placement: 'Will be added to new "Education" section, after bachelor\'s degree'
                        },
                        {
                            id: 'microsoft',
                            text: 'He works at Microsoft Research New York, of which he was one of the founding members',
                            placement: 'Will be added to new "Career" section'
                        }
                    ],
                    sections: [
                        {
                            id: 'education-section',
                            title: 'Education',
                            hint: 'Academic background and degrees',
                            placement: 'Will be positioned after introduction'
                        },
                        {
                            id: 'career-section',
                            title: 'Career',
                            hint: 'Professional positions and roles',
                            placement: 'Will be positioned after "Education" section'
                        },
                        {
                            id: 'research-section',
                            title: 'Research',
                            hint: 'Detailed research contributions',
                            placement: 'Will be positioned after "Career" section'
                        }
                    ]
                },
                'henri-gouraud': {
                    facts: [
                        {
                            id: 'birth',
                            text: 'Henri Gouraud was born in 1944 in France',
                            placement: 'Will be added to new "Early life" section'
                        },
                        {
                            id: 'nephew',
                            text: 'He is the great-nephew of general Henri Gouraud',
                            placement: 'Will be added to new "Early life" section, after birth year'
                        },
                        {
                            id: 'face-capture',
                            text: 'In 1971, Gouraud made the first computer graphics geometry capture of a human face in wire-frame model, using his wife Sylvie as the model',
                            placement: 'Will be added to existing text, after dissertation mention'
                        }
                    ],
                    sections: [
                        {
                            id: 'early-life-section',
                            title: 'Early life',
                            hint: 'Birth and family background',
                            placement: 'Will be positioned after introduction'
                        },
                        {
                            id: 'legacy-section',
                            title: 'Legacy and impact',
                            hint: 'Influence on computer graphics field',
                            placement: 'Will be positioned after "Original publications" section'
                        }
                    ]
                },
                'eduardo-caianiello': {
                    facts: [
                        {
                            id: 'institutes',
                            text: 'Caianiello founded and directed multiple institutes including the Institute of Theoretical Physics of the University of Naples',
                            placement: 'Will be added to new "Career" section'
                        },
                        {
                            id: 'cybernetics',
                            text: 'He founded the Laboratory of Cybernetics of the Consiglio Nazionale delle Ricerche at Arco Felice (Naples)',
                            placement: 'Will be added to new "Career" section, after University of Naples'
                        },
                        {
                            id: 'hafnian',
                            text: 'The name of the Hafnian was coined by Caianiello "to mark the fruitful period of stay in Copenhagen (Hafnia in Latin)"',
                            placement: 'Will be added to new "Research contributions" section'
                        }
                    ],
                    sections: [
                        {
                            id: 'career-section',
                            title: 'Career',
                            hint: 'Academic positions and institutes founded',
                            placement: 'Will be positioned after introduction'
                        },
                        {
                            id: 'research-section',
                            title: 'Research contributions',
                            hint: 'Key scientific contributions and theories',
                            placement: 'Will be positioned after "Career" section'
                        },
                        {
                            id: 'legacy-section',
                            title: 'Legacy',
                            hint: 'Impact on physics and cybernetics',
                            placement: 'Will be positioned after "Research contributions" section'
                        }
                    ]
                },
                'patrick-mchale': {
                    facts: [
                        {
                            id: 'birth',
                            text: 'Patrick Nolen McHale was born November 17, 1983',
                            placement: 'Will be added to "Life and career" section, beginning'
                        },
                        {
                            id: 'calarts',
                            text: 'McHale graduated from the California Institute of the Arts in Santa Clarita in 2006 with a BFA in character animation',
                            placement: 'Will be added to "Early career" subsection'
                        },
                        {
                            id: 'awards',
                            text: 'McHale won a National Cartoonists Society Reuben award and an Emmy Award for Best Animated Program for Over the Garden Wall',
                            placement: 'Will be added to existing "Over the Garden Wall" subsection'
                        }
                    ],
                    sections: [
                        {
                            id: 'awards-section',
                            title: 'Awards and recognition',
                            hint: 'Emmy, Reuben award, and other accolades',
                            placement: 'Will be positioned after existing content'
                        }
                    ]
                }
            };

            const suggestions = suggestionSets[articleId] || suggestionSets['katie-bouman'];
            updateSuggestionContent(suggestions);
            if (window.suggestionsManager && window.suggestionsManager.initializeEventListeners) {
                window.suggestionsManager.initializeEventListeners();
            }
        }

        function updateSuggestionContent(suggestions) {
            // Update fact suggestions
            const factList = document.getElementById('factList');
            if (factList && suggestions.facts) {
                factList.innerHTML = '';
                suggestions.facts.forEach(fact => {
                    const item = document.createElement('label');
                    item.className = 'suggestion-item';
                    item.innerHTML = `
                        <input type="checkbox" class="suggestion-item__checkbox" data-fact="${fact.id}">
                        <div class="suggestion-item__content">
                            <div class="suggestion-item__text">${fact.text}</div>
                            <div class="suggestion-item__placement">
                                <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                        <path d="M8 0L6.586 1.414 12.172 7H0v2h12.172l-5.586 5.586L8 16l8-8z"/>
                                    </svg>
                                </span>
                                <span class="suggestion-item__placement-text">${fact.placement}</span>
                            </div>
                        </div>
                    `;
                    factList.appendChild(item);
                });
            }

            // Update section suggestions
            const sectionList = document.getElementById('sectionList');
            if (sectionList && suggestions.sections) {
                sectionList.innerHTML = '';
                suggestions.sections.forEach(section => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item suggestion-item--section';
                    item.dataset.section = section.id;
                    item.innerHTML = `
                        <button class="suggestion-item__add-btn">+</button>
                        <div class="suggestion-item__content">
                            <div class="suggestion-item__text">${section.title}</div>
                            <div class="suggestion-item__hint">${section.hint}</div>
                            <div class="suggestion-item__placement">
                                <span class="cdx-icon cdx-icon--x-small suggestion-item__placement-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                        <path d="M2 3v2h12V3H2zm0 4v2h12V7H2zm0 4v2h12v-2H2z"/>
                                    </svg>
                                </span>
                                <span class="suggestion-item__placement-text">${section.placement}</span>
                            </div>
                        </div>
                    `;
                    sectionList.appendChild(item);
                });
            }

            // Update suggestion count
            const totalSuggestions = (suggestions.facts?.length || 0) + (suggestions.sections?.length || 0);
            document.getElementById('suggestionCount').textContent = `${totalSuggestions} ideas`;
        }
    </script>

</body>
</html>
