<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Katie Bouman - Wikipedia</title>
  <script type="module" src="./assets/section-expansion-R50QQbm4.js"></script>
  <link rel="stylesheet" href="./src/styles/codex.css">
  <link rel="stylesheet" href="./src/styles/section-expansion.css">
</head>
<body>
    <div class="article-expansion">
        <!-- Wikipedia-style header -->
        <header class="article-header">
            <div class="article-header__nav">
                <button class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled" onclick="window.location.href='./section-creation.html'">
                    <span class="cdx-icon cdx-icon--medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                            <path d="M4 10l5-5v3h7v4h-7v3z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="article-header__title-wrapper">
                <h1 class="article-header__title" id="articleTitle">Katie Bouman</h1>
                <div class="article-header__subtitle" id="articleSubtitle">American computer scientist and engineer</div>
            </div>
        </header>

        <!-- Article content -->
        <main class="article-content">
            <article class="article-body" id="articleBody">
                <!-- Dynamic content will be loaded here -->
            </article>
        </main>

        <!-- Smart Widget -->
        <div class="smart-widget" id="smartWidget">
            <button class="smart-widget__trigger" id="smartWidgetTrigger" onclick="window.location.href='./section-suggestions.html'">
                <span class="smart-widget__icon">ðŸ’¡</span>
                <span class="smart-widget__text">What to improve?</span>
                <span class="smart-widget__badge" id="suggestionCount">8 ideas</span>
            </button>
        </div>
    </div>

    <script>
        // Load selected article content from sessionStorage
        document.addEventListener('DOMContentLoaded', function() {
            const selectedArticleMeta = sessionStorage.getItem('selectedArticleMeta');
            
            if (selectedArticleMeta) {
                const articleMeta = JSON.parse(selectedArticleMeta);
                loadWikipediaArticle(articleMeta);
            } else {
                // Fallback to Katie Bouman if no selection found
                loadWikipediaArticle({
                    title: 'Katie Bouman',
                    description: 'American computer scientist and engineer',
                    wikipediaTitle: 'Katie Bouman'
                });
            }
        });

        async function loadWikipediaArticle(articleMeta) {
            try {
                // Update page title and header immediately
                document.getElementById('pageTitle').textContent = articleMeta.title + ' - Wikipedia';
                document.getElementById('articleTitle').textContent = articleMeta.title;
                document.getElementById('articleSubtitle').textContent = articleMeta.description;
                
                // Show loading state
                document.getElementById('articleBody').innerHTML = '<div class="loading-content">Loading article content...</div>';
                
                // Fetch article content from Wikipedia API
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(articleMeta.wikipediaTitle)}`);
                const summary = await response.json();
                
                // Fetch full content
                const contentResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=parse&format=json&page=${encodeURIComponent(articleMeta.wikipediaTitle)}&prop=text&section=0&origin=*`);
                const contentData = await contentResponse.json();
                
                if (contentData.parse && contentData.parse.text) {
                    // Create simplified article content
                    const articleContent = createSimplifiedArticleContent(summary, contentData.parse.text['*']);
                    document.getElementById('articleBody').innerHTML = articleContent;
                } else {
                    throw new Error('Failed to fetch article content');
                }
                
            } catch (error) {
                console.error('Error loading Wikipedia article:', error);
                loadFallbackContent(articleMeta);
            }
        }

        function createSimplifiedArticleContent(summary, fullHtml) {
            // Create a simplified version using the summary and basic structure
            let content = `
                <section class="article-section">
                    <div class="article-section__content">
                        <p><strong>${summary.title}</strong> ${summary.extract}</p>
                    </div>
                </section>
            `;
            
            // Add placeholder sections for expansion
            content += `
                <section class="article-section">
                    <h2 class="article-section__title">Research and career</h2>
                    <div class="article-section__content" id="researchCareerContent">
                        <p>This section could be expanded with more details about the person's work and contributions.</p>
                    </div>
                </section>
                
                <section class="article-section">
                    <h2 class="article-section__title">Recognition</h2>
                    <div class="article-section__content">
                        <p>Awards and recognition could be added here.</p>
                    </div>
                </section>
                
                <div id="newSectionsContainer"></div>
            `;
            
            return content;
        }

        function loadFallbackContent(articleMeta) {
            const fallbackContent = `
                <section class="article-section">
                    <div class="article-section__content">
                        <p><strong>${articleMeta.title}</strong> - ${articleMeta.description}</p>
                        <p>This article is available for expansion. You can add missing facts and new sections to improve its content.</p>
                    </div>
                </section>
                
                <section class="article-section">
                    <h2 class="article-section__title">Research and career</h2>
                    <div class="article-section__content" id="researchCareerContent">
                        <p>This section could be expanded with more details.</p>
                    </div>
                </section>
                
                <div id="newSectionsContainer"></div>
            `;
            document.getElementById('articleBody').innerHTML = fallbackContent;
        }
    </script>
    
    <style>
        .loading-content {
            text-align: center;
            padding: 40px 20px;
            color: #72777d;
            font-style: italic;
        }
    </style>

</body>
</html>